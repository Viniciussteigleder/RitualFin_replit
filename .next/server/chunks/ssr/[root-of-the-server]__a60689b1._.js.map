{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../src/lib/actions/auth.ts","../../../../.next-internal/server/app/%28auth%29/signup/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","\"use server\";\n\nimport { db } from \"@/lib/db\";\nimport { users } from \"@/lib/db/schema\";\nimport { eq } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\nimport { z } from \"zod\";\nimport { signIn } from \"@/auth\";\nimport { AuthError } from \"next-auth\";\n\nconst signupSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nexport async function registerUser(prevState: string | undefined, formData: FormData) {\n  const data = Object.fromEntries(formData.entries());\n  \n  const parsed = signupSchema.safeParse(data);\n  if (!parsed.success) {\n    return \"Invalid input data\";\n  }\n\n  const { username, email, password } = parsed.data;\n\n  try {\n    // Check if user exists\n    const existingUser = await db.query.users.findFirst({\n      where: (users, { or, eq }) => or(eq(users.email, email), eq(users.username, username)),\n    });\n\n    if (existingUser) {\n      return \"User already exists (email or username)\";\n    }\n\n    const hashedPassword = await bcrypt.hash(password, 10);\n\n    const [newUser] = await db.insert(users).values({\n      username,\n      email,\n      passwordHash: hashedPassword,\n    }).returning();\n\n    // Attempt sign in immediately after registration\n    await signIn(\"credentials\", {\n      email,\n      password,\n      redirectTo: \"/dashboard\",\n    });\n    \n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case \"CredentialsSignin\":\n          return \"Invalid credentials.\";\n        default:\n          throw error; // Rethrow to let NextAuth handle redirect\n      }\n    }\n    console.error(\"Registration error:\", error);\n    return \"Failed to register user.\";\n  }\n}\n","export {registerUser as '60365ce5c242b6e8c086221eb1a4b44ee52029f623'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"gNAAoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CA,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,iCCEjC,SAASC,EAAyBC,CAAc,EACrD,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQE,MAAM,CAAED,IAAK,CACvC,IAAME,EAASH,CAAO,CAACC,EAAE,CACzB,GAAI,AAAkB,YAAY,OAAvBE,EACT,MAAM,OAAA,cAEL,CAFK,AAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,EAAO;AAAA,oEAAuE,CAAC,EADhJ,oBAAA,OAAA,kBAAA,iBAAA,CAEN,EAEJ,CACF,0EATgBJ,2BAAAA,qCAAAA,qDCDhB,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,0DAEA,IAAM,EAAe,EAAA,CAAC,CAAC,MAAM,CAAC,CAC5B,SAAU,EAAA,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,0CAC5B,MAAO,EAAA,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC,yBACxB,SAAU,EAAA,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,yCAC9B,GAEO,eAAe,EAAa,CAA6B,CAAE,CAAkB,EAClF,IAAM,EAAO,OAAO,WAAW,CAAC,EAAS,OAAO,IAE1C,EAAS,EAAa,SAAS,CAAC,GACtC,GAAI,CAAC,EAAO,OAAO,CACjB,CADmB,KACZ,qBAGT,GAAM,UAAE,CAAQ,OAAE,CAAK,UAAE,CAAQ,CAAE,CAAG,EAAO,IAAI,CAEjD,GAAI,CAMF,GAJqB,CAIjB,KAJuB,EAAA,EAAE,CAAC,IAIZ,CAJiB,CAAC,KAAK,CAAC,SAAS,CAAC,CAClD,MAAO,CAAC,EAAO,IAAE,CAAE,IAAE,CAAE,CAAE,GAAK,EAAG,EAAG,EAAM,KAAK,CAAE,GAAQ,EAAG,EAAM,QAAQ,CAAE,GAC9E,GAGE,MAAO,0CAGT,IAAM,EAAiB,MAAM,EAAA,OAAM,CAAC,IAAI,CAAC,EAAU,IAE7C,CAAC,EAAQ,CAAG,MAAM,EAAA,EAAE,CAAC,MAAM,CAAC,EAAA,KAAK,EAAE,MAAM,CAAC,UAC9C,QACA,EACA,aAAc,CAChB,GAAG,SAAS,EAGZ,OAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,cAAe,OAC1B,WACA,EACA,WAAY,YACd,EAEF,CAAE,MAAO,EAAO,CACd,GAAI,aAAiB,EAAA,SAAS,CAC5B,CAD8B,EAEvB,sBADC,EAAM,IAAI,CAEd,MAAO,4BAEP,MAAM,EAIZ,KAJmB,EAGnB,QAAQ,KAAK,CAAC,sBAAuB,GAC9B,CAJsD,yBAK/D,CACF,iCA/CsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,wFChBtB,IAAA,EAAA,EAAA,CAAA,CAAA","ignoreList":[0,1]}