You are Replit (senior full-stack engineer + DevOps). You will work autonomously: review, fix, improve, document, and commit to main without asking me questions unless you are hard blocked.

CONTEXT (CURRENT DECISION — DO NOT CHANGE)
- Database: Supabase Postgres (production data).
- Backend: Node/Express on Render.
- Frontend: Vite/React on Vercel.
- GitHub main = single source of truth. All production changes must be committed and pushed to GitHub.
- Replit is allowed for development only. No Replit Deployments, no Replit DB for production.

GOAL
Bring the repo and docs to a “production-grade” state for the Supabase + Render + Vercel architecture, ensuring:
- Frontend uses VITE_API_URL correctly in production builds (never calls relative /api on Vercel).
- Vercel configuration is valid (no mixing of incompatible routing props).
- Backend CORS is correct for Vercel (production + previews + local dev).
- No remaining Replit deployment assumptions.
- Documentation is consistent, precise, and actionable.

INPUTS YOU MUST REVIEW IN THE REPO
1) BATCH_EXECUTION_INSTRUCTIONS.md
2) PHASES_1_TO_4_COMPLETE_SUMMARY.md
3) Any UI feedback / “to-do” md file referenced by the repo (search for “feedback”, “UI”, “TODO”, “notes”, “issues”).
4) Branch: fix/deployment-connectivity
   - QA on this branch was run and documented; no code changes were needed at the time.
   - Runtime smoke test was blocked previously by missing DATABASE_URL.

MANDATORY TECHNICAL CHECKS (DO THESE FIRST)
A) Verify frontend API base URL handling
- Locate client/src/lib/api.ts (or equivalent).
- Ensure API base URL is computed as:
  - If VITE_API_URL is set:
    - strip trailing slashes
    - if it ends with /api (case-insensitive), do not append /api again
    - otherwise append /api once
  - If VITE_API_URL is not set:
    - fallback to "/api" for local dev (or localhost backend if the app is designed that way)
- Ensure ALL API calls go through this base (no direct fetch("/api/...") elsewhere).
- Add a one-time debug log guarded by import.meta.env.DEV only (optional but useful).

B) Verify Vercel config validity
- Find vercel.json.
- Ensure it does NOT mix:
  - `routes` with any of: `rewrites`, `redirects`, `headers`, `cleanUrls`, `trailingSlash`.
- Choose one approach and standardize. Preferred for SPA:
  - `rewrites`: [{ "source": "/(.*)", "destination": "/index.html" }]
- Keep it minimal and correct for Vite output (dist/public as per build script).

C) Verify backend routing expectations
- Confirm backend exposes /api/auth/login and /api/health (or /api/healthcheck) as documented.
- Ensure there is no Vercel rewrite accidentally attempting to proxy /api to a Vercel function (this app should call Render directly).

D) Verify CORS correctness in backend
- Confirm the Express CORS config supports:
  - Production domain: https://<your-app>.vercel.app
  - Preview domains (either a safe regex if code supports it, or explicit allowlist)
  - Local dev origins (http://localhost:5173 or the actual port used)
- Ensure credentials: true is paired with explicit origins (no wildcard).

E) Search and eliminate Replit deployment coupling
- Search for:
  - replit.app / replit.co domains
  - references to Replit DB
  - deployment scripts assuming Replit
  - meta-images script behavior (e.g., “no Replit deployment domain found”) — either remove, or make harmless + documented.
- Remove/replace any hardcoded Replit URLs from production code paths.

F) Secrets hygiene
- Confirm no secrets are committed.
- Ensure .env.example contains placeholders only and no real keys.
- Ensure .env.local and .vercel are in .gitignore.

BRANCH FLOW (IMPORTANT)
1) Check out and review fix/deployment-connectivity.
2) If it is correct, merge it into main using a clean merge strategy.
3) Apply any additional fixes directly on main (or via a short-lived branch if you prefer), but the final state must land on main.

QA REQUIREMENTS
Run and record results in repo docs (update or create if needed):
- npm run check
- npm run build
- If runtime is possible without leaking secrets:
  - ensure DATABASE_URL is available via environment at runtime
  - npm run dev
  - curl -fsS http://localhost:5000/api/health
If runtime QA is blocked due to missing DATABASE_URL:
- Do not ask me for it.
- Document runtime QA as blocked and provide the exact command that would validate it once env is available, without printing secrets.

DOCUMENTATION REQUIREMENTS (MAKE CONSISTENT AND “NEXT LEVEL”)
Create or update a single authoritative doc (prefer: docs/DEPLOYMENT.md). It must include:
1) Architecture overview (Supabase + Render + Vercel).
2) Environment variables:
   - Vercel: VITE_API_URL must be https://ritualfin-api.onrender.com (no trailing slash, no /api).
   - Render: DATABASE_URL (Supabase pooler URL), CORS_ORIGIN, others as needed.
3) Standard workflow:
   - Develop locally/Replit → commit/push to GitHub → deploy backend (Render) → deploy frontend (Vercel) → smoke tests.
4) Deployment troubleshooting:
   - Vercel Git integration issues → Vercel CLI deploy fallback.
   - The “routes + rewrites conflict” error and the correct vercel.json pattern.
   - How to confirm the correct commit is deployed (where to see commit SHA in Vercel build logs / dashboard).

EXPECTED DELIVERABLES (NO QUESTIONS, JUST OUTPUT)
A) Setup Review Findings
- What was correct.
- What was wrong.
- What you changed.

B) Updated Procedure
- Step-by-step process for future work (GitHub main as canonical).

C) Actions Taken
- List commits made (hash + message).
- Files changed.

D) Final Status
- “Ready for production” or “Blocked”, with precise blockers if any.

CONSTRAINTS
- Do not ask me questions unless hard blocked.
- Do not introduce new infrastructure.
- Do not remove working behavior; only fix and harden.
- Keep commits small, clear, and scoped.

EXECUTION
Proceed now:
- Review fix/deployment-connectivity branch.
- Fix any issues.
- Ensure vercel.json is valid (no routes+rewrites mix).
- Ensure api.ts uses VITE_API_URL robustly.
- Update docs per above.
- Commit and push to main.
