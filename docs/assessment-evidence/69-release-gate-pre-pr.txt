
> rest-express@1.0.1 release:gate
> npx tsx scripts/pre-deploy-check.ts



â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                            â•‘
â•‘           PRE-DEPLOYMENT CHECK SUITE                       â•‘
â•‘           RitualFin Next.js Application                    â•‘
â•‘                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


============================================================
ğŸ” Running: TypeScript Compilation
   Ensures no TypeScript errors
============================================================


> rest-express@1.0.1 check
> tsc


âœ… TypeScript Compilation PASSED (4305ms)


============================================================
ğŸ” Running: Production Build
   Verifies Next.js build succeeds
============================================================


> rest-express@1.0.1 build
> next build

â–² Next.js 16.1.1 (Turbopack)
- Environments: .env.production.local, .env.local

  Creating an optimized production build ...
âœ“ Compiled successfully in 6.7s
  Running TypeScript ...
  Collecting page data using 7 workers ...
  Generating static pages using 7 workers (0/25) ...
  Generating static pages using 7 workers (6/25) 
  Generating static pages using 7 workers (12/25) 
  Generating static pages using 7 workers (18/25) 
âœ“ Generating static pages using 7 workers (25/25) in 397.7ms
  Finalizing page optimization ...

Route (app)
â”Œ Æ’ /
â”œ â—‹ /_not-found
â”œ Æ’ /accounts
â”œ Æ’ /admin/import
â”œ Æ’ /admin/rules
â”œ Æ’ /ai-keywords
â”œ Æ’ /analytics
â”œ Æ’ /api/auth/[...nextauth]
â”œ Æ’ /api/auth/debug
â”œ Æ’ /api/health
â”œ Æ’ /budgets
â”œ Æ’ /calendar
â”œ Æ’ /calendar/events/[id]
â”œ Æ’ /confirm
â”œ Æ’ /diagnose
â”œ Æ’ /goals
â”œ â—‹ /icon.png
â”œ Æ’ /imports/[batchId]/preview
â”œ â—‹ /login
â”œ Æ’ /rituals
â”œ Æ’ /rules
â”œ Æ’ /settings
â”œ Æ’ /settings/exclusions
â”œ Æ’ /settings/rules
â”œ Æ’ /settings/taxonomy
â”œ â—‹ /signup
â”œ Æ’ /transactions
â”” Æ’ /uploads


Æ’ Proxy (Middleware)

â—‹  (Static)   prerendered as static content
Æ’  (Dynamic)  server-rendered on demand


âœ… Production Build PASSED (18940ms)


============================================================
ğŸ” Running: Rules Engine Unit Tests
   Validates core business logic
============================================================


========================================
Rules Engine Unit Tests
Logic Contract: docs/LOGIC_CONTRACT.md
========================================

TC-001: Testing determinism...
  âœ“ TC-001 passed: Deterministic output
TC-002: Testing strict rule short-circuit...
  âœ“ TC-002 passed: Strict rule short-circuits correctly
TC-003: Testing priority order...
  âœ“ TC-003 passed: Higher priority wins
TC-004: Testing negative keywords...
  âœ“ TC-004 passed: Negative keywords exclude correctly
TC-005: Testing Interno auto-flagging...
  âœ“ TC-005 passed: Interno auto-flags correctly
TC-006: Manual override preservation...
  âš  Note: Full test requires database integration
  âœ“ TC-006 skipped: Tested at integration level
TC-007: Testing conflict detection...
  âœ“ TC-007 passed: Conflict detection works
TC-008: Testing confidence threshold...
  âœ“ TC-008 passed: Confidence threshold respected
TC-009: Testing inactive rule handling...
  âœ“ TC-009 passed: Inactive rules ignored
TC-010: Testing negative keyword exclusion in matchRules...
  âœ“ TC-010 passed: matchRules respects negative keywords
EC-001: Testing empty keywords handling...
  âœ“ EC-001 passed: Empty keywords handled
EC-002: Testing special characters...
  âœ“ EC-002 passed: Special characters work
EC-003: Testing unicode normalization...
  âœ“ EC-003 passed: Unicode normalization works
EC-004: Testing case insensitivity...
  âœ“ EC-004 passed: Case insensitivity works

========================================
Results: 14 passed, 0 failed
========================================


âœ… Rules Engine Unit Tests PASSED (678ms)


============================================================
ğŸ” Running: Database Parity Check
   Compares DB with Excel Oracle (requires network)
============================================================

[dotenv@17.2.3] injecting env (9) from .env.local -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
============================================================
Database Parity Verification
============================================================
DATABASE_URL: SET (****uire&sslmode=require)

Loading Oracle data...
  Categories: 108
  Aliases: 64
  Keyword Rules: 224
  Alias Mapping: 112

--- Verifying Taxonomy ---

DB Taxonomy Status:
  Level 1: 20 records
  Level 2: 60 records
  Leaves: 110 records

--- Verifying Rules ---

DB Rules: 187 records
Oracle Keywords: 205
DB Keywords: 208

--- Verifying Aliases ---

DB Aliases: 64 records
Oracle Alias Keywords: 110
DB Alias Keywords: 110

============================================================
PARITY REPORT
============================================================

Summary:
  Missing in DB: 0
  Extra in DB: 2
  Mismatches: 0
  Enum Mismatches: 11

Verdict: FAIL
Total Issues: 13

Report saved to: docs/rules-parity-report.json
Markdown report: docs/rules-parity-report.md

âŒ Database Parity Check FAILED (1857ms)




============================================================
ğŸ“Š PRE-DEPLOYMENT CHECK REPORT
============================================================
Timestamp: 2026-01-15T19:06:25.973Z

Summary:
  Total Checks: 4
  âœ… Passed: 3
  âŒ Failed: 1
  ğŸš¨ Critical Failed: 0

Failed Checks:
  âš ï¸ Database Parity Check (WARNING)

Detailed Results:

| Check | Status | Duration | Critical |
|-------|--------|----------|----------|
| TypeScript Compilation | âœ… PASS | 4305ms | Yes |
| Production Build | âœ… PASS | 18940ms | Yes |
| Rules Engine Unit Tests | âœ… PASS | 678ms | Yes |
| Database Parity Check | âŒ FAIL | 1857ms | No |

============================================================
âš ï¸  VERDICT: PROCEED WITH CAUTION
============================================================

Non-critical checks failed. Review before deploying:
  â€¢ Database Parity Check

ğŸ“„ Report saved to: /Users/viniciussteigleder/Documents/Web apps - vide coding/RitualFin_replit_local/RitualFin_replit/docs/pre-deploy-report.json

