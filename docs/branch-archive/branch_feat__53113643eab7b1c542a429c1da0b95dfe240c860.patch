From 53113643eab7b1c542a429c1da0b95dfe240c860 Mon Sep 17 00:00:00 2001
From: Vinicius <vinicius.steigleder@gmail.com>
Date: Wed, 31 Dec 2025 23:11:14 +0100
Subject: [PATCH] Implement UX improvements, category hierarchy, and AI chat

---
 client/src/App.tsx                            |    4 +
 client/src/components/ai-chat-modal.tsx       |  125 +-
 client/src/components/ai-keywords-panel.tsx   |  443 ++++++
 .../src/components/calendar/detail-panel.tsx  |   22 +-
 client/src/components/layout/sidebar.tsx      |   35 +-
 client/src/components/layout/top-nav.tsx      |   12 +-
 .../components/transaction-detail-modal.tsx   |   45 +-
 client/src/lib/api.ts                         |  106 ++
 client/src/lib/merchant-metadata.ts           |   62 +
 client/src/pages/accounts.tsx                 |  114 +-
 client/src/pages/ai-keywords.tsx              |  421 +-----
 client/src/pages/budgets.tsx                  |   24 +-
 client/src/pages/calendar.tsx                 |   70 +-
 client/src/pages/categories.tsx               |  306 ++++
 client/src/pages/confirm.tsx                  |  521 ++++---
 client/src/pages/dashboard.tsx                |  112 +-
 client/src/pages/event-detail.tsx             |   19 +-
 client/src/pages/goals.tsx                    |   59 +-
 client/src/pages/login.tsx                    |   24 +-
 client/src/pages/merchant-dictionary.tsx      |  318 ++++-
 client/src/pages/merchant-metadata.tsx        |  235 ++++
 client/src/pages/notifications.tsx            |  363 ++---
 client/src/pages/rituals.tsx                  |   66 +-
 client/src/pages/rules.tsx                    |  207 ++-
 client/src/pages/settings.tsx                 |  161 ++-
 client/src/pages/transactions.tsx             |  117 +-
 client/src/pages/uploads.tsx                  |  175 ++-
 docs/_codex/CODEX_ACTIVITY_LOG.md             |   56 +
 docs/_codex/PHASE_3_4_IMPLEMENTATION_SPEC.md  | 1251 +++++++++++++++++
 .../reviews/2025-12-29/EXECUTIVE_SUMMARY.md   |   47 +
 .../2025-12-29/FEATURE_VERIFICATION_MATRIX.md |   38 +
 .../reviews/2025-12-29/IMPROVEMENT_ROADMAP.md |   45 +
 docs/_codex/reviews/2025-12-29/QA_RUNBOOK.md  |   52 +
 .../2025-12-29/TECHNICAL_ASSESSMENT.md        |   45 +
 .../_codex/reviews/2025-12-29/UX_UI_REVIEW.md |   84 ++
 .../MICROCOPY_AND_LANGUAGE_REVIEW.md          |   23 +
 .../MISSING_FEATURES_AND_OPPORTUNITIES.md     |   28 +
 .../_codex/ux_review/MISSING_FEATURES_PLAN.md |  452 ++++++
 ...NAVIGATION_AND_INFORMATION_ARCHITECTURE.md |   54 +
 .../PHASE_B_UX_IMPLEMENTATION_CHECKLIST.md    |  162 +++
 .../ux_review/PRODUCT_EXPERIENCE_OVERVIEW.md  |   33 +
 .../ux_review/SCREEN_BY_SCREEN_REVIEW.md      |  313 +++++
 .../ux_review/UX_CONTRACTS_AND_RULES.md       |   31 +
 .../ux_review/UX_IMPROVEMENT_ROADMAP.md       |  109 ++
 server/csv-parser.ts                          |    8 +-
 server/index.ts                               |   13 +-
 server/routes.ts                              |  564 +++++++-
 server/storage.ts                             |   83 +-
 shared/schema.ts                              |   17 +
 49 files changed, 6554 insertions(+), 1120 deletions(-)
 create mode 100644 client/src/components/ai-keywords-panel.tsx
 create mode 100644 client/src/lib/merchant-metadata.ts
 create mode 100644 client/src/pages/categories.tsx
 create mode 100644 client/src/pages/merchant-metadata.tsx
 create mode 100644 docs/_codex/PHASE_3_4_IMPLEMENTATION_SPEC.md
 create mode 100644 docs/_codex/reviews/2025-12-29/EXECUTIVE_SUMMARY.md
 create mode 100644 docs/_codex/reviews/2025-12-29/FEATURE_VERIFICATION_MATRIX.md
 create mode 100644 docs/_codex/reviews/2025-12-29/IMPROVEMENT_ROADMAP.md
 create mode 100644 docs/_codex/reviews/2025-12-29/QA_RUNBOOK.md
 create mode 100644 docs/_codex/reviews/2025-12-29/TECHNICAL_ASSESSMENT.md
 create mode 100644 docs/_codex/reviews/2025-12-29/UX_UI_REVIEW.md
 create mode 100644 docs/_codex/ux_review/MICROCOPY_AND_LANGUAGE_REVIEW.md
 create mode 100644 docs/_codex/ux_review/MISSING_FEATURES_AND_OPPORTUNITIES.md
 create mode 100644 docs/_codex/ux_review/MISSING_FEATURES_PLAN.md
 create mode 100644 docs/_codex/ux_review/NAVIGATION_AND_INFORMATION_ARCHITECTURE.md
 create mode 100644 docs/_codex/ux_review/PHASE_B_UX_IMPLEMENTATION_CHECKLIST.md
 create mode 100644 docs/_codex/ux_review/PRODUCT_EXPERIENCE_OVERVIEW.md
 create mode 100644 docs/_codex/ux_review/SCREEN_BY_SCREEN_REVIEW.md
 create mode 100644 docs/_codex/ux_review/UX_CONTRACTS_AND_RULES.md
 create mode 100644 docs/_codex/ux_review/UX_IMPROVEMENT_ROADMAP.md

diff --git a/client/src/App.tsx b/client/src/App.tsx
index ba30920..081e0b2 100644
--- a/client/src/App.tsx
+++ b/client/src/App.tsx
@@ -11,6 +11,7 @@ import UploadsPage from "@/pages/uploads";
 import ConfirmPage from "@/pages/confirm";
 import RulesPage from "@/pages/rules";
 import MerchantDictionaryPage from "@/pages/merchant-dictionary";
+import MerchantMetadataPage from "@/pages/merchant-metadata";
 import SettingsPage from "@/pages/settings";
 import CalendarPage from "@/pages/calendar";
 import EventDetailPage from "@/pages/event-detail";
@@ -21,6 +22,7 @@ import AIKeywordsPage from "@/pages/ai-keywords";
 import AccountsPage from "@/pages/accounts";
 import TransactionsPage from "@/pages/transactions";
 import NotificationsPage from "@/pages/notifications";
+import CategoriesPage from "@/pages/categories";
 
 function Router() {
   return (
@@ -39,6 +41,8 @@ function Router() {
       <Route path="/transactions" component={TransactionsPage} />
       <Route path="/rules" component={RulesPage} />
       <Route path="/merchant-dictionary" component={MerchantDictionaryPage} />
+      <Route path="/merchant-metadata" component={MerchantMetadataPage} />
+      <Route path="/categories" component={CategoriesPage} />
       <Route path="/accounts" component={AccountsPage} />
       <Route path="/ai-keywords" component={AIKeywordsPage} />
       <Route path="/settings" component={SettingsPage} />
diff --git a/client/src/components/ai-chat-modal.tsx b/client/src/components/ai-chat-modal.tsx
index ba6e989..ab3f2da 100644
--- a/client/src/components/ai-chat-modal.tsx
+++ b/client/src/components/ai-chat-modal.tsx
@@ -1,17 +1,20 @@
 /**
  * AI Chat Modal
  *
- * Chat interface for AI assistant (UI shell only).
- * Backend integration to be implemented by Codex.
+ * Chat interface for AI assistant.
+ * Connected to backend for context-aware responses and history.
  */
 
-import { useState } from "react";
+import { useMemo, useState, useEffect } from "react";
 import { Dialog, DialogContent } from "@/components/ui/dialog";
 import { Button } from "@/components/ui/button";
 import { Input } from "@/components/ui/input";
 import { Badge } from "@/components/ui/badge";
 import { Sparkles, Send, Loader2, TrendingUp, FileText, Target } from "lucide-react";
 import { cn } from "@/lib/utils";
+import { useLocation } from "wouter";
+import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
+import { aiChatApi } from "@/lib/api";
 
 interface Message {
   id: string;
@@ -21,7 +24,7 @@ interface Message {
 }
 
 const QUICK_ACTIONS = [
-  { icon: TrendingUp, label: "Analise este m√™s", prompt: "Analise meus gastos este m√™s e d√™ sugest√µes." },
+  { icon: TrendingUp, label: "An√°lise deste m√™s", prompt: "Analise meus gastos este m√™s e d√™ sugest√µes." },
   { icon: Target, label: "Sugerir economia", prompt: "Onde posso economizar mais?" },
   { icon: FileText, label: "Encontrar duplicatas", prompt: "H√° transa√ß√µes duplicadas?" },
 ];
@@ -39,9 +42,55 @@ interface AIChatModalProps {
 }
 
 export function AIChatModal({ isOpen, onClose }: AIChatModalProps) {
+  const [location] = useLocation();
   const [messages, setMessages] = useState<Message[]>([WELCOME_MESSAGE]);
   const [input, setInput] = useState("");
   const [isLoading, setIsLoading] = useState(false);
+  const [activeConversationId, setActiveConversationId] = useState<string | null>(null);
+  const queryClient = useQueryClient();
+
+  const { data: conversations = [] } = useQuery({
+    queryKey: ["ai-conversations"],
+    queryFn: aiChatApi.listConversations,
+    enabled: isOpen,
+  });
+
+  const { data: conversationMessages = [], isLoading: messagesLoading } = useQuery({
+    queryKey: ["ai-messages", activeConversationId],
+    queryFn: () => aiChatApi.listMessages(activeConversationId as string),
+    enabled: !!activeConversationId && isOpen,
+  });
+
+  const chatMutation = useMutation({
+    mutationFn: (payload: { message: string; conversationId?: string; context?: { screen?: string } }) =>
+      aiChatApi.chat(payload),
+    onSuccess: (data) => {
+      if (data?.conversationId && data.conversationId !== activeConversationId) {
+        setActiveConversationId(data.conversationId);
+      }
+      queryClient.invalidateQueries({ queryKey: ["ai-conversations"] });
+    }
+  });
+
+  useEffect(() => {
+    if (!isOpen) return;
+    if (!activeConversationId && conversations.length > 0) {
+      setActiveConversationId(conversations[0].id);
+    }
+  }, [conversations, activeConversationId, isOpen]);
+
+  const contextLabel = useMemo(() => {
+    if (location.startsWith("/dashboard")) return "Dashboard";
+    if (location.startsWith("/transactions")) return "Transa√ß√µes";
+    if (location.startsWith("/confirm")) return "Fila de Confirma√ß√£o";
+    if (location.startsWith("/uploads")) return "Uploads";
+    if (location.startsWith("/calendar")) return "Calend√°rio";
+    if (location.startsWith("/accounts")) return "Contas";
+    if (location.startsWith("/rules")) return "Regras";
+    if (location.startsWith("/goals")) return "Metas";
+    if (location.startsWith("/budgets")) return "Or√ßamentos";
+    return "Geral";
+  }, [location]);
 
   const handleSend = async (prompt?: string) => {
     const messageText = prompt || input;
@@ -58,19 +107,51 @@ export function AIChatModal({ isOpen, onClose }: AIChatModalProps) {
     setInput("");
     setIsLoading(true);
 
-    // Simulate AI response (backend to be implemented by Codex)
-    setTimeout(() => {
+    try {
+      const response = await chatMutation.mutateAsync({
+        message: messageText,
+        conversationId: activeConversationId || undefined,
+        context: { screen: contextLabel }
+      });
+
       const aiMessage: Message = {
-        id: (Date.now() + 1).toString(),
+        id: response?.replyId || (Date.now() + 1).toString(),
         role: "assistant",
-        content: "üöß **Backend em desenvolvimento**\n\nEste √© um prot√≥tipo da interface do assistente IA. A integra√ß√£o com OpenAI ser√° implementada pelo Codex.\n\nFuncionalidades planejadas:\n- An√°lise de gastos com insights personalizados\n- Detec√ß√£o de padr√µes e anomalias\n- Sugest√µes de economia baseadas em hist√≥rico\n- Busca natural por transa√ß√µes\n- Previs√µes de gastos futuros",
+        content: response?.reply || "N√£o consegui gerar uma resposta agora.",
         timestamp: new Date()
       };
+
       setMessages(prev => [...prev, aiMessage]);
+    } catch (_error) {
+      setMessages(prev => [...prev, {
+        id: (Date.now() + 1).toString(),
+        role: "assistant",
+        content: "Tive um problema ao gerar a resposta. Tente novamente.",
+        timestamp: new Date()
+      }]);
+    } finally {
       setIsLoading(false);
-    }, 1500);
+    }
   };
 
+  useEffect(() => {
+    if (!activeConversationId) {
+      setMessages([WELCOME_MESSAGE]);
+      return;
+    }
+    if (!conversationMessages || conversationMessages.length === 0) {
+      setMessages([WELCOME_MESSAGE]);
+      return;
+    }
+    const mapped = conversationMessages.map((msg: any) => ({
+      id: msg.id,
+      role: msg.role,
+      content: msg.content,
+      timestamp: new Date(msg.createdAt)
+    })) as Message[];
+    setMessages(mapped);
+  }, [activeConversationId, conversationMessages]);
+
   return (
     <Dialog open={isOpen} onOpenChange={onClose}>
       <DialogContent className="sm:max-w-[600px] h-[600px] p-0 gap-0 flex flex-col">
@@ -87,6 +168,9 @@ export function AIChatModal({ isOpen, onClose }: AIChatModalProps) {
             <Badge className="ml-auto bg-white/20 text-white border-0">
               Beta
             </Badge>
+            <Badge className="bg-white/20 text-white border-0">
+              Contexto: {contextLabel}
+            </Badge>
           </div>
         </div>
 
@@ -110,8 +194,31 @@ export function AIChatModal({ isOpen, onClose }: AIChatModalProps) {
           </div>
         </div>
 
+        {conversations.length > 0 && (
+          <div className="px-6 py-3 border-b bg-white">
+            <p className="text-xs text-muted-foreground mb-2 uppercase tracking-wide">Conversas recentes</p>
+            <div className="flex flex-wrap gap-2">
+              {conversations.slice(0, 6).map((item: any) => (
+                <Badge
+                  key={item.id}
+                  variant={item.id === activeConversationId ? "default" : "outline"}
+                  className="text-xs cursor-pointer"
+                  onClick={() => setActiveConversationId(item.id)}
+                >
+                  {item.title?.slice(0, 30) || "Conversa"}
+                </Badge>
+              ))}
+            </div>
+          </div>
+        )}
+
         {/* Messages */}
         <div className="flex-1 overflow-y-auto p-6 space-y-4">
+          {messagesLoading && (
+            <div className="flex items-center justify-center py-8 text-muted-foreground text-sm">
+              Carregando conversa...
+            </div>
+          )}
           {messages.map((message) => (
             <div
               key={message.id}
diff --git a/client/src/components/ai-keywords-panel.tsx b/client/src/components/ai-keywords-panel.tsx
new file mode 100644
index 0000000..6657dfb
--- /dev/null
+++ b/client/src/components/ai-keywords-panel.tsx
@@ -0,0 +1,443 @@
+import { Card, CardContent } from "@/components/ui/card";
+import { Button } from "@/components/ui/button";
+import { Badge } from "@/components/ui/badge";
+import { Checkbox } from "@/components/ui/checkbox";
+import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
+import { cn } from "@/lib/utils";
+import {
+  Sparkles,
+  Brain,
+  CheckCircle2,
+  AlertCircle,
+  Loader2,
+  Home,
+  ShoppingCart,
+  Car,
+  Heart,
+  Package,
+  Film,
+  CreditCard,
+  ChevronRight,
+  RefreshCw,
+  Zap,
+  ArrowRight,
+  ExternalLink
+} from "lucide-react";
+import { useMutation, useQueryClient } from "@tanstack/react-query";
+import { useState } from "react";
+import { useToast } from "@/hooks/use-toast";
+import { Link } from "wouter";
+import { aiKeywordsApi } from "@/lib/api";
+
+const CATEGORY_ICONS: Record<string, any> = {
+  "Moradia": Home,
+  "Mercado": ShoppingCart,
+  "Transporte": Car,
+  "Sa√∫de": Heart,
+  "Lazer": Film,
+  "Compras Online": Package,
+  "Outros": CreditCard
+};
+
+const CATEGORY_COLORS: Record<string, string> = {
+  "Mercado": "#22c55e",
+  "Moradia": "#f97316",
+  "Transporte": "#3b82f6",
+  "Lazer": "#a855f7",
+  "Sa√∫de": "#ef4444",
+  "Compras Online": "#ec4899",
+  "Receitas": "#10b981",
+  "Interno": "#475569",
+  "Outros": "#6b7280"
+};
+
+const CATEGORIES = ["Moradia", "Mercado", "Compras Online", "Transporte", "Sa√∫de", "Lazer", "Receitas", "Interno", "Outros"];
+
+interface KeywordSuggestion {
+  keyword: string;
+  suggestedCategory: string;
+  suggestedType: "Despesa" | "Receita";
+  suggestedFixVar: "Fixo" | "Vari√°vel";
+  confidence: number;
+  reason: string;
+  count: number;
+  total: number;
+  samples: string[];
+}
+
+interface AIKeywordsPanelProps {
+  embedded?: boolean;
+}
+
+export function AIKeywordsPanel({ embedded = false }: AIKeywordsPanelProps) {
+  const { toast } = useToast();
+  const queryClient = useQueryClient();
+  const [selectedKeywords, setSelectedKeywords] = useState<Set<string>>(new Set());
+  const [editedSuggestions, setEditedSuggestions] = useState<Record<string, Partial<KeywordSuggestion>>>({});
+
+  const analyzeKeywords = useMutation({
+    mutationFn: aiKeywordsApi.analyze,
+    onSuccess: (data) => {
+      toast({ title: `${data.suggestions?.length || 0} palavras-chave analisadas` });
+      setSelectedKeywords(new Set(data.suggestions?.map((s: any) => s.keyword) || []));
+    },
+    onError: () => {
+      toast({ title: "Erro ao analisar transa√ß√µes", variant: "destructive" });
+    }
+  });
+
+  const applySuggestions = useMutation({
+    mutationFn: (suggestions: KeywordSuggestion[]) => aiKeywordsApi.apply(suggestions),
+    onSuccess: (data) => {
+      toast({
+        title: "Regras criadas com sucesso!",
+        description: `${data.rulesCreated} regras criadas, ${data.transactionsUpdated} transa√ß√µes atualizadas`
+      });
+      queryClient.invalidateQueries({ queryKey: ["confirm-queue"] });
+      queryClient.invalidateQueries({ queryKey: ["rules"] });
+    },
+    onError: () => {
+      toast({ title: "Erro ao criar regras", variant: "destructive" });
+    }
+  });
+
+  const suggestions = (analyzeKeywords.data?.suggestions || []) as KeywordSuggestion[];
+  const totalTransactions = analyzeKeywords.data?.total || 0;
+
+  const toggleKeyword = (keyword: string) => {
+    const newSet = new Set(selectedKeywords);
+    if (newSet.has(keyword)) {
+      newSet.delete(keyword);
+    } else {
+      newSet.add(keyword);
+    }
+    setSelectedKeywords(newSet);
+  };
+
+  const selectAll = () => {
+    setSelectedKeywords(new Set(suggestions.map(s => s.keyword)));
+  };
+
+  const selectNone = () => {
+    setSelectedKeywords(new Set());
+  };
+
+  const updateSuggestion = (keyword: string, field: string, value: string) => {
+    setEditedSuggestions(prev => ({
+      ...prev,
+      [keyword]: { ...prev[keyword], [field]: value }
+    }));
+  };
+
+  const getEffectiveSuggestion = (s: KeywordSuggestion) => {
+    return { ...s, ...editedSuggestions[s.keyword] };
+  };
+
+  const handleApply = () => {
+    const toApply = suggestions
+      .filter(s => selectedKeywords.has(s.keyword))
+      .map(getEffectiveSuggestion);
+    applySuggestions.mutate(toApply);
+  };
+
+  const highConfidence = suggestions.filter(s => s.confidence >= 80);
+  const mediumConfidence = suggestions.filter(s => s.confidence >= 50 && s.confidence < 80);
+  const lowConfidence = suggestions.filter(s => s.confidence < 50);
+
+  return (
+    <div className="space-y-6">
+      <div className={cn(
+        "flex flex-col md:flex-row md:items-center md:justify-between gap-4",
+        embedded && "md:items-start"
+      )}>
+        <div>
+          <h1 className={cn(
+            "font-bold text-foreground flex items-center gap-3",
+            embedded ? "text-xl" : "text-2xl md:text-3xl"
+          )}>
+            <Brain className={cn("text-primary", embedded ? "h-6 w-6" : "h-8 w-8")} />
+            Sugest√µes de Keywords
+          </h1>
+          <p className="text-muted-foreground mt-1">
+            A IA analisa transa√ß√µes pendentes e sugere categorias em lote
+          </p>
+        </div>
+
+        <div className="flex flex-col md:flex-row gap-2">
+          <Button
+            className="bg-primary hover:bg-primary/90 gap-2"
+            onClick={() => analyzeKeywords.mutate()}
+            disabled={analyzeKeywords.isPending}
+            data-testid="button-analyze"
+          >
+            {analyzeKeywords.isPending ? (
+              <Loader2 className="h-4 w-4 animate-spin" />
+            ) : (
+              <Sparkles className="h-4 w-4" />
+            )}
+            {analyzeKeywords.isPending ? "Analisando..." : "Analisar Transa√ß√µes"}
+          </Button>
+          {embedded && (
+            <Link href="/ai-keywords">
+              <Button variant="outline" className="gap-2">
+                Abrir tela completa
+                <ExternalLink className="h-4 w-4" />
+              </Button>
+            </Link>
+          )}
+        </div>
+      </div>
+
+      {!analyzeKeywords.data && !analyzeKeywords.isPending && (
+        <Card className="bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20">
+          <CardContent className="p-8 text-center">
+            <Brain className="h-16 w-16 mx-auto mb-4 text-primary/50" />
+            <h3 className="text-xl font-bold text-foreground mb-2">Pronto para Categorizar em Lote?</h3>
+            <p className="text-muted-foreground max-w-lg mx-auto mb-6">
+              Clique em "Analisar Transa√ß√µes" para que a IA identifique padr√µes nas suas transa√ß√µes
+              pendentes e sugira categorias para cada palavra-chave encontrada.
+            </p>
+            <Button
+              className="bg-primary hover:bg-primary/90 gap-2"
+              onClick={() => analyzeKeywords.mutate()}
+            >
+              <Sparkles className="h-4 w-4" />
+              Come√ßar An√°lise
+            </Button>
+          </CardContent>
+        </Card>
+      )}
+
+      {analyzeKeywords.isPending && (
+        <Card className="bg-white border-0 shadow-sm">
+          <CardContent className="p-8 text-center">
+            <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center">
+              <Loader2 className="h-8 w-8 animate-spin text-primary" />
+            </div>
+            <h3 className="text-lg font-bold text-foreground mb-2">Analisando suas transa√ß√µes...</h3>
+            <p className="text-muted-foreground">
+              A IA est√° identificando padr√µes e sugerindo categorias
+            </p>
+          </CardContent>
+        </Card>
+      )}
+
+      {suggestions.length > 0 && (
+        <>
+          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
+            <Card className="bg-green-50 border-green-200/50">
+              <CardContent className="p-4">
+                <div className="flex items-center gap-2 mb-2">
+                  <CheckCircle2 className="h-4 w-4 text-green-600" />
+                  <span className="text-sm font-semibold text-green-700">Alta confian√ßa</span>
+                </div>
+                <p className="text-2xl font-bold text-green-700">{highConfidence.length}</p>
+                <p className="text-xs text-green-600">‚â• 80% confian√ßa</p>
+              </CardContent>
+            </Card>
+
+            <Card className="bg-amber-50 border-amber-200/50">
+              <CardContent className="p-4">
+                <div className="flex items-center gap-2 mb-2">
+                  <AlertCircle className="h-4 w-4 text-amber-600" />
+                  <span className="text-sm font-semibold text-amber-700">M√©dia confian√ßa</span>
+                </div>
+                <p className="text-2xl font-bold text-amber-700">{mediumConfidence.length}</p>
+                <p className="text-xs text-amber-600">50% a 79%</p>
+              </CardContent>
+            </Card>
+
+            <Card className="bg-rose-50 border-rose-200/50">
+              <CardContent className="p-4">
+                <div className="flex items-center gap-2 mb-2">
+                  <AlertCircle className="h-4 w-4 text-rose-600" />
+                  <span className="text-sm font-semibold text-rose-700">Baixa confian√ßa</span>
+                </div>
+                <p className="text-2xl font-bold text-rose-700">{lowConfidence.length}</p>
+                <p className="text-xs text-rose-600">{"< 50%"}</p>
+              </CardContent>
+            </Card>
+          </div>
+
+          <Card className="bg-white border-0 shadow-sm">
+            <CardContent className="p-6">
+              <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6">
+                <div className="flex items-center gap-2">
+                  <Badge variant="outline" className="text-xs">
+                    {suggestions.length} keywords
+                  </Badge>
+                  <Badge variant="outline" className="text-xs">
+                    {totalTransactions} transa√ß√µes
+                  </Badge>
+                </div>
+
+                <div className="flex items-center gap-2">
+                  <Button size="sm" variant="outline" onClick={selectAll}>
+                    Selecionar tudo
+                  </Button>
+                  <Button size="sm" variant="outline" onClick={selectNone}>
+                    Limpar
+                  </Button>
+                  <Button size="sm" variant="outline" onClick={() => analyzeKeywords.mutate()}>
+                    <RefreshCw className="h-4 w-4 mr-1" />
+                    Reanalisar
+                  </Button>
+                </div>
+              </div>
+
+              <div className="space-y-4">
+                {suggestions.map((suggestion) => {
+                  const effective = getEffectiveSuggestion(suggestion);
+                  const Icon = CATEGORY_ICONS[effective.suggestedCategory] || CreditCard;
+                  const color = CATEGORY_COLORS[effective.suggestedCategory] || "#6b7280";
+                  const isSelected = selectedKeywords.has(suggestion.keyword);
+
+                  return (
+                    <div
+                      key={suggestion.keyword}
+                      className={cn(
+                        "p-4 border rounded-lg transition-all",
+                        isSelected ? "border-primary bg-primary/5" : "border-border"
+                      )}
+                    >
+                      <div className="flex flex-col md:flex-row md:items-center gap-4">
+                        <div className="flex items-center gap-3 flex-1">
+                          <Checkbox
+                            checked={isSelected}
+                            onCheckedChange={() => toggleKeyword(suggestion.keyword)}
+                          />
+
+                          <div className="flex items-center gap-3 flex-1">
+                            <div
+                              className="w-10 h-10 rounded-lg flex items-center justify-center"
+                              style={{ backgroundColor: `${color}20` }}
+                            >
+                              <Icon className="h-5 w-5" style={{ color }} />
+                            </div>
+
+                            <div className="flex-1">
+                              <div className="flex items-center gap-2 mb-1">
+                                <span className="font-bold text-lg">{suggestion.keyword}</span>
+                                <Badge className="text-[10px] bg-muted text-muted-foreground">
+                                  {suggestion.count}x
+                                </Badge>
+                              </div>
+
+                              <div className="flex items-center gap-3 text-xs text-muted-foreground">
+                                <div className="flex items-center gap-1">
+                                  <Zap className="h-3 w-3 text-amber-500" />
+                                  {suggestion.confidence}% confian√ßa
+                                </div>
+                                <div className="flex items-center gap-1">
+                                  <ArrowRight className="h-3 w-3" />
+                                  {suggestion.reason}
+                                </div>
+                              </div>
+                            </div>
+                          </div>
+                        </div>
+
+                        <div className="flex items-center gap-3 flex-wrap">
+                          <Select
+                            value={effective.suggestedCategory}
+                            onValueChange={(v) => updateSuggestion(suggestion.keyword, "suggestedCategory", v)}
+                          >
+                            <SelectTrigger className="w-[160px] h-9">
+                              <SelectValue />
+                            </SelectTrigger>
+                            <SelectContent>
+                              {CATEGORIES.map(cat => (
+                                <SelectItem key={cat} value={cat}>{cat}</SelectItem>
+                              ))}
+                            </SelectContent>
+                          </Select>
+
+                          <Select
+                            value={effective.suggestedType}
+                            onValueChange={(v) => updateSuggestion(suggestion.keyword, "suggestedType", v)}
+                          >
+                            <SelectTrigger className="w-[100px] h-9">
+                              <SelectValue />
+                            </SelectTrigger>
+                            <SelectContent>
+                              <SelectItem value="Despesa">Despesa</SelectItem>
+                              <SelectItem value="Receita">Receita</SelectItem>
+                            </SelectContent>
+                          </Select>
+
+                          <span className="font-bold text-sm w-24 text-right">
+                            {suggestion.total.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
+                          </span>
+                        </div>
+                      </div>
+                    </div>
+                  );
+                })}
+              </div>
+            </CardContent>
+          </Card>
+
+          <Card className="bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20">
+            <CardContent className="p-6">
+              <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
+                <div>
+                  <h3 className="font-bold text-lg text-foreground">Aplicar Sugest√µes Selecionadas</h3>
+                  <p className="text-muted-foreground text-sm mt-1">
+                    Ser√£o criadas {selectedKeywords.size} regras e atualizadas as transa√ß√µes correspondentes
+                  </p>
+                </div>
+                <div className="flex gap-3">
+                  {embedded ? (
+                    <Link href="/ai-keywords">
+                      <Button variant="outline" className="gap-2">
+                        Abrir tela completa
+                        <ChevronRight className="h-4 w-4" />
+                      </Button>
+                    </Link>
+                  ) : (
+                    <Link href="/rules">
+                      <Button variant="outline" className="gap-2">
+                        Ver Regras Existentes
+                        <ChevronRight className="h-4 w-4" />
+                      </Button>
+                    </Link>
+                  )}
+                  <Button
+                    className="bg-primary hover:bg-primary/90 gap-2"
+                    onClick={handleApply}
+                    disabled={selectedKeywords.size === 0 || applySuggestions.isPending}
+                  >
+                    {applySuggestions.isPending ? (
+                      <Loader2 className="h-4 w-4 animate-spin" />
+                    ) : (
+                      <CheckCircle2 className="h-4 w-4" />
+                    )}
+                    Aplicar {selectedKeywords.size} Sugest√µes
+                  </Button>
+                </div>
+              </div>
+            </CardContent>
+          </Card>
+        </>
+      )}
+
+      {analyzeKeywords.data && suggestions.length === 0 && (
+        <Card className="bg-gradient-to-r from-green-50 to-emerald-50 border-green-200/50">
+          <CardContent className="p-8 text-center">
+            <CheckCircle2 className="h-16 w-16 mx-auto mb-4 text-green-500" />
+            <h3 className="text-xl font-bold text-green-900 mb-2">Tudo Categorizado!</h3>
+            <p className="text-green-700 max-w-lg mx-auto mb-6">
+              N√£o h√° transa√ß√µes pendentes de categoriza√ß√£o. Todas as suas transa√ß√µes j√° possuem uma categoria definida.
+            </p>
+            <Link href={embedded ? "/confirm" : "/dashboard"}>
+              <Button className="bg-green-600 hover:bg-green-700 gap-2">
+                {embedded ? "Ver fila de confirma√ß√£o" : "Voltar ao Dashboard"}
+                <ArrowRight className="h-4 w-4" />
+              </Button>
+            </Link>
+          </CardContent>
+        </Card>
+      )}
+    </div>
+  );
+}
diff --git a/client/src/components/calendar/detail-panel.tsx b/client/src/components/calendar/detail-panel.tsx
index 39c5cfc..b7718e1 100644
--- a/client/src/components/calendar/detail-panel.tsx
+++ b/client/src/components/calendar/detail-panel.tsx
@@ -20,6 +20,9 @@ import { Calendar, TrendingUp, TrendingDown } from "lucide-react";
 import { getMerchantIcon } from "@/lib/merchant-icons";
 import { getAccountIcon, IconBadge, TRANSACTION_ICONS } from "@/lib/icons";
 import { cn } from "@/lib/utils";
+import { useQuery } from "@tanstack/react-query";
+import { merchantMetadataApi } from "@/lib/api";
+import { resolveMerchantMetadata } from "@/lib/merchant-metadata";
 
 interface Transaction {
   id: string;
@@ -34,6 +37,7 @@ interface Transaction {
   recurring?: boolean;
   isRefund?: boolean;
   internalTransfer?: boolean;
+  projected?: boolean;
   accountSource?: string;
 }
 
@@ -44,6 +48,11 @@ interface DetailPanelProps {
 }
 
 export function DetailPanel({ mode, selectedDate, transactions }: DetailPanelProps) {
+  const { data: merchantMetadata = [] } = useQuery({
+    queryKey: ["merchant-metadata"],
+    queryFn: merchantMetadataApi.list,
+  });
+
   if (!mode || !selectedDate) {
     return (
       <Card className="sticky top-6">
@@ -134,8 +143,12 @@ export function DetailPanel({ mode, selectedDate, transactions }: DetailPanelPro
             </p>
           ) : (
             filteredTransactions.map((t) => {
-              const merchantInfo = getMerchantIcon(t.descRaw);
+              const metadataOverride = resolveMerchantMetadata(merchantMetadata, t.descRaw);
+              const merchantInfo = metadataOverride || getMerchantIcon(t.descRaw);
               const accountInfo = getAccountIcon(t.accountSource);
+              const merchantLabel =
+                metadataOverride?.friendlyName ||
+                t.descRaw?.split(" -- ")[0]?.replace(/\s+\d{4,}/g, "");
 
               return (
                 <div
@@ -161,7 +174,7 @@ export function DetailPanel({ mode, selectedDate, transactions }: DetailPanelPro
                       {/* Merchant + Badges */}
                       <div className="flex items-center gap-1.5 mb-0.5">
                         <p className="font-medium text-sm truncate">
-                          {t.descRaw?.split(" -- ")[0]?.replace(/\s+\d{4,}/g, "")}
+                          {merchantLabel}
                         </p>
                         {/* Icon badges */}
                         <div className="flex items-center gap-0.5 flex-shrink-0">
@@ -177,6 +190,11 @@ export function DetailPanel({ mode, selectedDate, transactions }: DetailPanelPro
                           {t.internalTransfer && (
                             <IconBadge {...TRANSACTION_ICONS.internal} size="xs" />
                           )}
+                          {t.projected && (
+                            <span className="text-[9px] px-1 py-0.5 rounded-full border border-dashed border-amber-400 text-amber-700">
+                              Projetado
+                            </span>
+                          )}
                         </div>
                       </div>
 
diff --git a/client/src/components/layout/sidebar.tsx b/client/src/components/layout/sidebar.tsx
index 5ed9cc9..06e8cdf 100644
--- a/client/src/components/layout/sidebar.tsx
+++ b/client/src/components/layout/sidebar.tsx
@@ -14,7 +14,6 @@ import {
   Sparkles,
   Calendar,
   Target,
-  Brain,
   Wallet,
   Receipt,
   Bell
@@ -22,7 +21,7 @@ import {
 import { useState } from "react";
 import { Button } from "@/components/ui/button";
 import { useQuery } from "@tanstack/react-query";
-import { transactionsApi } from "@/lib/api";
+import { transactionsApi, notificationsApi } from "@/lib/api";
 import { useMonth } from "@/lib/month-context";
 import { Tooltip, TooltipContent, TooltipTrigger } from "@/components/ui/tooltip";
 
@@ -46,6 +45,7 @@ const NAV_CLUSTERS = [
         label: "Notifica√ß√µes",
         icon: Bell,
         href: "/notifications",
+        badgeKey: "notifications",
         description: "Alertas e mensagens"
       },
     ]
@@ -74,7 +74,7 @@ const NAV_CLUSTERS = [
         label: "Confirmar",
         icon: CheckCircle2,
         href: "/confirm",
-        showBadge: true,
+        badgeKey: "confirm",
         description: "Transa√ß√µes pendentes"
       },
       {
@@ -95,16 +95,10 @@ const NAV_CLUSTERS = [
         description: "Categoriza√ß√£o autom√°tica"
       },
       {
-        label: "Dicion√°rio",
+        label: "Categorias",
         icon: BookOpen,
-        href: "/merchant-dictionary",
-        description: "Aliases de comerciantes"
-      },
-      {
-        label: "IA Keywords",
-        icon: Brain,
-        href: "/ai-keywords",
-        description: "An√°lise inteligente em lote"
+        href: "/categories",
+        description: "Hierarquia N1-N3"
       },
     ]
   },
@@ -151,6 +145,13 @@ export function Sidebar() {
 
   const pendingCount = confirmQueue.length;
 
+  const { data: notifications = [] } = useQuery({
+    queryKey: ["notifications"],
+    queryFn: () => notificationsApi.list(),
+  });
+
+  const unreadNotifications = notifications.filter((n: any) => !n.isRead).length;
+
   const prevMonth = () => {
     const [year, m] = month.split("-").map(Number);
     const newDate = new Date(year, m - 2, 1);
@@ -263,7 +264,11 @@ export function Sidebar() {
               <div className="space-y-1">
                 {cluster.items.map((item) => {
                   const isActive = location === item.href;
-                  const badge = item.showBadge && pendingCount > 0 ? pendingCount : null;
+                  const badge = (() => {
+                    if (item.badgeKey === "confirm") return pendingCount > 0 ? pendingCount : null;
+                    if (item.badgeKey === "notifications") return unreadNotifications > 0 ? unreadNotifications : null;
+                    return null;
+                  })();
 
                   const NavLink = (
                     <Link
@@ -341,7 +346,7 @@ export function Sidebar() {
                     <Settings className="h-5 w-5" />
                   </Link>
                 </TooltipTrigger>
-                <TooltipContent side="right">Configuracoes</TooltipContent>
+                <TooltipContent side="right">Configura√ß√µes</TooltipContent>
               </Tooltip>
               <Tooltip delayDuration={0}>
                 <TooltipTrigger asChild>
@@ -369,7 +374,7 @@ export function Sidebar() {
                 data-testid="nav-settings"
               >
                 <Settings className="h-5 w-5" />
-                Configuracoes
+                Configura√ß√µes
               </Link>
               <Link
                 href="/login"
diff --git a/client/src/components/layout/top-nav.tsx b/client/src/components/layout/top-nav.tsx
index 14c7d86..4589813 100644
--- a/client/src/components/layout/top-nav.tsx
+++ b/client/src/components/layout/top-nav.tsx
@@ -8,8 +8,8 @@ import { useMonth } from "@/lib/month-context";
 
 const NAV_TABS = [
   { label: "Painel", href: "/dashboard" },
-  { label: "Transacoes", href: "/confirm" },
-  { label: "Orcamento", href: "/rules" },
+  { label: "Transa√ß√µes", href: "/confirm" },
+  { label: "Or√ßamento", href: "/rules" },
 ];
 
 export function TopNav() {
@@ -78,14 +78,14 @@ export function TopNav() {
 
           <div className="flex items-center gap-3">
             <div className="hidden sm:flex items-center gap-1 bg-muted/50 rounded-lg p-1">
-              <Button variant="ghost" size="icon" className="h-8 w-8" onClick={prevMonth}>
+              <Button variant="ghost" size="icon" className="h-8 w-8" onClick={prevMonth} aria-label="M√™s anterior">
                 <ChevronLeft className="h-4 w-4" />
               </Button>
               <div className="flex items-center gap-2 px-2 min-w-[140px] justify-center">
                 <Calendar className="h-4 w-4 text-primary" />
                 <span className="text-sm font-medium">{formatMonth(month)}</span>
               </div>
-              <Button variant="ghost" size="icon" className="h-8 w-8" onClick={nextMonth}>
+              <Button variant="ghost" size="icon" className="h-8 w-8" onClick={nextMonth} aria-label="Pr√≥ximo m√™s">
                 <ChevronRight className="h-4 w-4" />
               </Button>
             </div>
@@ -97,12 +97,12 @@ export function TopNav() {
               </Button>
             </Link>
 
-            <Button variant="ghost" size="icon" className="relative">
+            <Button variant="ghost" size="icon" className="relative" aria-label="Notifica√ß√µes">
               <Bell className="h-5 w-5" />
             </Button>
 
             <Link href="/settings">
-              <Button variant="ghost" size="icon" className="rounded-full bg-primary/10">
+              <Button variant="ghost" size="icon" className="rounded-full bg-primary/10" aria-label="Configura√ß√µes">
                 <User className="h-5 w-5 text-primary" />
               </Button>
             </Link>
diff --git a/client/src/components/transaction-detail-modal.tsx b/client/src/components/transaction-detail-modal.tsx
index d2419f1..821f9bb 100644
--- a/client/src/components/transaction-detail-modal.tsx
+++ b/client/src/components/transaction-detail-modal.tsx
@@ -17,7 +17,11 @@ import { cn } from "@/lib/utils";
 import { format } from "date-fns";
 import { ptBR } from "date-fns/locale";
 import { getMerchantIcon, getCategoryIcon } from "@/lib/merchant-icons";
+import { useQuery } from "@tanstack/react-query";
+import { merchantMetadataApi } from "@/lib/api";
+import { resolveMerchantMetadata } from "@/lib/merchant-metadata";
 import { AccountBadge } from "@/components/account-badge";
+import { Link } from "wouter";
 import {
   Calendar,
   CreditCard,
@@ -50,14 +54,37 @@ export function TransactionDetailModal({
 }: TransactionDetailModalProps) {
   if (!transaction) return null;
 
+  const { data: merchantMetadata = [] } = useQuery({
+    queryKey: ["merchant-metadata"],
+    queryFn: merchantMetadataApi.list,
+  });
+
   // Get merchant icon or fallback to category icon
-  const merchantInfo = getMerchantIcon(transaction.descRaw);
+  const metadataOverride = resolveMerchantMetadata(merchantMetadata, transaction.descRaw);
+  const merchantInfo = metadataOverride || getMerchantIcon(transaction.descRaw);
   const MerchantIcon = merchantInfo?.icon || getCategoryIcon(transaction.category1);
   const iconColor = merchantInfo?.color || "#6b7280";
 
   // Split description parts (if formatted as "Main -- Additional")
   const [mainDesc, ...additionalParts] = (transaction.descRaw || "").split(" -- ");
   const additionalDesc = additionalParts.join(" -- ");
+  const merchantLabel = metadataOverride?.friendlyName || transaction.merchantAlias || mainDesc;
+  const keywordSeed = merchantLabel
+    ?.toLowerCase()
+    .replace(/\d+/g, "")
+    .replace(/\s+/g, " ")
+    .trim();
+  const ruleQuery = new URLSearchParams({
+    prefill: "1",
+    name: merchantLabel ? `Regra ${merchantLabel}` : "Nova regra",
+    keywords: keywordSeed || "",
+    category1: transaction.category1 || "",
+    category2: transaction.category2 || "",
+    category3: transaction.category3 || "",
+    type: transaction.type || "",
+    fixVar: transaction.fixVar || "",
+  }).toString();
+  const ruleLink = `/rules?${ruleQuery}`;
 
   const CATEGORY_COLORS: Record<string, string> = {
     "Mercado": "#22c55e",
@@ -94,6 +121,11 @@ export function TransactionDetailModal({
               <p className="text-sm text-muted-foreground mt-1">{additionalDesc}</p>
             )}
             <div className="flex items-center gap-2 mt-2">
+              {metadataOverride?.friendlyName && (
+                <Badge variant="outline" className="text-xs">
+                  {metadataOverride.friendlyName}
+                </Badge>
+              )}
               {merchantInfo?.merchantName && (
                 <Badge variant="outline" className="text-xs capitalize">
                   {merchantInfo.merchantName.replace(/_/g, " ")}
@@ -253,6 +285,17 @@ export function TransactionDetailModal({
               Editar
             </Button>
           )}
+          <Link href={ruleLink}>
+            <Button
+              variant="outline"
+              size="sm"
+              className="gap-2"
+              onClick={() => onClose()}
+            >
+              <Tag className="w-4 h-4" />
+              Criar regra
+            </Button>
+          </Link>
           <Button variant="outline" size="sm" className="gap-2">
             <Copy className="w-4 h-4" />
             Duplicar
diff --git a/client/src/lib/api.ts b/client/src/lib/api.ts
index 15a4765..59d586e 100644
--- a/client/src/lib/api.ts
+++ b/client/src/lib/api.ts
@@ -94,11 +94,22 @@ export const accountsApi = {
     fetchApi<void>(`/accounts/${id}`, {
       method: "DELETE",
     }),
+  balance: (id: string, params?: { startDate?: string; endDate?: string }) => {
+    const query = new URLSearchParams();
+    if (params?.startDate) query.append("startDate", params.startDate);
+    if (params?.endDate) query.append("endDate", params.endDate);
+    return fetchApi<{ balance: number; currency: string; transactionCount: number }>(
+      `/accounts/${id}/balance${query.toString() ? `?${query.toString()}` : ""}`
+    );
+  },
 };
 
 // Uploads
 export const uploadsApi = {
   list: () => fetchApi<any[]>("/uploads"),
+  lastByAccount: () => fetchApi<any[]>("/uploads/last-by-account"),
+  getErrors: (id: string) =>
+    fetchApi<{ uploadId: string; errors: any[]; count: number }>(`/uploads/${id}/errors`),
   process: (filename: string, csvContent: string) =>
     fetchApi<{
       success: boolean;
@@ -130,9 +141,57 @@ export const transactionsApi = {
     }),
 };
 
+// Calendar Events
+export const calendarEventsApi = {
+  list: () => fetchApi<any[]>("/calendar-events"),
+  get: (id: string) => fetchApi<any>(`/calendar-events/${id}`),
+  delete: (id: string) =>
+    fetchApi<{ success: boolean }>(`/calendar-events/${id}`, {
+      method: "DELETE",
+    }),
+};
+
+// Notifications
+export const notificationsApi = {
+  list: (limit?: number) => fetchApi<any[]>(`/notifications${limit ? `?limit=${limit}` : ""}`),
+  markRead: (id: string, isRead: boolean) =>
+    fetchApi<any>(`/notifications/${id}`, {
+      method: "PATCH",
+      body: JSON.stringify({ isRead }),
+    }),
+  delete: (id: string) =>
+    fetchApi<void>(`/notifications/${id}`, {
+      method: "DELETE",
+    }),
+};
+
+// Merchant Metadata
+export const merchantMetadataApi = {
+  list: () => fetchApi<any[]>("/merchant-metadata"),
+  create: (data: any) =>
+    fetchApi<any>("/merchant-metadata", {
+      method: "POST",
+      body: JSON.stringify(data),
+    }),
+  update: (id: string, data: any) =>
+    fetchApi<any>(`/merchant-metadata/${id}`, {
+      method: "PUT",
+      body: JSON.stringify(data),
+    }),
+  delete: (id: string) =>
+    fetchApi<void>(`/merchant-metadata/${id}`, {
+      method: "DELETE",
+    }),
+};
+
 // Rules
 export const rulesApi = {
   list: () => fetchApi<any[]>("/rules"),
+  preview: (data: { keywords: string; scope?: "pending" | "all"; month?: string }) =>
+    fetchApi<{ count: number; samples: string[]; scanned: number }>("/rules/preview", {
+      method: "POST",
+      body: JSON.stringify(data),
+    }),
   create: (data: any) =>
     fetchApi<any>("/rules", {
       method: "POST",
@@ -161,6 +220,47 @@ export const rulesApi = {
     }),
 };
 
+// Categories
+export const categoriesApi = {
+  list: () => fetchApi<any[]>("/categories"),
+  create: (data: { category1: string; category2: string; category3?: string | null }) =>
+    fetchApi<any>("/categories", {
+      method: "POST",
+      body: JSON.stringify(data),
+    }),
+  update: (id: string, data: { category1?: string; category2?: string; category3?: string | null }) =>
+    fetchApi<any>(`/categories/${id}`, {
+      method: "PATCH",
+      body: JSON.stringify(data),
+    }),
+  delete: (id: string) =>
+    fetchApi<{ success: boolean }>(`/categories/${id}`, {
+      method: "DELETE",
+    }),
+};
+
+// AI Keywords
+export const aiKeywordsApi = {
+  analyze: () => fetchApi<any>("/ai/analyze-keywords", { method: "POST" }),
+  apply: (suggestions: any[]) =>
+    fetchApi<any>("/ai/apply-suggestions", {
+      method: "POST",
+      body: JSON.stringify({ suggestions }),
+    }),
+  merchantSuggestions: () => fetchApi<any>("/ai/merchant-suggestions", { method: "POST" }),
+};
+
+// AI Chat
+export const aiChatApi = {
+  listConversations: () => fetchApi<any[]>("/ai/conversations"),
+  listMessages: (conversationId: string) => fetchApi<any[]>(`/ai/conversations/${conversationId}/messages`),
+  chat: (data: { message: string; conversationId?: string; context?: { screen?: string; month?: string } }) =>
+    fetchApi<any>("/ai/chat", {
+      method: "POST",
+      body: JSON.stringify(data),
+    }),
+};
+
 // Merchant Dictionary
 export const merchantDictionaryApi = {
   // Merchant Descriptions
@@ -177,6 +277,11 @@ export const merchantDictionaryApi = {
       method: "POST",
       body: JSON.stringify(data),
     }),
+  bulkUpsertDescriptions: (items: Array<{ source: string; keyDesc: string; aliasDesc: string }>) =>
+    fetchApi<any>("/merchant-descriptions/bulk", {
+      method: "POST",
+      body: JSON.stringify({ items }),
+    }),
   updateDescription: (id: string, data: { aliasDesc: string }) =>
     fetchApi<any>(`/merchant-descriptions/${id}`, {
       method: "PATCH",
@@ -188,6 +293,7 @@ export const merchantDictionaryApi = {
     }),
   exportDescriptions: () =>
     fetchApi<any[]>("/merchant-descriptions/export"),
+  suggestAliases: () => aiKeywordsApi.merchantSuggestions(),
 
   // Merchant Icons
   listIcons: (filters?: { needsFetch?: boolean; search?: string }) => {
diff --git a/client/src/lib/merchant-metadata.ts b/client/src/lib/merchant-metadata.ts
new file mode 100644
index 0000000..bf9c96d
--- /dev/null
+++ b/client/src/lib/merchant-metadata.ts
@@ -0,0 +1,62 @@
+import {
+  LucideIcon,
+  ShoppingCart,
+  CreditCard,
+  Coffee,
+  Utensils,
+  Plane,
+  Music,
+  Film,
+  Car,
+  Home,
+  Heart,
+  Zap,
+  Package,
+  Smartphone,
+} from "lucide-react";
+
+const MERCHANT_METADATA_ICONS: Record<string, LucideIcon> = {
+  "shopping-cart": ShoppingCart,
+  "credit-card": CreditCard,
+  "coffee": Coffee,
+  "utensils": Utensils,
+  "plane": Plane,
+  "music": Music,
+  "film": Film,
+  "car": Car,
+  "home": Home,
+  "heart": Heart,
+  "zap": Zap,
+  "package": Package,
+  "smartphone": Smartphone,
+};
+
+export interface MerchantMetadataMatch {
+  icon: LucideIcon;
+  color: string;
+  friendlyName?: string;
+  merchantName?: string;
+}
+
+export function resolveMerchantMetadata(
+  metadata: any[],
+  description?: string
+): MerchantMetadataMatch | undefined {
+  if (!description || metadata.length === 0) return undefined;
+
+  const normalized = description.toUpperCase();
+
+  for (const item of metadata) {
+    const pattern = (item.pattern || "").toUpperCase().trim();
+    if (!pattern) continue;
+    if (normalized.includes(pattern)) {
+      return {
+        icon: MERCHANT_METADATA_ICONS[item.icon] || CreditCard,
+        color: item.color || "#6b7280",
+        friendlyName: item.friendlyName,
+      };
+    }
+  }
+
+  return undefined;
+}
diff --git a/client/src/pages/accounts.tsx b/client/src/pages/accounts.tsx
index 3b2747b..b874e10 100644
--- a/client/src/pages/accounts.tsx
+++ b/client/src/pages/accounts.tsx
@@ -3,17 +3,19 @@ import { Button } from "@/components/ui/button";
 import { Card, CardContent } from "@/components/ui/card";
 import { Input } from "@/components/ui/input";
 import { Badge } from "@/components/ui/badge";
-import { Plus, Search, Archive, Loader2, CreditCard, Landmark, Wallet, Coins, Edit2, CircleCheck, AlertTriangle, TrendingUp, Calendar as CalendarIcon } from "lucide-react";
+import { Plus, Search, Archive, Loader2, CreditCard, Landmark, Wallet, Coins, Edit2, CircleCheck, TrendingUp, Calendar as CalendarIcon } from "lucide-react";
 import { getAccountIcon } from "@/lib/icons";
-import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
+import { useQuery, useMutation, useQueryClient, useQueries } from "@tanstack/react-query";
 import { accountsApi } from "@/lib/api";
 import { useToast } from "@/hooks/use-toast";
 import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from "@/components/ui/dialog";
 import { Label } from "@/components/ui/label";
 import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
-import { useState } from "react";
+import { useEffect, useState } from "react";
 import { cn } from "@/lib/utils";
 import { CardGridSkeleton } from "@/components/skeletons/card-grid-skeleton";
+import { format } from "date-fns";
+import { Link } from "wouter";
 
 const ACCOUNT_TYPE_LABELS: Record<string, string> = {
   credit_card: "Cart√£o de Cr√©dito",
@@ -70,12 +72,38 @@ export default function AccountsPage() {
   const [search, setSearch] = useState("");
   const [editingAccount, setEditingAccount] = useState<any>(null);
   const [formData, setFormData] = useState<AccountFormData>(EMPTY_ACCOUNT);
+  const [balancesUpdatedAt, setBalancesUpdatedAt] = useState<Date | null>(null);
 
   const { data: accounts = [], isLoading } = useQuery({
     queryKey: ["accounts"],
     queryFn: accountsApi.list,
   });
 
+  const balanceQueries = useQueries({
+    queries: accounts.map((account: any) => ({
+      queryKey: ["account-balance", account.id],
+      queryFn: () => accountsApi.balance(account.id),
+      enabled: !!account.id,
+    })),
+  });
+
+  const balancesById = balanceQueries.reduce<Record<string, { balance: number; currency: string; transactionCount: number }>>(
+    (map, query, index) => {
+      const account = accounts[index];
+      if (account && query.data) {
+        map[account.id] = query.data;
+      }
+      return map;
+    },
+    {}
+  );
+
+  useEffect(() => {
+    if (Object.keys(balancesById).length > 0) {
+      setBalancesUpdatedAt(new Date());
+    }
+  }, [balancesById]);
+
   const createMutation = useMutation({
     mutationFn: accountsApi.create,
     onSuccess: () => {
@@ -202,8 +230,14 @@ export default function AccountsPage() {
                       const bankAccounts = accounts.filter((a: any) => a.type === "bank_account");
                       const creditCards = accounts.filter((a: any) => a.type === "credit_card");
 
-                      const bankBalance = bankAccounts.reduce((sum: number, a: any) => sum + (a.balance || 0), 0);
-                      const cardUsed = creditCards.reduce((sum: number, a: any) => sum + Math.abs(a.balance || 0), 0);
+                      const bankBalance = bankAccounts.reduce((sum: number, a: any) => {
+                        const balance = balancesById[a.id]?.balance ?? 0;
+                        return sum + balance;
+                      }, 0);
+                      const cardUsed = creditCards.reduce((sum: number, a: any) => {
+                        const balance = balancesById[a.id]?.balance ?? 0;
+                        return sum + Math.abs(balance);
+                      }, 0);
                       const netPosition = bankBalance - cardUsed;
 
                       return netPosition.toLocaleString("pt-BR", { style: "currency", currency: "EUR" });
@@ -213,22 +247,17 @@ export default function AccountsPage() {
                     Saldo banc√°rio menos saldos dos cart√µes
                   </p>
                 </div>
-                {(() => {
-                  const hasStaleBalance = accounts.some((a: any) => {
-                    if (!a.balanceUpdatedAt) return false;
-                    const daysSince = Math.floor(
-                      (new Date().getTime() - new Date(a.balanceUpdatedAt).getTime()) / (1000 * 60 * 60 * 24)
-                    );
-                    return daysSince > 7;
-                  });
-
-                  return hasStaleBalance && (
-                    <div className="flex items-center gap-2 text-amber-600 bg-amber-100 px-3 py-1.5 rounded-lg">
-                      <AlertTriangle className="h-4 w-4" />
-                      <span className="text-xs font-medium">Saldos desatualizados</span>
-                    </div>
-                  );
-                })()}
+                <div className="flex flex-col items-end gap-1 text-emerald-600 bg-emerald-100 px-3 py-1.5 rounded-lg">
+                  <div className="flex items-center gap-2">
+                    <CircleCheck className="h-4 w-4" />
+                    <span className="text-xs font-medium">Saldo calculado</span>
+                  </div>
+                  {balancesUpdatedAt && (
+                    <span className="text-[10px] text-emerald-700">
+                      Atualizado {format(balancesUpdatedAt, "HH:mm")}
+                    </span>
+                  )}
+                </div>
               </div>
             </CardContent>
           </Card>
@@ -274,6 +303,7 @@ export default function AccountsPage() {
                           size="icon"
                           variant="ghost"
                           onClick={() => openEditDialog(account)}
+                          aria-label="Editar conta"
                         >
                           <Edit2 className="h-4 w-4" />
                         </Button>
@@ -281,6 +311,7 @@ export default function AccountsPage() {
                           size="icon"
                           variant="ghost"
                           onClick={() => handleArchive(account.id)}
+                          aria-label="Arquivar conta"
                         >
                           <Archive className="h-4 w-4" />
                         </Button>
@@ -305,27 +336,29 @@ export default function AccountsPage() {
                     </div>
 
                     {/* Balance */}
-                    {account.balance !== undefined && account.balance !== null && (
+                    {balancesById[account.id] ? (
                       <div className="mt-3 pt-3 border-t">
                         <div className="flex items-center justify-between mb-1">
                           <span className="text-xs text-muted-foreground">Saldo</span>
-                          {account.balanceUpdatedAt && (
-                            <span className="text-[10px] text-muted-foreground">
-                              Atualizado em {new Date(account.balanceUpdatedAt).toLocaleDateString("pt-BR")}
-                            </span>
-                          )}
+                          <span className="text-[10px] text-muted-foreground">
+                            Baseado em {balancesById[account.id]?.transactionCount || 0} transa√ß√µes
+                          </span>
                         </div>
                         <p className={cn(
                           "text-xl font-bold",
-                          account.balance >= 0 ? "text-emerald-600" : "text-rose-600"
+                          (balancesById[account.id]?.balance || 0) >= 0 ? "text-emerald-600" : "text-rose-600"
                         )}>
-                          {account.balance.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
+                          {(balancesById[account.id]?.balance || 0).toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
                         </p>
                       </div>
+                    ) : (
+                      <div className="mt-3 pt-3 border-t text-xs text-muted-foreground">
+                        Saldo indispon√≠vel (sem transa√ß√µes)
+                      </div>
                     )}
 
                     {/* Credit Card: Limit Bar + Available to Spend */}
-                    {account.type === "credit_card" && account.limit && (
+                    {account.type === "credit_card" && account.limit && balancesById[account.id] && (
                       <div className="mt-3 pt-3 border-t space-y-2">
                         <div className="flex items-center justify-between text-xs">
                           <span className="text-muted-foreground">Limite</span>
@@ -336,7 +369,7 @@ export default function AccountsPage() {
 
                         {/* Limit Bar */}
                         {(() => {
-                          const used = Math.abs(account.balance || 0);
+                          const used = Math.abs(balancesById[account.id]?.balance || 0);
                           const available = Math.max(0, account.limit - used);
                           const usedPercent = account.limit > 0 ? (used / account.limit) * 100 : 0;
 
@@ -383,6 +416,25 @@ export default function AccountsPage() {
         )}
 
         {/* Create/Edit Dialog */}
+        <Card className="bg-gradient-to-r from-slate-50 to-primary/5 border-primary/10 shadow-sm">
+          <CardContent className="p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+            <div>
+              <h3 className="font-semibold text-foreground">Pr√≥ximo passo</h3>
+              <p className="text-sm text-muted-foreground mt-1">
+                Revise transa√ß√µes por conta ou importe novos extratos para manter os saldos atualizados.
+              </p>
+            </div>
+            <div className="flex gap-2">
+              <Link href="/transactions">
+                <Button variant="outline">Ver transa√ß√µes</Button>
+              </Link>
+              <Link href="/uploads">
+                <Button className="bg-primary hover:bg-primary/90">Importar extrato</Button>
+              </Link>
+            </div>
+          </CardContent>
+        </Card>
+
         <Dialog open={isOpen} onOpenChange={setIsOpen}>
           <DialogContent className="sm:max-w-[500px]">
             <DialogHeader>
diff --git a/client/src/pages/ai-keywords.tsx b/client/src/pages/ai-keywords.tsx
index 81e0e96..d32bb7c 100644
--- a/client/src/pages/ai-keywords.tsx
+++ b/client/src/pages/ai-keywords.tsx
@@ -1,427 +1,10 @@
 import AppLayout from "@/components/layout/app-layout";
-import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
-import { Button } from "@/components/ui/button";
-import { Badge } from "@/components/ui/badge";
-import { Progress } from "@/components/ui/progress";
-import { Checkbox } from "@/components/ui/checkbox";
-import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
-import { cn } from "@/lib/utils";
-import { 
-  Sparkles, 
-  Brain, 
-  CheckCircle2, 
-  AlertCircle,
-  Loader2,
-  Home,
-  ShoppingCart,
-  Car,
-  Heart,
-  Coffee,
-  Package,
-  Film,
-  CreditCard,
-  ChevronRight,
-  RefreshCw,
-  Zap,
-  ArrowRight
-} from "lucide-react";
-import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
-import { useState } from "react";
-import { useToast } from "@/hooks/use-toast";
-import { Link } from "wouter";
-
-const CATEGORY_ICONS: Record<string, any> = {
-  "Moradia": Home,
-  "Mercado": ShoppingCart,
-  "Transporte": Car,
-  "Sa√∫de": Heart,
-  "Lazer": Film,
-  "Compras Online": Package,
-  "Outros": CreditCard
-};
-
-const CATEGORY_COLORS: Record<string, string> = {
-  "Mercado": "#22c55e",
-  "Moradia": "#f97316",
-  "Transporte": "#3b82f6",
-  "Lazer": "#a855f7",
-  "Sa√∫de": "#ef4444",
-  "Compras Online": "#ec4899",
-  "Receitas": "#10b981",
-  "Interno": "#475569",
-  "Outros": "#6b7280"
-};
-
-const CATEGORIES = ["Moradia", "Mercado", "Compras Online", "Transporte", "Sa√∫de", "Lazer", "Receitas", "Interno", "Outros"];
-
-interface KeywordSuggestion {
-  keyword: string;
-  suggestedCategory: string;
-  suggestedType: "Despesa" | "Receita";
-  suggestedFixVar: "Fixo" | "Vari√°vel";
-  confidence: number;
-  reason: string;
-  count: number;
-  total: number;
-  samples: string[];
-}
+import { AIKeywordsPanel } from "@/components/ai-keywords-panel";
 
 export default function AIKeywordsPage() {
-  const { toast } = useToast();
-  const queryClient = useQueryClient();
-  const [selectedKeywords, setSelectedKeywords] = useState<Set<string>>(new Set());
-  const [editedSuggestions, setEditedSuggestions] = useState<Record<string, Partial<KeywordSuggestion>>>({});
-
-  const analyzeKeywords = useMutation({
-    mutationFn: async () => {
-      const res = await fetch("/api/ai/analyze-keywords", { method: "POST" });
-      if (!res.ok) throw new Error("Erro na an√°lise");
-      return res.json();
-    },
-    onSuccess: (data) => {
-      toast({ title: `${data.suggestions?.length || 0} palavras-chave analisadas` });
-      setSelectedKeywords(new Set(data.suggestions?.map((s: any) => s.keyword) || []));
-    },
-    onError: () => {
-      toast({ title: "Erro ao analisar transa√ß√µes", variant: "destructive" });
-    }
-  });
-
-  const applySuggestions = useMutation({
-    mutationFn: async (suggestions: KeywordSuggestion[]) => {
-      const res = await fetch("/api/ai/apply-suggestions", {
-        method: "POST",
-        headers: { "Content-Type": "application/json" },
-        body: JSON.stringify({ suggestions })
-      });
-      if (!res.ok) throw new Error("Erro ao aplicar");
-      return res.json();
-    },
-    onSuccess: (data) => {
-      toast({ 
-        title: "Regras criadas com sucesso!", 
-        description: `${data.rulesCreated} regras criadas, ${data.transactionsUpdated} transa√ß√µes atualizadas` 
-      });
-      queryClient.invalidateQueries({ queryKey: ["confirm-queue"] });
-      queryClient.invalidateQueries({ queryKey: ["rules"] });
-    },
-    onError: () => {
-      toast({ title: "Erro ao criar regras", variant: "destructive" });
-    }
-  });
-
-  const suggestions = (analyzeKeywords.data?.suggestions || []) as KeywordSuggestion[];
-  const totalTransactions = analyzeKeywords.data?.total || 0;
-
-  const toggleKeyword = (keyword: string) => {
-    const newSet = new Set(selectedKeywords);
-    if (newSet.has(keyword)) {
-      newSet.delete(keyword);
-    } else {
-      newSet.add(keyword);
-    }
-    setSelectedKeywords(newSet);
-  };
-
-  const selectAll = () => {
-    setSelectedKeywords(new Set(suggestions.map(s => s.keyword)));
-  };
-
-  const selectNone = () => {
-    setSelectedKeywords(new Set());
-  };
-
-  const updateSuggestion = (keyword: string, field: string, value: string) => {
-    setEditedSuggestions(prev => ({
-      ...prev,
-      [keyword]: { ...prev[keyword], [field]: value }
-    }));
-  };
-
-  const getEffectiveSuggestion = (s: KeywordSuggestion) => {
-    return { ...s, ...editedSuggestions[s.keyword] };
-  };
-
-  const handleApply = () => {
-    const toApply = suggestions
-      .filter(s => selectedKeywords.has(s.keyword))
-      .map(getEffectiveSuggestion);
-    applySuggestions.mutate(toApply);
-  };
-
-  const highConfidence = suggestions.filter(s => s.confidence >= 80);
-  const mediumConfidence = suggestions.filter(s => s.confidence >= 50 && s.confidence < 80);
-  const lowConfidence = suggestions.filter(s => s.confidence < 50);
-
   return (
     <AppLayout>
-      <div className="space-y-6">
-        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
-          <div>
-            <h1 className="text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3">
-              <Brain className="h-8 w-8 text-primary" />
-              An√°lise Inteligente de Keywords
-            </h1>
-            <p className="text-muted-foreground mt-1">
-              A IA analisa suas transa√ß√µes pendentes e sugere categorias em lote
-            </p>
-          </div>
-          
-          <Button 
-            className="bg-primary hover:bg-primary/90 gap-2"
-            onClick={() => analyzeKeywords.mutate()}
-            disabled={analyzeKeywords.isPending}
-            data-testid="button-analyze"
-          >
-            {analyzeKeywords.isPending ? (
-              <Loader2 className="h-4 w-4 animate-spin" />
-            ) : (
-              <Sparkles className="h-4 w-4" />
-            )}
-            {analyzeKeywords.isPending ? "Analisando..." : "Analisar Transa√ß√µes"}
-          </Button>
-        </div>
-
-        {!analyzeKeywords.data && !analyzeKeywords.isPending && (
-          <Card className="bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20">
-            <CardContent className="p-8 text-center">
-              <Brain className="h-16 w-16 mx-auto mb-4 text-primary/50" />
-              <h3 className="text-xl font-bold text-foreground mb-2">Pronto para Categorizar em Lote?</h3>
-              <p className="text-muted-foreground max-w-lg mx-auto mb-6">
-                Clique em "Analisar Transa√ß√µes" para que a IA identifique padr√µes nas suas transa√ß√µes 
-                pendentes e sugira categorias para cada palavra-chave encontrada.
-              </p>
-              <Button 
-                className="bg-primary hover:bg-primary/90 gap-2"
-                onClick={() => analyzeKeywords.mutate()}
-              >
-                <Sparkles className="h-4 w-4" />
-                Come√ßar An√°lise
-              </Button>
-            </CardContent>
-          </Card>
-        )}
-
-        {analyzeKeywords.isPending && (
-          <Card className="bg-white border-0 shadow-sm">
-            <CardContent className="p-8 text-center">
-              <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center">
-                <Loader2 className="h-8 w-8 animate-spin text-primary" />
-              </div>
-              <h3 className="text-lg font-bold text-foreground mb-2">Analisando suas transa√ß√µes...</h3>
-              <p className="text-muted-foreground">
-                A IA est√° identificando padr√µes e sugerindo categorias
-              </p>
-            </CardContent>
-          </Card>
-        )}
-
-        {suggestions.length > 0 && (
-          <>
-            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
-              <Card className="bg-white border-0 shadow-sm">
-                <CardContent className="p-5">
-                  <div className="flex items-center justify-between mb-2">
-                    <span className="text-xs font-semibold uppercase tracking-wider text-muted-foreground">Total Analisado</span>
-                    <Brain className="h-4 w-4 text-primary" />
-                  </div>
-                  <p className="text-2xl font-bold text-foreground">{totalTransactions}</p>
-                  <p className="text-xs text-muted-foreground mt-1">transa√ß√µes</p>
-                </CardContent>
-              </Card>
-
-              <Card className="bg-gradient-to-r from-green-50 to-emerald-50 border-green-200/50">
-                <CardContent className="p-5">
-                  <div className="flex items-center justify-between mb-2">
-                    <span className="text-xs font-semibold uppercase tracking-wider text-green-700">Alta Confian√ßa</span>
-                    <CheckCircle2 className="h-4 w-4 text-green-600" />
-                  </div>
-                  <p className="text-2xl font-bold text-green-700">{highConfidence.length}</p>
-                  <p className="text-xs text-green-600 mt-1">‚â•80% confian√ßa</p>
-                </CardContent>
-              </Card>
-
-              <Card className="bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200/50">
-                <CardContent className="p-5">
-                  <div className="flex items-center justify-between mb-2">
-                    <span className="text-xs font-semibold uppercase tracking-wider text-amber-700">M√©dia Confian√ßa</span>
-                    <AlertCircle className="h-4 w-4 text-amber-600" />
-                  </div>
-                  <p className="text-2xl font-bold text-amber-700">{mediumConfidence.length}</p>
-                  <p className="text-xs text-amber-600 mt-1">50-79% confian√ßa</p>
-                </CardContent>
-              </Card>
-
-              <Card className="bg-white border-0 shadow-sm">
-                <CardContent className="p-5">
-                  <div className="flex items-center justify-between mb-2">
-                    <span className="text-xs font-semibold uppercase tracking-wider text-muted-foreground">Selecionadas</span>
-                    <Zap className="h-4 w-4 text-primary" />
-                  </div>
-                  <p className="text-2xl font-bold text-foreground">{selectedKeywords.size}</p>
-                  <p className="text-xs text-muted-foreground mt-1">de {suggestions.length} keywords</p>
-                </CardContent>
-              </Card>
-            </div>
-
-            <Card className="bg-white border-0 shadow-sm">
-              <CardHeader className="border-b flex flex-row items-center justify-between">
-                <CardTitle className="text-lg font-semibold">Sugest√µes da IA</CardTitle>
-                <div className="flex items-center gap-3">
-                  <Button variant="ghost" size="sm" onClick={selectAll}>Selecionar Todas</Button>
-                  <Button variant="ghost" size="sm" onClick={selectNone}>Limpar Sele√ß√£o</Button>
-                </div>
-              </CardHeader>
-              <CardContent className="p-0">
-                <div className="divide-y">
-                  {suggestions.map((suggestion) => {
-                    const effective = getEffectiveSuggestion(suggestion);
-                    const Icon = CATEGORY_ICONS[effective.suggestedCategory] || CreditCard;
-                    const color = CATEGORY_COLORS[effective.suggestedCategory] || "#6b7280";
-                    const isSelected = selectedKeywords.has(suggestion.keyword);
-                    
-                    return (
-                      <div 
-                        key={suggestion.keyword}
-                        className={cn(
-                          "p-4 md:p-5 transition-colors",
-                          isSelected ? "bg-primary/5" : "hover:bg-muted/30"
-                        )}
-                        data-testid={`keyword-row-${suggestion.keyword}`}
-                      >
-                        <div className="flex items-start gap-4">
-                          <Checkbox 
-                            checked={isSelected}
-                            onCheckedChange={() => toggleKeyword(suggestion.keyword)}
-                            className="mt-1"
-                          />
-                          
-                          <div 
-                            className="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0"
-                            style={{ backgroundColor: `${color}15` }}
-                          >
-                            <Icon className="h-5 w-5" style={{ color }} />
-                          </div>
-                          
-                          <div className="flex-1 min-w-0">
-                            <div className="flex items-center gap-3 mb-1">
-                              <span className="font-bold text-foreground">{suggestion.keyword}</span>
-                              <Badge 
-                                variant="secondary" 
-                                className={cn(
-                                  "text-[10px]",
-                                  suggestion.confidence >= 80 ? "bg-green-100 text-green-700" : 
-                                  suggestion.confidence >= 50 ? "bg-amber-100 text-amber-700" : 
-                                  "bg-gray-100 text-gray-700"
-                                )}
-                              >
-                                {suggestion.confidence}% confian√ßa
-                              </Badge>
-                              <Badge variant="outline" className="text-[10px]">
-                                {suggestion.count} transa√ß√µes
-                              </Badge>
-                            </div>
-                            <p className="text-sm text-muted-foreground mb-2">{suggestion.reason}</p>
-                            {suggestion.samples.length > 0 && (
-                              <p className="text-xs text-muted-foreground truncate">
-                                Exemplos: {suggestion.samples.join(", ")}
-                              </p>
-                            )}
-                          </div>
-                          
-                          <div className="flex items-center gap-2 flex-shrink-0">
-                            <Select 
-                              value={effective.suggestedCategory}
-                              onValueChange={(v) => updateSuggestion(suggestion.keyword, "suggestedCategory", v)}
-                            >
-                              <SelectTrigger className="w-[140px] h-9">
-                                <SelectValue />
-                              </SelectTrigger>
-                              <SelectContent>
-                                {CATEGORIES.map(cat => (
-                                  <SelectItem key={cat} value={cat}>{cat}</SelectItem>
-                                ))}
-                              </SelectContent>
-                            </Select>
-                            
-                            <Select 
-                              value={effective.suggestedType}
-                              onValueChange={(v) => updateSuggestion(suggestion.keyword, "suggestedType", v)}
-                            >
-                              <SelectTrigger className="w-[100px] h-9">
-                                <SelectValue />
-                              </SelectTrigger>
-                              <SelectContent>
-                                <SelectItem value="Despesa">Despesa</SelectItem>
-                                <SelectItem value="Receita">Receita</SelectItem>
-                              </SelectContent>
-                            </Select>
-                            
-                            <span className="font-bold text-sm w-24 text-right">
-                              {suggestion.total.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
-                            </span>
-                          </div>
-                        </div>
-                      </div>
-                    );
-                  })}
-                </div>
-              </CardContent>
-            </Card>
-
-            <Card className="bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20">
-              <CardContent className="p-6">
-                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
-                  <div>
-                    <h3 className="font-bold text-lg text-foreground">Aplicar Sugest√µes Selecionadas</h3>
-                    <p className="text-muted-foreground text-sm mt-1">
-                      Ser√£o criadas {selectedKeywords.size} regras e atualizadas as transa√ß√µes correspondentes
-                    </p>
-                  </div>
-                  <div className="flex gap-3">
-                    <Link href="/rules">
-                      <Button variant="outline" className="gap-2">
-                        Ver Regras Existentes
-                        <ChevronRight className="h-4 w-4" />
-                      </Button>
-                    </Link>
-                    <Button 
-                      className="bg-primary hover:bg-primary/90 gap-2"
-                      onClick={handleApply}
-                      disabled={selectedKeywords.size === 0 || applySuggestions.isPending}
-                    >
-                      {applySuggestions.isPending ? (
-                        <Loader2 className="h-4 w-4 animate-spin" />
-                      ) : (
-                        <CheckCircle2 className="h-4 w-4" />
-                      )}
-                      Aplicar {selectedKeywords.size} Sugest√µes
-                    </Button>
-                  </div>
-                </div>
-              </CardContent>
-            </Card>
-          </>
-        )}
-
-        {analyzeKeywords.data && suggestions.length === 0 && (
-          <Card className="bg-gradient-to-r from-green-50 to-emerald-50 border-green-200/50">
-            <CardContent className="p-8 text-center">
-              <CheckCircle2 className="h-16 w-16 mx-auto mb-4 text-green-500" />
-              <h3 className="text-xl font-bold text-green-900 mb-2">Tudo Categorizado!</h3>
-              <p className="text-green-700 max-w-lg mx-auto mb-6">
-                N√£o h√° transa√ß√µes pendentes de categoriza√ß√£o. Todas as suas transa√ß√µes j√° possuem uma categoria definida.
-              </p>
-              <Link href="/dashboard">
-                <Button className="bg-green-600 hover:bg-green-700 gap-2">
-                  Voltar ao Dashboard
-                  <ArrowRight className="h-4 w-4" />
-                </Button>
-              </Link>
-            </CardContent>
-          </Card>
-        )}
-      </div>
+      <AIKeywordsPanel />
     </AppLayout>
   );
 }
diff --git a/client/src/pages/budgets.tsx b/client/src/pages/budgets.tsx
index 0a8600f..27c8dc8 100644
--- a/client/src/pages/budgets.tsx
+++ b/client/src/pages/budgets.tsx
@@ -8,6 +8,7 @@ import { budgetsApi, dashboardApi } from "@/lib/api";
 import { queryClient } from "@/lib/queryClient";
 import { useToast } from "@/hooks/use-toast";
 import { useState } from "react";
+import { Link } from "wouter";
 import { Trash2, Plus, TrendingUp, TrendingDown, Sparkles, Copy } from "lucide-react";
 import { cn } from "@/lib/utils";
 
@@ -150,10 +151,10 @@ export default function BudgetsPage() {
       <div className="space-y-6">
         <div>
           <h1 className="text-2xl md:text-3xl font-bold text-foreground">
-            Or√ßamentos Mensais
+            Or√ßamento do M√™s
           </h1>
           <p className="text-muted-foreground mt-1">
-            Defina limites de gasto por categoria para {formatMonth(month)}
+            Defina limites por categoria (planejamento do m√™s atual) para {formatMonth(month)}
           </p>
         </div>
 
@@ -376,6 +377,25 @@ export default function BudgetsPage() {
             </CardContent>
           </Card>
         )}
+
+        <Card className="bg-gradient-to-r from-slate-50 to-primary/5 border-primary/10 shadow-sm">
+          <CardContent className="p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+            <div>
+              <h3 className="font-semibold text-foreground">Pr√≥ximo passo</h3>
+              <p className="text-sm text-muted-foreground mt-1">
+                Ajuste suas metas ou revise a fila de confirma√ß√£o para manter o or√ßamento atualizado.
+              </p>
+            </div>
+            <div className="flex gap-2">
+              <Link href="/goals">
+                <Button variant="outline">Rever metas</Button>
+              </Link>
+              <Link href="/confirm">
+                <Button className="bg-primary hover:bg-primary/90">Revisar fila</Button>
+              </Link>
+            </div>
+          </CardContent>
+        </Card>
       </div>
     </AppLayout>
   );
diff --git a/client/src/pages/calendar.tsx b/client/src/pages/calendar.tsx
index 94c286b..6721008 100644
--- a/client/src/pages/calendar.tsx
+++ b/client/src/pages/calendar.tsx
@@ -12,11 +12,13 @@
 import AppLayout from "@/components/layout/app-layout";
 import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
 import { Button } from "@/components/ui/button";
+import { Switch } from "@/components/ui/switch";
+import { Label } from "@/components/ui/label";
 import { ChevronLeft, ChevronRight } from "lucide-react";
 import { useState } from "react";
 import { useMonth } from "@/lib/month-context";
 import { useQuery } from "@tanstack/react-query";
-import { transactionsApi } from "@/lib/api";
+import { transactionsApi, calendarEventsApi } from "@/lib/api";
 import { MonthView } from "@/components/calendar/month-view";
 import { WeekBlocksView } from "@/components/calendar/week-blocks-view";
 import { DetailPanel } from "@/components/calendar/detail-panel";
@@ -28,12 +30,40 @@ export default function CalendarPage() {
   const [view, setView] = useState<"month" | "week">("month");
   const [selectedDay, setSelectedDay] = useState<Date | null>(null);
   const [selectedWeek, setSelectedWeek] = useState<Date | null>(null);
+  const [showRealized, setShowRealized] = useState(true);
+  const [showProjected, setShowProjected] = useState(true);
 
   const { data: transactions = [], isLoading } = useQuery({
     queryKey: ["transactions", month],
     queryFn: () => transactionsApi.list(month),
   });
 
+  const { data: calendarEvents = [] } = useQuery({
+    queryKey: ["calendar-events"],
+    queryFn: calendarEventsApi.list,
+  });
+
+  const projectedTransactions = calendarEvents
+    .filter((e: any) => e.isActive && e.nextDueDate)
+    .map((event: any) => ({
+      id: `proj-${event.id}`,
+      paymentDate: event.nextDueDate,
+      amount: Math.abs(event.amount || 0),
+      type: "Despesa",
+      descRaw: `${event.name} -- Projetado`,
+      category1: event.category1,
+      category2: event.category2,
+      projected: true,
+      recurring: event.recurrence && event.recurrence !== "none",
+      internalTransfer: false,
+    }));
+
+  const realizedTransactions = transactions.map((t: any) => ({ ...t, projected: false }));
+  const calendarTransactions = [
+    ...(showRealized ? realizedTransactions : []),
+    ...(showProjected ? projectedTransactions : []),
+  ];
+
   const handlePrevMonth = () => {
     const [year, m] = month.split("-").map(Number);
     const prevMonth = subMonths(new Date(year, m - 1), 1);
@@ -77,6 +107,36 @@ export default function CalendarPage() {
 
         {/* View Toggle */}
         <Tabs value={view} onValueChange={(v) => setView(v as "month" | "week")}>
+          <div className="flex flex-wrap items-center gap-4 mb-3 text-xs text-muted-foreground">
+            <span className="inline-flex items-center gap-2">
+              <span className="w-2.5 h-2.5 rounded-full bg-emerald-500" />
+              Realizado
+            </span>
+            <span className="inline-flex items-center gap-2">
+              <span className="w-2.5 h-2.5 rounded-full border border-dashed border-amber-500" />
+              Projetado
+            </span>
+            <div className="flex items-center gap-2">
+              <Switch
+                id="toggle-realized"
+                checked={showRealized}
+                onCheckedChange={setShowRealized}
+              />
+              <Label htmlFor="toggle-realized" className="text-xs text-muted-foreground">
+                Mostrar realizados
+              </Label>
+            </div>
+            <div className="flex items-center gap-2">
+              <Switch
+                id="toggle-projected"
+                checked={showProjected}
+                onCheckedChange={setShowProjected}
+              />
+              <Label htmlFor="toggle-projected" className="text-xs text-muted-foreground">
+                Mostrar projetados
+              </Label>
+            </div>
+          </div>
           <TabsList className="grid w-full max-w-[400px] grid-cols-2">
             <TabsTrigger value="month">M√™s</TabsTrigger>
             <TabsTrigger value="week">4 Semanas</TabsTrigger>
@@ -93,7 +153,7 @@ export default function CalendarPage() {
                 ) : (
                   <MonthView
                     month={month}
-                    transactions={transactions}
+                    transactions={calendarTransactions}
                     selectedDay={selectedDay}
                     onDaySelect={setSelectedDay}
                   />
@@ -103,7 +163,7 @@ export default function CalendarPage() {
                 <DetailPanel
                   mode={detailMode}
                   selectedDate={detailDate}
-                  transactions={transactions}
+                  transactions={calendarTransactions}
                 />
               </div>
             </div>
@@ -119,7 +179,7 @@ export default function CalendarPage() {
               ) : (
                 <WeekBlocksView
                   month={month}
-                  transactions={transactions}
+                  transactions={calendarTransactions}
                   selectedWeek={selectedWeek}
                   onWeekSelect={setSelectedWeek}
                 />
@@ -128,7 +188,7 @@ export default function CalendarPage() {
                 <DetailPanel
                   mode="week"
                   selectedDate={selectedWeek}
-                  transactions={transactions}
+                  transactions={calendarTransactions}
                 />
               )}
             </div>
diff --git a/client/src/pages/categories.tsx b/client/src/pages/categories.tsx
new file mode 100644
index 0000000..e2d382f
--- /dev/null
+++ b/client/src/pages/categories.tsx
@@ -0,0 +1,306 @@
+/**
+ * Categories Management
+ * Allows viewing and organizing category hierarchy (N1/N2/N3).
+ */
+
+import AppLayout from "@/components/layout/app-layout";
+import { Card, CardContent } from "@/components/ui/card";
+import { Button } from "@/components/ui/button";
+import { Badge } from "@/components/ui/badge";
+import { Input } from "@/components/ui/input";
+import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from "@/components/ui/dialog";
+import { Label } from "@/components/ui/label";
+import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
+import { ChevronRight, Edit2, Plus, Trash2, Loader2 } from "lucide-react";
+import { useMemo, useState } from "react";
+import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
+import { categoriesApi } from "@/lib/api";
+import { useToast } from "@/hooks/use-toast";
+
+const CATEGORY_OPTIONS = [
+  "Receitas",
+  "Moradia",
+  "Mercado",
+  "Compras Online",
+  "Transporte",
+  "Sa√∫de",
+  "Lazer",
+  "Viagem",
+  "Roupas",
+  "Tecnologia",
+  "Alimenta√ß√£o",
+  "Energia",
+  "Internet",
+  "Educa√ß√£o",
+  "Presentes",
+  "Streaming",
+  "Academia",
+  "Investimentos",
+  "Outros",
+  "Interno"
+];
+
+interface CategoryEntry {
+  id: string;
+  category1: string;
+  category2: string;
+  category3?: string | null;
+}
+
+export default function CategoriesPage() {
+  const { toast } = useToast();
+  const queryClient = useQueryClient();
+  const [isOpen, setIsOpen] = useState(false);
+  const [editing, setEditing] = useState<CategoryEntry | null>(null);
+  const [formData, setFormData] = useState({
+    category1: "Outros",
+    category2: "",
+    category3: ""
+  });
+
+  const { data: categories = [], isLoading } = useQuery<CategoryEntry[]>({
+    queryKey: ["categories"],
+    queryFn: categoriesApi.list,
+  });
+
+  const createMutation = useMutation({
+    mutationFn: categoriesApi.create,
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["categories"] });
+      toast({ title: "Categoria criada" });
+      closeDialog();
+    },
+  });
+
+  const updateMutation = useMutation({
+    mutationFn: ({ id, data }: { id: string; data: any }) => categoriesApi.update(id, data),
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["categories"] });
+      toast({ title: "Categoria atualizada" });
+      closeDialog();
+    },
+  });
+
+  const deleteMutation = useMutation({
+    mutationFn: categoriesApi.delete,
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["categories"] });
+      toast({ title: "Categoria removida" });
+    },
+  });
+
+  const grouped = useMemo(() => {
+    const map: Record<string, Record<string, { level2?: CategoryEntry; level3: CategoryEntry[] }>> = {};
+    categories.forEach((item) => {
+      if (!map[item.category1]) map[item.category1] = {};
+      if (!map[item.category1][item.category2]) {
+        map[item.category1][item.category2] = { level2: undefined, level3: [] };
+      }
+      if (item.category3) {
+        map[item.category1][item.category2].level3.push(item);
+      } else {
+        map[item.category1][item.category2].level2 = item;
+      }
+    });
+    return map;
+  }, [categories]);
+
+  const openNewDialog = () => {
+    setEditing(null);
+    setFormData({ category1: "Outros", category2: "", category3: "" });
+    setIsOpen(true);
+  };
+
+  const openEditDialog = (entry: CategoryEntry) => {
+    setEditing(entry);
+    setFormData({
+      category1: entry.category1,
+      category2: entry.category2,
+      category3: entry.category3 || ""
+    });
+    setIsOpen(true);
+  };
+
+  const openAddLevel3 = (category1: string, category2: string) => {
+    setEditing(null);
+    setFormData({ category1, category2, category3: "" });
+    setIsOpen(true);
+  };
+
+  const closeDialog = () => {
+    setIsOpen(false);
+    setEditing(null);
+    setFormData({ category1: "Outros", category2: "", category3: "" });
+  };
+
+  const handleSubmit = () => {
+    if (!formData.category2.trim()) {
+      toast({ title: "Categoria 2 √© obrigat√≥ria", variant: "destructive" });
+      return;
+    }
+
+    const payload = {
+      category1: formData.category1,
+      category2: formData.category2.trim(),
+      category3: formData.category3.trim() || null
+    };
+
+    if (editing) {
+      updateMutation.mutate({ id: editing.id, data: payload });
+      return;
+    }
+    createMutation.mutate(payload);
+  };
+
+  return (
+    <AppLayout>
+      <div className="container mx-auto p-6 space-y-6">
+        <div className="flex items-center justify-between">
+          <div>
+            <h1 className="text-3xl font-bold">Categorias</h1>
+            <p className="text-muted-foreground">Organize a hierarquia N1 ‚Üí N2 ‚Üí N3</p>
+          </div>
+          <Button variant="outline" onClick={openNewDialog}>
+            <Plus className="h-4 w-4 mr-2" />
+            Nova Categoria
+          </Button>
+        </div>
+
+        <Card>
+          <CardContent className="pt-6 space-y-4">
+            {isLoading ? (
+              <div className="flex items-center justify-center h-40">
+                <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+              </div>
+            ) : Object.keys(grouped).length === 0 ? (
+              <div className="text-center py-12 text-muted-foreground">
+                Nenhuma categoria cadastrada. Comece criando sua primeira hierarquia.
+              </div>
+            ) : (
+              Object.entries(grouped).map(([level1Name, level2Map]) => (
+                <div key={level1Name} className="border rounded-lg p-4">
+                  <div className="flex items-center justify-between">
+                    <div className="flex items-center gap-2">
+                      <Badge className="bg-primary/10 text-primary">N1</Badge>
+                      <span className="font-semibold">{level1Name}</span>
+                    </div>
+                  </div>
+
+                  <div className="mt-3 space-y-3 pl-4">
+                    {Object.entries(level2Map).map(([level2Name, group]) => (
+                      <div key={level2Name} className="border rounded-lg p-3 bg-muted/20">
+                        <div className="flex items-center justify-between">
+                          <div className="flex items-center gap-2">
+                            <ChevronRight className="h-4 w-4 text-muted-foreground" />
+                            <Badge variant="outline">N2</Badge>
+                            <span className="font-medium">{level2Name}</span>
+                          </div>
+                          <div className="flex items-center gap-2">
+                            {group.level2 && (
+                              <Button size="sm" variant="ghost" onClick={() => openEditDialog(group.level2!)}>
+                                <Edit2 className="h-4 w-4" />
+                              </Button>
+                            )}
+                            <Button
+                              size="sm"
+                              variant="ghost"
+                              onClick={() => openAddLevel3(level1Name, level2Name)}
+                            >
+                              <Plus className="h-4 w-4" />
+                            </Button>
+                            {group.level2 && (
+                              <Button
+                                size="sm"
+                                variant="ghost"
+                                onClick={() => deleteMutation.mutate(group.level2!.id)}
+                              >
+                                <Trash2 className="h-4 w-4 text-rose-600" />
+                              </Button>
+                            )}
+                          </div>
+                        </div>
+                        <div className="mt-2 flex flex-wrap gap-2 pl-6">
+                          {group.level3.map((level3) => (
+                            <Badge key={level3.id} variant="secondary" className="flex items-center gap-1">
+                              N3: {level3.category3}
+                              <button
+                                type="button"
+                                className="ml-1 text-xs text-muted-foreground hover:text-foreground"
+                                onClick={() => openEditDialog(level3)}
+                              >
+                                <Edit2 className="h-3 w-3" />
+                              </button>
+                              <button
+                                type="button"
+                                className="ml-1 text-xs text-rose-600 hover:text-rose-700"
+                                onClick={() => deleteMutation.mutate(level3.id)}
+                              >
+                                <Trash2 className="h-3 w-3" />
+                              </button>
+                            </Badge>
+                          ))}
+                        </div>
+                      </div>
+                    ))}
+                  </div>
+                </div>
+              ))
+            )}
+          </CardContent>
+        </Card>
+
+        <Dialog open={isOpen} onOpenChange={(open) => !open && closeDialog()}>
+          <DialogContent className="sm:max-w-[520px]">
+            <DialogHeader>
+              <DialogTitle>{editing ? "Editar categoria" : "Nova categoria"}</DialogTitle>
+            </DialogHeader>
+            <div className="space-y-4">
+              <div className="space-y-2">
+                <Label>Categoria (N√≠vel 1)</Label>
+                <Select
+                  value={formData.category1}
+                  onValueChange={(value) => setFormData({ ...formData, category1: value })}
+                >
+                  <SelectTrigger>
+                    <SelectValue />
+                  </SelectTrigger>
+                  <SelectContent>
+                    {CATEGORY_OPTIONS.map((category) => (
+                      <SelectItem key={category} value={category}>
+                        {category}
+                      </SelectItem>
+                    ))}
+                  </SelectContent>
+                </Select>
+              </div>
+
+              <div className="space-y-2">
+                <Label>Categoria (N√≠vel 2)</Label>
+                <Input
+                  value={formData.category2}
+                  onChange={(e) => setFormData({ ...formData, category2: e.target.value })}
+                  placeholder="Ex: Supermercado"
+                />
+              </div>
+
+              <div className="space-y-2">
+                <Label>Categoria (N√≠vel 3)</Label>
+                <Input
+                  value={formData.category3}
+                  onChange={(e) => setFormData({ ...formData, category3: e.target.value })}
+                  placeholder="Ex: LIDL (opcional)"
+                />
+              </div>
+            </div>
+            <DialogFooter>
+              <Button variant="outline" onClick={closeDialog}>Cancelar</Button>
+              <Button onClick={handleSubmit}>
+                {editing ? "Salvar" : "Criar"}
+              </Button>
+            </DialogFooter>
+          </DialogContent>
+        </Dialog>
+      </div>
+    </AppLayout>
+  );
+}
diff --git a/client/src/pages/confirm.tsx b/client/src/pages/confirm.tsx
index 54bebb2..1269ed3 100644
--- a/client/src/pages/confirm.tsx
+++ b/client/src/pages/confirm.tsx
@@ -7,13 +7,18 @@ import { format } from "date-fns";
 import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
 import { Checkbox } from "@/components/ui/checkbox";
 import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
-import { transactionsApi, accountsApi, settingsApi } from "@/lib/api";
+import { transactionsApi, accountsApi, settingsApi, rulesApi, merchantMetadataApi } from "@/lib/api";
 import { useState, useMemo } from "react";
 import { useToast } from "@/hooks/use-toast";
 import { Badge } from "@/components/ui/badge";
 import { AccountBadge } from "@/components/account-badge";
 import { Progress } from "@/components/ui/progress";
 import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";
+import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
+import { Switch } from "@/components/ui/switch";
+import { Link } from "wouter";
+import { getMerchantIcon } from "@/lib/merchant-icons";
+import { resolveMerchantMetadata } from "@/lib/merchant-metadata";
 
 interface TransactionForm {
   type: string;
@@ -40,6 +45,8 @@ export default function ConfirmPage() {
   const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
   const [formData, setFormData] = useState<Record<string, TransactionForm>>({});
   const [activeTab, setActiveTab] = useState("all");
+  const [groupByMerchant, setGroupByMerchant] = useState(false);
+  const [groupForms, setGroupForms] = useState<Record<string, TransactionForm>>({});
 
   const { data: items = [], isLoading } = useQuery({
     queryKey: ["confirm-queue"],
@@ -51,11 +58,21 @@ export default function ConfirmPage() {
     queryFn: accountsApi.list,
   });
 
+  const { data: merchantMetadata = [] } = useQuery({
+    queryKey: ["merchant-metadata"],
+    queryFn: merchantMetadataApi.list,
+  });
+
   const { data: settings } = useQuery({
     queryKey: ["settings"],
     queryFn: settingsApi.get,
   });
 
+  const { data: rules = [] } = useQuery({
+    queryKey: ["rules"],
+    queryFn: rulesApi.list,
+  });
+
   const accountsById = useMemo(() => {
     return accounts.reduce((map: any, account: any) => {
       map[account.id] = account;
@@ -63,6 +80,13 @@ export default function ConfirmPage() {
     }, {});
   }, [accounts]);
 
+  const rulesById = useMemo(() => {
+    return rules.reduce((map: any, rule: any) => {
+      map[rule.id] = rule;
+      return map;
+    }, {});
+  }, [rules]);
+
   const confirmMutation = useMutation({
     mutationFn: ({ ids, data, createRule, keyword }: { 
       ids: string[]; 
@@ -76,23 +100,39 @@ export default function ConfirmPage() {
       queryClient.invalidateQueries({ queryKey: ["dashboard"] });
       queryClient.invalidateQueries({ queryKey: ["rules"] });
       setSelectedIds(new Set());
-      toast({ title: `${result.count} transacao(oes) confirmada(s)` });
+      toast({ title: `${result.count} transa√ß√£o(√µes) confirmada(s)` });
     },
   });
 
   const getFormData = (t: any): TransactionForm => {
     return formData[t.id] || {
       type: t.type || "Despesa",
-      fixVar: t.fixVar || "Variavel",
+      fixVar: t.fixVar || "Vari√°vel",
       category1: t.category1 || "Outros",
       excludeFromBudget: t.excludeFromBudget || false
     };
   };
 
-  const updateFormData = (id: string, field: keyof TransactionForm, value: any) => {
+  const getGroupForm = (key: string, sample: any): TransactionForm => {
+    return groupForms[key] || {
+      type: sample.type || "Despesa",
+      fixVar: sample.fixVar || "Vari√°vel",
+      category1: sample.category1 || "Outros",
+      excludeFromBudget: sample.excludeFromBudget || false
+    };
+  };
+
+  const updateFormData = (t: any, field: keyof TransactionForm, value: any) => {
     setFormData(prev => ({
       ...prev,
-      [id]: { ...getFormData({ id, ...prev[id] }), [field]: value }
+      [t.id]: { ...getFormData(t), [field]: value }
+    }));
+  };
+
+  const updateGroupForm = (key: string, field: keyof TransactionForm, value: any, sample: any) => {
+    setGroupForms(prev => ({
+      ...prev,
+      [key]: { ...getGroupForm(key, sample), [field]: value }
     }));
   };
 
@@ -106,6 +146,15 @@ export default function ConfirmPage() {
     });
   };
 
+  const handleConfirmGroup = (groupKey: string, itemsInGroup: any[]) => {
+    if (itemsInGroup.length === 0) return;
+    const data = getGroupForm(groupKey, itemsInGroup[0]);
+    confirmMutation.mutate({
+      ids: itemsInGroup.map((t) => t.id),
+      data,
+    });
+  };
+
   const handleConfirmSelected = () => {
     if (selectedIds.size === 0) return;
     const ids = Array.from(selectedIds);
@@ -145,6 +194,29 @@ export default function ConfirmPage() {
   const mediumConfidenceCount = items.filter((t: any) => (t.confidence || 0) >= 50 && (t.confidence || 0) < 80).length;
   const lowConfidenceCount = items.filter((t: any) => (t.confidence || 0) < 50).length;
 
+  const getMerchantLabel = (t: any) => {
+    const metadataOverride = resolveMerchantMetadata(merchantMetadata, t.descRaw);
+    const base =
+      metadataOverride?.friendlyName ||
+      t.merchantAlias ||
+      t.descRaw?.split(" -- ")[0] ||
+      "Sem descri√ß√£o";
+    return base.replace(/\s+\d{4,}/g, "").trim();
+  };
+
+  const groupedItems = useMemo(() => {
+    const map = new Map<string, { key: string; label: string; items: any[] }>();
+    filteredItems.forEach((t: any) => {
+      const label = getMerchantLabel(t);
+      const key = label.toLowerCase();
+      if (!map.has(key)) {
+        map.set(key, { key, label, items: [] });
+      }
+      map.get(key)!.items.push(t);
+    });
+    return Array.from(map.values()).sort((a, b) => b.items.length - a.items.length);
+  }, [filteredItems]);
+
   if (isLoading) {
     return (
       <AppLayout>
@@ -161,7 +233,7 @@ export default function ConfirmPage() {
         <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
           <div>
             <div className="flex items-center gap-3 mb-1">
-              <h1 className="text-2xl font-bold">Fila de Confirmacao</h1>
+              <h1 className="text-2xl font-bold">Fila de Confirma√ß√£o</h1>
               {items.length > 0 && (
                 <span className="inline-flex items-center justify-center min-w-[28px] h-7 px-2 rounded-full bg-amber-100 text-amber-700 text-sm font-bold">
                   {items.length}
@@ -169,7 +241,7 @@ export default function ConfirmPage() {
               )}
             </div>
             <p className="text-muted-foreground">
-              A IA pre-analisou cada transacao. Revise as sugestoes e confirme.
+              A IA pr√©-analisou cada transa√ß√£o. Revise as sugest√µes e confirme.
             </p>
           </div>
           
@@ -180,7 +252,7 @@ export default function ConfirmPage() {
               className="bg-emerald-500 hover:bg-emerald-600 gap-2 shadow-lg shadow-emerald-500/20"
             >
               <Zap className="h-4 w-4" />
-              Aceitar {highConfidenceCount} com alta confianca
+              Aceitar {highConfidenceCount} com alta confian√ßa
             </Button>
           )}
         </div>
@@ -204,7 +276,7 @@ export default function ConfirmPage() {
             <CardContent className="p-5">
               <div className="flex items-center justify-between">
                 <div>
-                  <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">Alta Confianca</p>
+                  <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">Alta Confian√ßa</p>
                   <p className="text-3xl font-bold mt-1 text-emerald-600">{highConfidenceCount}</p>
                 </div>
                 <div className="w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center">
@@ -218,7 +290,7 @@ export default function ConfirmPage() {
             <CardContent className="p-5">
               <div className="flex items-center justify-between">
                 <div>
-                  <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">Media Confianca</p>
+                  <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">M√©dia Confian√ßa</p>
                   <p className="text-3xl font-bold mt-1 text-amber-600">{mediumConfidenceCount}</p>
                 </div>
                 <div className="w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center">
@@ -272,149 +344,262 @@ export default function ConfirmPage() {
           </TabsList>
         </Tabs>
 
+        <div className="flex items-center justify-between">
+          <div className="flex items-center gap-2 text-sm text-muted-foreground">
+            <Switch checked={groupByMerchant} onCheckedChange={setGroupByMerchant} />
+            <span>Agrupar por merchant</span>
+          </div>
+        </div>
+
         {filteredItems.length > 0 ? (
           <Card className="bg-white border-0 shadow-sm overflow-hidden">
-            <div className="overflow-x-auto">
-              <table className="w-full text-sm">
-                <thead className="bg-muted/30 text-muted-foreground">
-                  <tr>
-                    <th className="px-5 py-3 text-left w-12">
-                      <Checkbox 
-                        checked={selectedIds.size === filteredItems.length && filteredItems.length > 0}
-                        onCheckedChange={toggleSelectAll}
-                        data-testid="checkbox-select-all"
-                      />
-                    </th>
-                    <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Data</th>
-                    <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Conta</th>
-                    <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Descricao</th>
-                    <th className="px-5 py-3 text-right font-medium text-xs uppercase tracking-wide">Valor</th>
-                    <th className="px-5 py-3 text-center font-medium text-xs uppercase tracking-wide">Confianca</th>
-                    <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Categoria</th>
-                    <th className="px-5 py-3 text-center font-medium text-xs uppercase tracking-wide">Acao</th>
-                  </tr>
-                </thead>
-                <tbody className="divide-y divide-border/50">
-                  {filteredItems.map((t: any) => {
-                    const form = getFormData(t);
-                    const isSelected = selectedIds.has(t.id);
-                    const confidence = t.confidence || 0;
-                    const hasSuggestion = !!t.category1;
-                    const categoryColor = CATEGORY_COLORS[form.category1] || "#6b7280";
-                    
-                    return (
-                      <tr 
-                        key={t.id} 
-                        className={cn(
-                          "hover:bg-muted/20 transition-colors",
-                          isSelected && "bg-primary/5"
-                        )}
-                        data-testid={`row-confirm-${t.id}`}
-                      >
-                        <td className="px-5 py-4">
-                          <Checkbox 
-                            checked={isSelected}
-                            onCheckedChange={() => toggleSelect(t.id)}
-                            data-testid={`checkbox-${t.id}`}
-                          />
-                        </td>
-                        <td className="px-5 py-4 text-muted-foreground whitespace-nowrap">
-                          {format(new Date(t.paymentDate), "dd/MM/yy")}
-                        </td>
-                        <td className="px-5 py-4">
-                          <AccountBadge account={accountsById[t.accountId]} size="sm" />
-                        </td>
-                        <td className="px-5 py-4">
-                          <p className="font-medium truncate max-w-[250px]">{t.merchantAlias || t.descRaw?.split(" -- ")[0]}</p>
-                        </td>
-                        <td className="px-5 py-4 text-right font-semibold whitespace-nowrap">
-                          <span className={t.amount > 0 ? "text-emerald-600" : ""}>
-                            {t.amount?.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
-                          </span>
-                        </td>
-                        <td className="px-5 py-4">
-                          <div className="flex flex-col items-center gap-1.5">
-                            <Progress
-                              value={confidence}
-                              className={cn(
-                                "h-1.5 w-14",
-                                confidence >= 80 ? "[&>div]:bg-emerald-500" :
-                                confidence >= 50 ? "[&>div]:bg-amber-500" : "[&>div]:bg-rose-500"
-                              )}
-                            />
-                            <span className={cn(
-                              "text-xs font-semibold",
-                              confidence >= 80 ? "text-emerald-600" :
-                              confidence >= 50 ? "text-amber-600" : "text-rose-600"
-                            )}>
-                              {confidence}%
-                            </span>
-                            {!settings?.autoConfirmHighConfidence && confidence >= (settings?.confidenceThreshold || 80) && (
-                              <Badge variant="outline" className="text-[9px] px-1 py-0 h-4 border-emerald-500/30 text-emerald-700 bg-emerald-50/50">
-                                <Zap className="h-2.5 w-2.5 mr-0.5" />
-                                Auto
-                              </Badge>
-                            )}
-                          </div>
-                        </td>
-                        <td className="px-5 py-4">
-                          <div className="flex items-center gap-2">
-                            <div 
-                              className="w-2.5 h-2.5 rounded-full flex-shrink-0" 
-                              style={{ backgroundColor: categoryColor }}
-                            />
-                            <Select 
-                              value={form.category1} 
-                              onValueChange={(v) => updateFormData(t.id, "category1", v)}
+            {groupByMerchant ? (
+              <div className="p-5 space-y-4">
+                {groupedItems.map((group) => {
+                  const sample = group.items[0];
+                  const form = getGroupForm(group.key, sample);
+                  const categoryColor = CATEGORY_COLORS[form.category1] || "#6b7280";
+                  const total = group.items.reduce((sum, t) => sum + (t.amount || 0), 0);
+                  const metadataOverride = resolveMerchantMetadata(merchantMetadata, sample.descRaw);
+                  const merchantInfo = metadataOverride || getMerchantIcon(sample.descRaw);
+
+                  return (
+                    <div key={group.key} className="border rounded-lg p-4">
+                      <div className="flex items-start justify-between gap-4">
+                        <div className="flex items-start gap-3">
+                          {merchantInfo && (
+                            <div
+                              className="w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0"
+                              style={{ backgroundColor: `${merchantInfo.color}15` }}
                             >
-                              <SelectTrigger className={cn(
-                                "h-8 w-[140px] text-xs",
-                                hasSuggestion && confidence >= 80 && "border-emerald-200 bg-emerald-50/50"
-                              )}>
-                                <SelectValue />
-                              </SelectTrigger>
-                              <SelectContent>
-                                <SelectItem value="Mercado">Mercado</SelectItem>
-                                <SelectItem value="Lazer">Lazer</SelectItem>
-                                <SelectItem value="Transporte">Transporte</SelectItem>
-                                <SelectItem value="Compras Online">Compras Online</SelectItem>
-                                <SelectItem value="Moradia">Moradia</SelectItem>
-                                <SelectItem value="Sa√∫de">Saude</SelectItem>
-                                <SelectItem value="Receitas">Receitas</SelectItem>
-                                <SelectItem value="Outros">Outros</SelectItem>
-                                <SelectItem value="Interno">Interno</SelectItem>
-                              </SelectContent>
-                            </Select>
-                            {confidence >= 80 && (
-                              <Badge className="text-[10px] bg-emerald-100 text-emerald-700 border-0">
-                                IA
-                              </Badge>
-                            )}
+                              <merchantInfo.icon className="w-4 h-4" style={{ color: merchantInfo.color }} />
+                            </div>
+                          )}
+                          <div>
+                            <p className="font-semibold">{group.label}</p>
+                          <p className="text-xs text-muted-foreground mt-1">
+                            {group.items.length} transa√ß√µes ‚Ä¢ {total.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
+                          </p>
+                          <p className="text-xs text-muted-foreground mt-1">
+                            {group.items
+                              .slice(0, 2)
+                              .map((t) => t.descRaw?.split(" -- ")[0])
+                              .filter(Boolean)
+                              .join(" ‚Ä¢ ")}
+                          </p>
                           </div>
-                        </td>
-                        <td className="px-5 py-4 text-center">
-                          <Button 
+                        </div>
+
+                        <div className="flex items-center gap-2">
+                          <div
+                            className="w-2.5 h-2.5 rounded-full flex-shrink-0"
+                            style={{ backgroundColor: categoryColor }}
+                          />
+                          <Select
+                            value={form.category1}
+                            onValueChange={(v) => updateGroupForm(group.key, "category1", v, sample)}
+                          >
+                            <SelectTrigger className="h-8 w-[140px] text-xs">
+                              <SelectValue />
+                            </SelectTrigger>
+                            <SelectContent>
+                              <SelectItem value="Mercado">Mercado</SelectItem>
+                              <SelectItem value="Lazer">Lazer</SelectItem>
+                              <SelectItem value="Transporte">Transporte</SelectItem>
+                              <SelectItem value="Compras Online">Compras Online</SelectItem>
+                              <SelectItem value="Moradia">Moradia</SelectItem>
+                              <SelectItem value="Sa√∫de">Sa√∫de</SelectItem>
+                              <SelectItem value="Receitas">Receitas</SelectItem>
+                              <SelectItem value="Outros">Outros</SelectItem>
+                              <SelectItem value="Interno">Interno</SelectItem>
+                            </SelectContent>
+                          </Select>
+                          <Button
                             size="sm"
-                            className={cn(
-                              "h-8 gap-1.5 text-xs",
-                              confidence >= 80 
-                                ? "bg-emerald-500 hover:bg-emerald-600" 
-                                : "bg-primary hover:bg-primary/90"
-                            )}
+                            className="h-8 gap-1.5 text-xs bg-primary hover:bg-primary/90"
                             disabled={confirmMutation.isPending}
-                            onClick={() => handleConfirmSingle(t)}
-                            data-testid={`btn-confirm-${t.id}`}
+                            onClick={() => handleConfirmGroup(group.key, group.items)}
                           >
                             <Check className="h-3.5 w-3.5" />
-                            {confidence >= 80 ? "Aceitar" : "Confirmar"}
+                            Confirmar grupo
                           </Button>
-                        </td>
-                      </tr>
-                    );
-                  })}
-                </tbody>
-              </table>
-            </div>
+                        </div>
+                      </div>
+                    </div>
+                  );
+                })}
+              </div>
+            ) : (
+              <div className="overflow-x-auto">
+                <table className="w-full text-sm">
+                  <thead className="bg-muted/30 text-muted-foreground">
+                    <tr>
+                      <th className="px-5 py-3 text-left w-12">
+                        <Checkbox 
+                          checked={selectedIds.size === filteredItems.length && filteredItems.length > 0}
+                          onCheckedChange={toggleSelectAll}
+                          data-testid="checkbox-select-all"
+                        />
+                      </th>
+                      <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Data</th>
+                      <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Conta</th>
+                      <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Descri√ß√£o</th>
+                      <th className="px-5 py-3 text-right font-medium text-xs uppercase tracking-wide">Valor</th>
+                      <th className="px-5 py-3 text-center font-medium text-xs uppercase tracking-wide">Confian√ßa</th>
+                      <th className="px-5 py-3 text-left font-medium text-xs uppercase tracking-wide">Categoria</th>
+                      <th className="px-5 py-3 text-center font-medium text-xs uppercase tracking-wide">A√ß√£o</th>
+                    </tr>
+                  </thead>
+                  <tbody className="divide-y divide-border/50">
+                    {filteredItems.map((t: any) => {
+                      const form = getFormData(t);
+                      const isSelected = selectedIds.has(t.id);
+                      const confidence = t.confidence || 0;
+                      const hasSuggestion = !!t.category1;
+                      const categoryColor = CATEGORY_COLORS[form.category1] || "#6b7280";
+                      const rule = t.ruleIdApplied ? rulesById[t.ruleIdApplied] : null;
+                      const metadataOverride = resolveMerchantMetadata(merchantMetadata, t.descRaw);
+                      const merchantInfo = metadataOverride || getMerchantIcon(t.descRaw);
+                      
+                      return (
+                        <tr 
+                          key={t.id} 
+                          className={cn(
+                            "hover:bg-muted/20 transition-colors",
+                            isSelected && "bg-primary/5"
+                          )}
+                          data-testid={`row-confirm-${t.id}`}
+                        >
+                          <td className="px-5 py-4">
+                            <Checkbox 
+                              checked={isSelected}
+                              onCheckedChange={() => toggleSelect(t.id)}
+                              data-testid={`checkbox-${t.id}`}
+                            />
+                          </td>
+                          <td className="px-5 py-4 text-muted-foreground whitespace-nowrap">
+                            {format(new Date(t.paymentDate), "dd/MM/yy")}
+                          </td>
+                          <td className="px-5 py-4">
+                            <AccountBadge account={accountsById[t.accountId]} size="sm" />
+                          </td>
+                          <td className="px-5 py-4">
+                            <div className="flex items-center gap-2">
+                              {merchantInfo && (
+                                <div
+                                  className="w-7 h-7 rounded-lg flex items-center justify-center flex-shrink-0"
+                                  style={{ backgroundColor: `${merchantInfo.color}15` }}
+                                >
+                                  <merchantInfo.icon className="w-3.5 h-3.5" style={{ color: merchantInfo.color }} />
+                                </div>
+                              )}
+                              <p className="font-medium truncate max-w-[220px]">{getMerchantLabel(t)}</p>
+                            </div>
+                          </td>
+                          <td className="px-5 py-4 text-right font-semibold whitespace-nowrap">
+                            <span className={t.amount > 0 ? "text-emerald-600" : ""}>
+                              {t.amount?.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
+                            </span>
+                          </td>
+                          <td className="px-5 py-4">
+                            <div className="flex flex-col items-center gap-1.5">
+                              <Progress
+                                value={confidence}
+                                className={cn(
+                                  "h-1.5 w-14",
+                                  confidence >= 80 ? "[&>div]:bg-emerald-500" :
+                                  confidence >= 50 ? "[&>div]:bg-amber-500" : "[&>div]:bg-rose-500"
+                                )}
+                              />
+                              <span className={cn(
+                                "text-xs font-semibold",
+                                confidence >= 80 ? "text-emerald-600" :
+                                confidence >= 50 ? "text-amber-600" : "text-rose-600"
+                              )}>
+                                {confidence}%
+                              </span>
+                              {!settings?.autoConfirmHighConfidence && confidence >= (settings?.confidenceThreshold || 80) && (
+                                <Badge variant="outline" className="text-[9px] px-1 py-0 h-4 border-emerald-500/30 text-emerald-700 bg-emerald-50/50">
+                                  <Zap className="h-2.5 w-2.5 mr-0.5" />
+                                  Auto
+                                </Badge>
+                              )}
+                            </div>
+                          </td>
+                          <td className="px-5 py-4">
+                            <div className="flex items-center gap-2">
+                              <div 
+                                className="w-2.5 h-2.5 rounded-full flex-shrink-0" 
+                                style={{ backgroundColor: categoryColor }}
+                              />
+                              <Select 
+                                value={form.category1} 
+                                onValueChange={(v) => updateFormData(t, "category1", v)}
+                              >
+                                <SelectTrigger className={cn(
+                                  "h-8 w-[140px] text-xs",
+                                  hasSuggestion && confidence >= 80 && "border-emerald-200 bg-emerald-50/50"
+                                )}>
+                                  <SelectValue />
+                                </SelectTrigger>
+                                <SelectContent>
+                                  <SelectItem value="Mercado">Mercado</SelectItem>
+                                  <SelectItem value="Lazer">Lazer</SelectItem>
+                                  <SelectItem value="Transporte">Transporte</SelectItem>
+                                  <SelectItem value="Compras Online">Compras Online</SelectItem>
+                                  <SelectItem value="Moradia">Moradia</SelectItem>
+                                  <SelectItem value="Sa√∫de">Sa√∫de</SelectItem>
+                                  <SelectItem value="Receitas">Receitas</SelectItem>
+                                  <SelectItem value="Outros">Outros</SelectItem>
+                                  <SelectItem value="Interno">Interno</SelectItem>
+                                </SelectContent>
+                              </Select>
+                              <Popover>
+                                <PopoverTrigger asChild>
+                                  <Button variant="ghost" size="sm" className="h-8 px-2 text-xs">Por que?</Button>
+                                </PopoverTrigger>
+                                <PopoverContent className="w-64 text-xs">
+                                  <p className="font-semibold mb-1">Motivo da sugest√£o</p>
+                                  <p className="text-muted-foreground">
+                                    {rule ? `Regra: ${rule.name}` : "Sem regra aplicada"}
+                                  </p>
+                                  {t.suggestedKeyword && (
+                                    <p className="text-muted-foreground">Keyword: {t.suggestedKeyword}</p>
+                                  )}
+                                  <p className="text-muted-foreground">Confian√ßa: {confidence}%</p>
+                                </PopoverContent>
+                              </Popover>
+                              {confidence >= 80 && (
+                                <Badge className="text-[10px] bg-emerald-100 text-emerald-700 border-0">
+                                  IA
+                                </Badge>
+                              )}
+                            </div>
+                          </td>
+                          <td className="px-5 py-4 text-center">
+                            <Button 
+                              size="sm"
+                              className={cn(
+                                "h-8 gap-1.5 text-xs",
+                                confidence >= 80 
+                                  ? "bg-emerald-500 hover:bg-emerald-600" 
+                                  : "bg-primary hover:bg-primary/90"
+                              )}
+                              disabled={confirmMutation.isPending}
+                              onClick={() => handleConfirmSingle(t)}
+                              data-testid={`btn-confirm-${t.id}`}
+                            >
+                              <Check className="h-3.5 w-3.5" />
+                              {confidence >= 80 ? "Aceitar" : "Confirmar"}
+                            </Button>
+                          </td>
+                        </tr>
+                      );
+                    })}
+                  </tbody>
+                </table>
+              </div>
+            )}
             
             <div className="px-5 py-3 bg-muted/20 text-sm text-muted-foreground border-t flex items-center justify-between">
               <span>Mostrando {filteredItems.length} de {items.length} itens</span>
@@ -424,20 +609,40 @@ export default function ConfirmPage() {
             </div>
           </Card>
         ) : (
-          <Card className="bg-white border-0 shadow-sm">
-            <CardContent className="text-center py-16">
-              <div className="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
-                <CheckCircle2 className="h-8 w-8 text-primary/50" />
-              </div>
-              <h3 className="text-lg font-semibold mb-2">Tudo limpo!</h3>
-              <p className="text-muted-foreground text-sm">
-                {activeTab === "all" 
-                  ? "Nenhuma transacao pendente de revisao."
-                  : `Nenhuma transacao com ${activeTab === "high" ? "alta" : activeTab === "medium" ? "media" : "baixa"} confianca.`
-                }
-              </p>
-            </CardContent>
-          </Card>
+          <>
+            <Card className="bg-white border-0 shadow-sm">
+              <CardContent className="text-center py-16">
+                <div className="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
+                  <CheckCircle2 className="h-8 w-8 text-primary/50" />
+                </div>
+                <h3 className="text-lg font-semibold mb-2">Tudo limpo!</h3>
+                <p className="text-muted-foreground text-sm">
+                  {activeTab === "all"
+                    ? "Nenhuma transa√ß√£o pendente de revis√£o."
+                    : `Nenhuma transa√ß√£o com ${activeTab === "high" ? "alta" : activeTab === "medium" ? "m√©dia" : "baixa"} confian√ßa.`
+                  }
+                </p>
+              </CardContent>
+            </Card>
+            <Card className="bg-gradient-to-r from-slate-50 to-primary/5 border-primary/10 shadow-sm">
+              <CardContent className="p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+                <div>
+                  <h3 className="font-semibold text-foreground">Pr√≥ximo passo</h3>
+                  <p className="text-sm text-muted-foreground mt-1">
+                    Importe novos extratos ou ajuste regras para melhorar a automa√ß√£o.
+                  </p>
+                </div>
+                <div className="flex gap-2">
+                  <Link href="/uploads">
+                    <Button variant="outline">Importar extrato</Button>
+                  </Link>
+                  <Link href="/rules">
+                    <Button className="bg-primary hover:bg-primary/90">Ajustar regras</Button>
+                  </Link>
+                </div>
+              </CardContent>
+            </Card>
+          </>
         )}
 
         {selectedIds.size > 0 && (
diff --git a/client/src/pages/dashboard.tsx b/client/src/pages/dashboard.tsx
index 8927735..174d142 100644
--- a/client/src/pages/dashboard.tsx
+++ b/client/src/pages/dashboard.tsx
@@ -43,8 +43,9 @@ import {
 import { format, subMonths, startOfMonth, endOfMonth, differenceInDays } from "date-fns";
 import { ptBR } from "date-fns/locale";
 import { useQuery } from "@tanstack/react-query";
-import { dashboardApi, transactionsApi, accountsApi } from "@/lib/api";
+import { dashboardApi, transactionsApi, accountsApi, uploadsApi, calendarEventsApi, goalsApi, merchantMetadataApi } from "@/lib/api";
 import { getAccountIcon, getMerchantIcon } from "@/lib/icons";
+import { resolveMerchantMetadata } from "@/lib/merchant-metadata";
 import { Link } from "wouter";
 import { useMonth } from "@/lib/month-context";
 import { Badge } from "@/components/ui/badge";
@@ -137,23 +138,28 @@ export default function DashboardPage() {
 
   const { data: lastUploads = [] } = useQuery({
     queryKey: ["last-uploads-by-account"],
-    queryFn: async () => {
-      const res = await fetch("/api/uploads/last-by-account");
-      if (!res.ok) return [];
-      return res.json();
-    }
+    queryFn: uploadsApi.lastByAccount,
   });
 
   const { data: calendarEvents = [] } = useQuery({
     queryKey: ["calendar-events"],
-    queryFn: async () => {
-      const res = await fetch("/api/calendar-events");
-      if (!res.ok) return [];
-      return res.json();
-    }
+    queryFn: calendarEventsApi.list,
   });
 
+  const { data: merchantMetadata = [] } = useQuery({
+    queryKey: ["merchant-metadata"],
+    queryFn: merchantMetadataApi.list,
+  });
+
+  const { data: goalsData } = useQuery({
+    queryKey: ["goals", month],
+    queryFn: () => goalsApi.list(month),
+  });
+
+  const currentGoal = goalsData?.goals?.[0];
+
   const pendingCount = confirmQueue.length;
+  const hasData = transactions.length > 0 || lastUploads.length > 0;
 
   // Filter transactions by account
   const filteredTransactions = accountFilter === "all"
@@ -162,22 +168,25 @@ export default function DashboardPage() {
 
   const recentTransactions = filteredTransactions.slice(0, 5);
 
-  const estimatedIncome = 8500;
+  const estimatedIncome = currentGoal?.estimatedIncome || 0;
   const spent = dashboard?.totalSpent || 0;
-  const income = dashboard?.totalIncome || 0;
-  
   const today = new Date();
   const [year, monthNum] = month.split("-").map(Number);
-  const currentMonthDate = new Date(year, monthNum - 1, 1);
   const daysInMonth = new Date(year, monthNum, 0).getDate();
   const daysPassed = today.getMonth() === monthNum - 1 && today.getFullYear() === year ? today.getDate() : daysInMonth;
   const dailyAvg = daysPassed > 0 ? spent / daysPassed : 0;
   const projection = spent + dailyAvg * (daysInMonth - daysPassed);
   const daysRemaining = today.getMonth() === monthNum - 1 && today.getFullYear() === year ? daysInMonth - today.getDate() : 0;
 
-  const upcomingCommitments = calendarEvents.filter((e: any) => e.isActive).slice(0, 3);
-  const totalCommitted = upcomingCommitments.reduce((sum: number, e: any) => sum + e.amount, 0);
-  const remaining = Math.max(0, estimatedIncome - spent);
+  const upcomingCommitments = calendarEvents
+    .filter((e: any) => {
+      if (!e.isActive || !e.nextDueDate) return false;
+      const dueDate = new Date(e.nextDueDate);
+      return dueDate >= today;
+    })
+    .slice(0, 3);
+  const totalCommitted = upcomingCommitments.reduce((sum: number, e: any) => sum + (e.amount || 0), 0);
+  const availableReal = Math.max(0, estimatedIncome - spent - totalCommitted);
 
   const generateInsights = (): Insight[] => {
     const insights: Insight[] = [];
@@ -278,6 +287,24 @@ export default function DashboardPage() {
           </div>
         </div>
 
+        {!hasData && (
+          <Card className="bg-gradient-to-r from-primary/5 to-emerald-50 border-primary/20 shadow-sm">
+            <CardContent className="p-6">
+              <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+                <div>
+                  <h3 className="font-semibold text-foreground">Comece importando seu primeiro extrato</h3>
+                  <p className="text-sm text-muted-foreground mt-1">
+                    Assim que voc√™ importar um CSV, o dashboard vai mostrar gastos, categorias e insights.
+                  </p>
+                </div>
+                <Link href="/uploads">
+                  <Button className="bg-primary hover:bg-primary/90">Importar extrato</Button>
+                </Link>
+              </div>
+            </CardContent>
+          </Card>
+        )}
+
         <Card className="bg-white border-0 shadow-sm">
           <CardHeader className="pb-3">
             <div className="flex items-center justify-between">
@@ -341,17 +368,22 @@ export default function DashboardPage() {
               
               <div className="grid grid-cols-2 gap-4 mt-6 pt-4 border-t border-border">
                 <div className="p-3 rounded-xl bg-primary/5 border border-primary/10">
-                  <p className="text-xs font-semibold text-muted-foreground uppercase mb-1">Restante do M√™s</p>
+                  <p className="text-xs font-semibold text-muted-foreground uppercase mb-1">Dispon√≠vel real</p>
                   <p className="text-primary font-bold flex items-center gap-1 text-xl">
                     <ArrowUpRight className="h-5 w-5" />
-                    {remaining.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
+                    {availableReal.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
                   </p>
+                  {estimatedIncome === 0 && (
+                    <p className="text-[10px] text-amber-700 mt-1">
+                      Defina a renda em Metas ou Or√ßamento
+                    </p>
+                  )}
                 </div>
                 <div className="p-3 rounded-xl bg-rose-50 border border-rose-100">
-                  <p className="text-xs font-semibold text-muted-foreground uppercase mb-1">J√° Comprometido</p>
+                  <p className="text-xs font-semibold text-muted-foreground uppercase mb-1">Compromissos</p>
                   <p className="text-rose-600 font-bold flex items-center gap-1 text-xl">
                     <ArrowDownRight className="h-5 w-5" />
-                    {spent.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
+                    {totalCommitted.toLocaleString("pt-BR", { style: "currency", currency: "EUR" })}
                   </p>
                 </div>
               </div>
@@ -567,11 +599,16 @@ export default function DashboardPage() {
                   </div>
                 ) : (
                   recentTransactions.map((t: any) => {
-                    const merchantInfo = getMerchantIcon(t.descRaw);
+                    const metadataOverride = resolveMerchantMetadata(merchantMetadata, t.descRaw);
+                    const merchantInfo = metadataOverride || getMerchantIcon(t.descRaw);
                     const Icon = merchantInfo?.icon || (CATEGORY_ICONS[t.category1] || CreditCard);
                     const color = merchantInfo?.color || (CATEGORY_COLORS[t.category1] || "#6b7280");
                     const isIncome = t.amount > 0;
-                    const merchantName = t.descRaw?.split(" -- ")[0]?.replace(/\s+\d{4,}/g, '').trim() || t.descRaw;
+                    const merchantName =
+                      metadataOverride?.friendlyName ||
+                      t.merchantAlias ||
+                      t.descRaw?.split(" -- ")[0]?.replace(/\s+\d{4,}/g, '').trim() ||
+                      t.descRaw;
 
                     return (
                       <div
@@ -632,6 +669,33 @@ export default function DashboardPage() {
             </CardContent>
           </Card>
         )}
+
+        {pendingCount === 0 && (
+          <Card className="bg-gradient-to-r from-slate-50 to-emerald-50 border-emerald-200/40 shadow-sm">
+            <CardContent className="p-5">
+              <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+                <div className="flex items-start gap-4">
+                  <div className="w-12 h-12 rounded-xl bg-emerald-100 flex items-center justify-center flex-shrink-0">
+                    <TrendingUp className="h-6 w-6 text-emerald-600" />
+                  </div>
+                  <div>
+                    <h3 className="font-semibold text-emerald-900">Pr√≥ximo passo</h3>
+                    <p className="text-sm text-emerald-700/80 mt-0.5">
+                      {lastUploads.length === 0
+                        ? "Importe seu primeiro extrato para come√ßar a analisar seus gastos."
+                        : "Revise suas transa√ß√µes e acompanhe as categorias deste m√™s."}
+                    </p>
+                  </div>
+                </div>
+                <Link href={lastUploads.length === 0 ? "/uploads" : "/transactions"}>
+                  <Button className="bg-emerald-500 hover:bg-emerald-600 text-white shadow-lg shadow-emerald-500/20">
+                    {lastUploads.length === 0 ? "Importar extrato" : "Ver transa√ß√µes"}
+                  </Button>
+                </Link>
+              </div>
+            </CardContent>
+          </Card>
+        )}
       </div>
     </AppLayout>
     </>
diff --git a/client/src/pages/event-detail.tsx b/client/src/pages/event-detail.tsx
index e8bca8c..ddf6904 100644
--- a/client/src/pages/event-detail.tsx
+++ b/client/src/pages/event-detail.tsx
@@ -34,7 +34,7 @@ import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
 import { Link, useParams, useLocation } from "wouter";
 import { useState } from "react";
 import { useToast } from "@/hooks/use-toast";
-import { eventOccurrencesApi } from "@/lib/api";
+import { calendarEventsApi, eventOccurrencesApi } from "@/lib/api";
 
 const CATEGORY_ICONS: Record<string, any> = {
   "Moradia": Home,
@@ -99,29 +99,18 @@ export default function EventDetailPage() {
 
   const { data: event, isLoading } = useQuery<CalendarEvent>({
     queryKey: ["calendar-event", id],
-    queryFn: async () => {
-      const res = await fetch(`/api/calendar-events/${id}`);
-      if (!res.ok) throw new Error("Evento n√£o encontrado");
-      return res.json();
-    },
+    queryFn: () => calendarEventsApi.get(id),
     enabled: !!id
   });
 
   const { data: occurrences = [] } = useQuery<EventOccurrence[]>({
     queryKey: ["event-occurrences", id],
-    queryFn: async () => {
-      const res = await fetch(`/api/calendar-events/${id}/occurrences`);
-      if (!res.ok) return [];
-      return res.json();
-    },
+    queryFn: () => eventOccurrencesApi.list(id),
     enabled: !!id
   });
 
   const deleteEvent = useMutation({
-    mutationFn: async () => {
-      const res = await fetch(`/api/calendar-events/${id}`, { method: "DELETE" });
-      if (!res.ok) throw new Error("Erro ao excluir evento");
-    },
+    mutationFn: () => calendarEventsApi.delete(id),
     onSuccess: () => {
       queryClient.invalidateQueries({ queryKey: ["calendar-events"] });
       toast({ title: "Evento exclu√≠do com sucesso" });
diff --git a/client/src/pages/goals.tsx b/client/src/pages/goals.tsx
index 1742e2e..2d2eb1b 100644
--- a/client/src/pages/goals.tsx
+++ b/client/src/pages/goals.tsx
@@ -30,9 +30,10 @@ import {
 } from "lucide-react";
 import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
 import { useMonth } from "@/lib/month-context";
-import { useState, useEffect } from "react";
+import { useState, useEffect, useRef } from "react";
 import { useToast } from "@/hooks/use-toast";
-import { goalsApi, categoryGoalsApi } from "@/lib/api";
+import { goalsApi, categoryGoalsApi, dashboardApi } from "@/lib/api";
+import { Link } from "wouter";
 
 const CATEGORY_ICONS: Record<string, any> = {
   "Moradia": Home,
@@ -75,6 +76,7 @@ export default function GoalsPage() {
   const { month, formatMonth } = useMonth();
   const { toast } = useToast();
   const queryClient = useQueryClient();
+  const incomeInputRef = useRef<HTMLInputElement>(null);
 
   const [estimatedIncome, setEstimatedIncome] = useState("8500");
   const [categoryBudgets, setCategoryBudgets] = useState<Record<string, string>>({});
@@ -104,20 +106,12 @@ export default function GoalsPage() {
 
   const { data: dashboard } = useQuery({
     queryKey: ["dashboard", month],
-    queryFn: async () => {
-      const res = await fetch(`/api/dashboard?month=${month}`);
-      if (!res.ok) return null;
-      return res.json();
-    }
+    queryFn: () => dashboardApi.get(month),
   });
 
   const { data: previousMonth } = useQuery({
     queryKey: ["dashboard", getPreviousMonth(month)],
-    queryFn: async () => {
-      const res = await fetch(`/api/dashboard?month=${getPreviousMonth(month)}`);
-      if (!res.ok) return null;
-      return res.json();
-    }
+    queryFn: () => dashboardApi.get(getPreviousMonth(month)),
   });
 
   // Load goal data into state when fetched
@@ -255,9 +249,9 @@ export default function GoalsPage() {
       <div className="space-y-6">
         <div className="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
           <div>
-            <h1 className="text-2xl md:text-3xl font-bold text-foreground">Metas Financeiras</h1>
+            <h1 className="text-2xl md:text-3xl font-bold text-foreground">Objetivos Financeiros</h1>
             <p className="text-muted-foreground">
-              Planeje e acompanhe seus limites de gastos para {formatMonth(month)}
+              Objetivos estrat√©gicos do m√™s (separados do or√ßamento) para {formatMonth(month)}
             </p>
           </div>
           
@@ -282,6 +276,22 @@ export default function GoalsPage() {
           </div>
         </div>
 
+        {!currentGoal && categoryData.length === 0 && !goalsLoading && (
+          <Card className="bg-white border-0 shadow-sm">
+            <CardContent className="p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
+              <div>
+                <h3 className="font-semibold text-foreground">Comece com uma meta simples</h3>
+                <p className="text-sm text-muted-foreground mt-1">
+                  Defina sua renda estimada e as categorias principais para o m√™s.
+                </p>
+              </div>
+              <Button variant="outline" onClick={() => incomeInputRef.current?.focus()}>
+                Definir renda
+              </Button>
+            </CardContent>
+          </Card>
+        )}
+
         <Card className="bg-gradient-to-r from-white to-primary/5 border-primary/20 shadow-sm">
           <CardContent className="p-6 md:p-8">
             <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
@@ -319,6 +329,7 @@ export default function GoalsPage() {
                     className="pl-8 text-2xl font-bold h-12 border-0 bg-muted/30"
                     value={estimatedIncome}
                     onChange={(e) => setEstimatedIncome(e.target.value)}
+                    ref={incomeInputRef}
                   />
                 </div>
                 <Badge className="bg-green-100 text-green-700 mb-2">Confirmado</Badge>
@@ -467,6 +478,26 @@ export default function GoalsPage() {
             </CardContent>
           </Card>
         </div>
+
+        <Card className="bg-gradient-to-r from-slate-50 to-primary/5 border-primary/10 shadow-sm">
+          <CardContent className="p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+            <div>
+              <h3 className="font-semibold text-foreground">Pr√≥ximo passo</h3>
+              <p className="text-sm text-muted-foreground mt-1">
+                {currentGoal
+                  ? "Revise seu progresso no dashboard e ajuste categorias se necess√°rio."
+                  : "Defina sua renda estimada para calcular metas realistas."}
+              </p>
+            </div>
+            <div className="flex gap-2">
+              <Link href={currentGoal ? "/dashboard" : "/budgets"}>
+                <Button className="bg-primary hover:bg-primary/90">
+                  {currentGoal ? "Ver dashboard" : "Definir or√ßamento"}
+                </Button>
+              </Link>
+            </div>
+          </CardContent>
+        </Card>
       </div>
     </AppLayout>
   );
diff --git a/client/src/pages/login.tsx b/client/src/pages/login.tsx
index b5d0f04..8c21936 100644
--- a/client/src/pages/login.tsx
+++ b/client/src/pages/login.tsx
@@ -17,6 +17,7 @@ import { useState } from "react";
 import { useMutation } from "@tanstack/react-query";
 import { authApi } from "@/lib/api";
 import { Eye, EyeOff, Sparkles, ArrowRight, CheckCircle2 } from "lucide-react";
+import { Badge } from "@/components/ui/badge";
 import { cn } from "@/lib/utils";
 import { animations, buttonPress, focusRing } from "@/lib/animations";
 
@@ -26,6 +27,7 @@ export default function LoginPage() {
   const [password, setPassword] = useState("");
   const [showPassword, setShowPassword] = useState(false);
   const [focusedField, setFocusedField] = useState<string | null>(null);
+  const demoMode = true;
 
   const loginMutation = useMutation({
     mutationFn: () => authApi.login(email || "demo", password || "demo"),
@@ -121,8 +123,7 @@ export default function LoginPage() {
                 animations.delay[300]
               )}
               type="button"
-              onClick={() => loginMutation.mutate()}
-              disabled={loginMutation.isPending || isSuccess}
+              disabled={demoMode || loginMutation.isPending || isSuccess}
               data-testid="btn-google-login"
             >
               {isSuccess ? (
@@ -136,6 +137,11 @@ export default function LoginPage() {
                 </svg>
               )}
               {isSuccess ? "Conectado! Redirecionando..." : "Continuar com Google"}
+              {demoMode && (
+                <Badge variant="secondary" className="ml-2 text-[10px]">
+                  Em breve
+                </Badge>
+              )}
             </Button>
 
             {/* Divider */}
@@ -186,9 +192,10 @@ export default function LoginPage() {
                   <Label htmlFor="password" className="text-sm font-medium">Senha</Label>
                   <button
                     type="button"
-                    className="text-sm text-primary hover:underline font-medium transition-colors duration-200"
+                    className="text-sm text-muted-foreground font-medium cursor-not-allowed"
+                    disabled
                   >
-                    Esqueceu?
+                    Esqueceu? <span className="text-[10px] ml-1">Em breve</span>
                   </button>
                 </div>
                 <div className="relative">
@@ -254,12 +261,9 @@ export default function LoginPage() {
               animations.delay[600]
             )}>
               N√£o tem uma conta?{" "}
-              <button
-                type="button"
-                className="text-primary font-medium hover:underline transition-colors duration-200"
-              >
-                Cadastre-se gratuitamente
-              </button>
+              <span className="text-muted-foreground font-medium">
+                Cadastre-se gratuitamente <span className="text-[10px] ml-1">Em breve</span>
+              </span>
             </p>
           </CardContent>
         </Card>
diff --git a/client/src/pages/merchant-dictionary.tsx b/client/src/pages/merchant-dictionary.tsx
index 2cda76e..7872370 100644
--- a/client/src/pages/merchant-dictionary.tsx
+++ b/client/src/pages/merchant-dictionary.tsx
@@ -3,7 +3,7 @@ import { Button } from "@/components/ui/button";
 import { Card, CardContent } from "@/components/ui/card";
 import { Input } from "@/components/ui/input";
 import { Badge } from "@/components/ui/badge";
-import { Search, Loader2, Edit2, Trash2, BookOpen, Filter, Download, Upload } from "lucide-react";
+import { Search, Loader2, Edit2, Trash2, BookOpen, Filter, Download, Upload, Sparkles, CheckCircle2 } from "lucide-react";
 import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
 import { merchantDictionaryApi } from "@/lib/api";
 import { useToast } from "@/hooks/use-toast";
@@ -21,7 +21,13 @@ export default function MerchantDictionaryPage() {
   const [manualFilter, setManualFilter] = useState("all");
   const [editingId, setEditingId] = useState<string | null>(null);
   const [editingAlias, setEditingAlias] = useState("");
+  const [selectedSuggestions, setSelectedSuggestions] = useState<Set<string>>(new Set());
+  const [editedSuggestions, setEditedSuggestions] = useState<Record<string, string>>({});
   const fileInputRef = useRef<HTMLInputElement>(null);
+  const [importPreview, setImportPreview] = useState<{
+    rows: Array<{ source: string; keyDesc: string; aliasDesc: string }>;
+    errors: string[];
+  } | null>(null);
 
   // Fetch descriptions with filters
   const { data: descriptions = [], isLoading } = useQuery({
@@ -59,6 +65,34 @@ export default function MerchantDictionaryPage() {
     },
   });
 
+  const suggestionsMutation = useMutation({
+    mutationFn: merchantDictionaryApi.suggestAliases,
+    onSuccess: (data) => {
+      const suggestions = data?.suggestions || [];
+      setSelectedSuggestions(new Set(suggestions.map((s: any) => s.id)));
+      toast({ title: `${suggestions.length} sugest√µes geradas` });
+    },
+    onError: (error: any) => {
+      toast({ title: "Erro ao gerar sugest√µes", description: error.message, variant: "destructive" });
+    },
+  });
+
+  const applySuggestionsMutation = useMutation({
+    mutationFn: async (items: any[]) => {
+      for (const item of items) {
+        await merchantDictionaryApi.updateDescription(item.id, { aliasDesc: item.suggestedAlias });
+      }
+      return items.length;
+    },
+    onSuccess: (count) => {
+      queryClient.invalidateQueries({ queryKey: ["merchant-descriptions"] });
+      toast({ title: `${count} sugest√µes aplicadas` });
+    },
+    onError: (error: any) => {
+      toast({ title: "Erro ao aplicar sugest√µes", description: error.message, variant: "destructive" });
+    },
+  });
+
   const handleEdit = (desc: any) => {
     setEditingId(desc.id);
     setEditingAlias(desc.aliasDesc);
@@ -80,19 +114,50 @@ export default function MerchantDictionaryPage() {
     }
   };
 
+  const suggestions = suggestionsMutation.data?.suggestions || [];
+
+  const toggleSuggestion = (id: string) => {
+    const next = new Set(selectedSuggestions);
+    if (next.has(id)) {
+      next.delete(id);
+    } else {
+      next.add(id);
+    }
+    setSelectedSuggestions(next);
+  };
+
+  const updateSuggestion = (id: string, value: string) => {
+    setEditedSuggestions((prev) => ({ ...prev, [id]: value }));
+  };
+
+  const applySelected = () => {
+    const toApply = suggestions
+      .filter((s: any) => selectedSuggestions.has(s.id))
+      .map((s: any) => ({
+        ...s,
+        suggestedAlias: editedSuggestions[s.id] || s.suggestedAlias
+      }));
+    if (toApply.length === 0) {
+      toast({ title: "Selecione ao menos uma sugest√£o", variant: "destructive" });
+      return;
+    }
+    applySuggestionsMutation.mutate(toApply);
+  };
+
   const handleDownloadExcel = async () => {
-    if (descriptions.length === 0) {
+    const exportData = await merchantDictionaryApi.exportDescriptions();
+    if (!exportData || exportData.length === 0) {
       toast({ title: "Nenhum dado para exportar", variant: "destructive" });
       return;
     }
 
-    const excelData = descriptions.map((d: any) => ({
-      'Fonte': d.source,
-      'Descri√ß√£o Chave': d.keyDesc,
-      'Alias': d.aliasDesc,
-      'Manual': d.isManual ? 'Sim' : 'N√£o',
-      'Criado em': new Date(d.createdAt).toLocaleString('pt-BR'),
-      'Atualizado em': new Date(d.updatedAt).toLocaleString('pt-BR')
+    const excelData = exportData.map((d: any) => ({
+      'Fonte': d.Source,
+      'Descri√ß√£o Chave': d['Key Description'],
+      'Alias': d.Alias,
+      'Manual': d.Manual === 'Yes' ? 'Sim' : 'N√£o',
+      'Criado em': new Date(d.Created).toLocaleString('pt-BR'),
+      'Atualizado em': new Date(d.Updated).toLocaleString('pt-BR')
     }));
 
     const ws = XLSX.utils.json_to_sheet(excelData);
@@ -111,7 +176,28 @@ export default function MerchantDictionaryPage() {
     const date = new Date().toISOString().split('T')[0];
     XLSX.writeFile(wb, `ritualfin_merchant_aliases_${date}.xlsx`);
 
-    toast({ title: `${descriptions.length} registros exportados` });
+    toast({ title: `${excelData.length} registros exportados` });
+  };
+
+  const handleDownloadTemplate = () => {
+    const excelData = [{
+      'Fonte': 'Sparkasse',
+      'Descri√ß√£o Chave': 'Exemplo de descri√ß√£o do banco',
+      'Alias': 'Exemplo de alias amig√°vel'
+    }];
+
+    const ws = XLSX.utils.json_to_sheet(excelData);
+    ws['!cols'] = [
+      { wch: 15 },
+      { wch: 50 },
+      { wch: 30 }
+    ];
+
+    const wb = XLSX.utils.book_new();
+    XLSX.utils.book_append_sheet(wb, ws, 'Merchant Aliases');
+
+    const date = new Date().toISOString().split('T')[0];
+    XLSX.writeFile(wb, `ritualfin_merchant_aliases_modelo_${date}.xlsx`);
   };
 
   const handleUploadExcel = (event: React.ChangeEvent<HTMLInputElement>) => {
@@ -160,44 +246,12 @@ export default function MerchantDictionaryPage() {
           });
         });
 
-        if (errors.length > 0) {
-          toast({
-            title: "Erros encontrados no arquivo",
-            description: errors.slice(0, 3).join('; '),
-            variant: "destructive"
-          });
-          return;
-        }
-
         if (toImport.length === 0) {
           toast({ title: "Nenhum registro v√°lido para importar", variant: "destructive" });
           return;
         }
 
-        // Import records one by one
-        let successCount = 0;
-        let failCount = 0;
-
-        for (const record of toImport) {
-          try {
-            await merchantDictionaryApi.createDescription(record);
-            successCount++;
-          } catch (error) {
-            failCount++;
-          }
-        }
-
-        // Refresh list
-        queryClient.invalidateQueries({ queryKey: ["merchant-descriptions"] });
-
-        if (failCount === 0) {
-          toast({ title: `${successCount} registros importados com sucesso` });
-        } else {
-          toast({
-            title: "Importa√ß√£o conclu√≠da com erros",
-            description: `${successCount} importados, ${failCount} falharam`
-          });
-        }
+        setImportPreview({ rows: toImport, errors });
 
       } catch (error: any) {
         toast({
@@ -216,6 +270,35 @@ export default function MerchantDictionaryPage() {
     }
   };
 
+  const handleConfirmImport = async () => {
+    if (!importPreview) return;
+
+    try {
+      const result = await merchantDictionaryApi.bulkUpsertDescriptions(importPreview.rows);
+      queryClient.invalidateQueries({ queryKey: ["merchant-descriptions"] });
+      setImportPreview(null);
+
+      const created = result?.created || 0;
+      const updated = result?.updated || 0;
+      const failed = result?.failed || 0;
+      const baseMessage = `${created} novos, ${updated} atualizados`;
+      if (failed > 0) {
+        toast({
+          title: "Importa√ß√£o conclu√≠da com alertas",
+          description: `${baseMessage} ‚Ä¢ ${failed} com erro`
+        });
+      } else {
+        toast({ title: "Importa√ß√£o conclu√≠da", description: baseMessage });
+      }
+    } catch (error: any) {
+      toast({
+        title: "Erro ao importar",
+        description: error.message,
+        variant: "destructive"
+      });
+    }
+  };
+
   const SOURCE_COLORS: Record<string, string> = {
     "Sparkasse": "bg-blue-100 text-blue-700",
     "Amex": "bg-green-100 text-green-700",
@@ -244,7 +327,15 @@ export default function MerchantDictionaryPage() {
             </p>
           </div>
 
-          <div className="flex gap-2">
+          <div className="flex flex-wrap gap-2">
+            <Button
+              variant="ghost"
+              className="gap-2"
+              onClick={handleDownloadTemplate}
+            >
+              <Download className="h-4 w-4" />
+              Baixar modelo
+            </Button>
             <Button
               variant="outline"
               className="gap-2"
@@ -274,6 +365,82 @@ export default function MerchantDictionaryPage() {
           </div>
         </div>
 
+        <Card className="bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20">
+          <CardContent className="p-6 space-y-4">
+            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
+              <div>
+                <h2 className="text-lg font-semibold flex items-center gap-2">
+                  <Sparkles className="h-4 w-4 text-primary" />
+                  Sugest√µes IA para Aliases
+                </h2>
+                <p className="text-sm text-muted-foreground">
+                  Gere aliases amig√°veis com base nas keywords do dicion√°rio.
+                </p>
+              </div>
+              <Button
+                className="gap-2"
+                onClick={() => suggestionsMutation.mutate()}
+                disabled={suggestionsMutation.isPending}
+              >
+                {suggestionsMutation.isPending ? (
+                  <Loader2 className="h-4 w-4 animate-spin" />
+                ) : (
+                  <Sparkles className="h-4 w-4" />
+                )}
+                Gerar sugest√µes
+              </Button>
+            </div>
+
+            {suggestions.length > 0 && (
+              <div className="space-y-3">
+                {suggestions.map((s: any) => (
+                  <div key={s.id} className="flex flex-col md:flex-row md:items-center gap-3 border rounded-lg p-3 bg-white/70">
+                    <div className="flex items-start gap-3 flex-1">
+                      <input
+                        type="checkbox"
+                        checked={selectedSuggestions.has(s.id)}
+                        onChange={() => toggleSuggestion(s.id)}
+                        className="mt-1"
+                      />
+                      <div className="min-w-0">
+                        <p className="text-sm font-medium">{s.keyDesc}</p>
+                        <p className="text-xs text-muted-foreground">
+                          Atual: {s.currentAlias || "‚Äî"}
+                        </p>
+                        {s.reason && (
+                          <p className="text-xs text-muted-foreground mt-1">
+                            {s.reason}
+                          </p>
+                        )}
+                      </div>
+                    </div>
+                    <div className="flex items-center gap-2">
+                      <Input
+                        className="h-8 w-[220px]"
+                        value={editedSuggestions[s.id] ?? s.suggestedAlias}
+                        onChange={(e) => updateSuggestion(s.id, e.target.value)}
+                      />
+                      <Badge variant="secondary" className="text-[10px]">
+                        {s.confidence ?? 0}%
+                      </Badge>
+                    </div>
+                  </div>
+                ))}
+                <div className="flex justify-end">
+                  <Button
+                    className="gap-2"
+                    onClick={applySelected}
+                    disabled={applySuggestionsMutation.isPending}
+                  >
+                    <CheckCircle2 className="h-4 w-4" />
+                    Aplicar sugest√µes
+                  </Button>
+                </div>
+              </div>
+            )}
+          </CardContent>
+        </Card>
+
         {/* Stats */}
         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
           <Card className="bg-white border-0 shadow-sm">
@@ -452,6 +619,69 @@ export default function MerchantDictionaryPage() {
           </CardContent>
         </Card>
       </div>
+
+      <Dialog open={!!importPreview} onOpenChange={(open) => !open && setImportPreview(null)}>
+        <DialogContent className="sm:max-w-[640px]">
+          <DialogHeader>
+            <DialogTitle>Pr√©-visualizar importa√ß√£o</DialogTitle>
+          </DialogHeader>
+          {importPreview && (
+            <div className="space-y-4">
+              <div className="rounded-lg border bg-muted/20 p-3 text-sm">
+                <div className="flex flex-wrap gap-3">
+                  <span>
+                    <strong>{importPreview.rows.length}</strong> v√°lidos
+                  </span>
+                  <span>
+                    <strong>{importPreview.errors.length}</strong> com erro
+                  </span>
+                </div>
+                {importPreview.errors.length > 0 && (
+                  <p className="text-xs text-muted-foreground mt-2">
+                    Corrija os erros no arquivo e reimporte para m√°xima precis√£o.
+                  </p>
+                )}
+              </div>
+
+              {importPreview.errors.length > 0 && (
+                <div className="rounded-lg border p-3 text-xs text-rose-700 bg-rose-50">
+                  <p className="font-semibold mb-2">Erros encontrados</p>
+                  <ul className="space-y-1">
+                    {importPreview.errors.slice(0, 5).map((error) => (
+                      <li key={error}>{error}</li>
+                    ))}
+                  </ul>
+                  {importPreview.errors.length > 5 && (
+                    <p className="mt-2 text-xs text-muted-foreground">
+                      +{importPreview.errors.length - 5} erros adicionais
+                    </p>
+                  )}
+                </div>
+              )}
+
+              <div className="rounded-lg border p-3 text-xs text-muted-foreground">
+                <p className="font-semibold text-foreground mb-2">Amostra</p>
+                <div className="space-y-2">
+                  {importPreview.rows.slice(0, 3).map((row, index) => (
+                    <div key={`${row.keyDesc}-${index}`}>
+                      <p className="font-medium text-foreground">{row.aliasDesc}</p>
+                      <p>{row.source} ‚Ä¢ {row.keyDesc}</p>
+                    </div>
+                  ))}
+                </div>
+              </div>
+            </div>
+          )}
+          <DialogFooter>
+            <Button variant="outline" onClick={() => setImportPreview(null)}>
+              Cancelar
+            </Button>
+            <Button onClick={handleConfirmImport}>
+              Importar agora
+            </Button>
+          </DialogFooter>
+        </DialogContent>
+      </Dialog>
     </AppLayout>
   );
 }
diff --git a/client/src/pages/merchant-metadata.tsx b/client/src/pages/merchant-metadata.tsx
new file mode 100644
index 0000000..7a98830
--- /dev/null
+++ b/client/src/pages/merchant-metadata.tsx
@@ -0,0 +1,235 @@
+import AppLayout from "@/components/layout/app-layout";
+import { Button } from "@/components/ui/button";
+import { Card, CardContent } from "@/components/ui/card";
+import { Input } from "@/components/ui/input";
+import { Badge } from "@/components/ui/badge";
+import { Plus, Loader2, Edit2, Trash2, Search } from "lucide-react";
+import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
+import { merchantMetadataApi } from "@/lib/api";
+import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
+import { Label } from "@/components/ui/label";
+import { useState } from "react";
+import { useToast } from "@/hooks/use-toast";
+
+interface MerchantMetadataForm {
+  pattern: string;
+  friendlyName: string;
+  icon: string;
+  color: string;
+}
+
+const EMPTY_FORM: MerchantMetadataForm = {
+  pattern: "",
+  friendlyName: "",
+  icon: "shopping-cart",
+  color: "#6366f1",
+};
+
+export default function MerchantMetadataPage() {
+  const queryClient = useQueryClient();
+  const { toast } = useToast();
+  const [isOpen, setIsOpen] = useState(false);
+  const [editing, setEditing] = useState<any>(null);
+  const [formData, setFormData] = useState<MerchantMetadataForm>(EMPTY_FORM);
+  const [search, setSearch] = useState("");
+
+  const { data: metadata = [], isLoading } = useQuery({
+    queryKey: ["merchant-metadata"],
+    queryFn: merchantMetadataApi.list,
+  });
+
+  const createMutation = useMutation({
+    mutationFn: merchantMetadataApi.create,
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["merchant-metadata"] });
+      setIsOpen(false);
+      setFormData(EMPTY_FORM);
+      toast({ title: "Merchant criado" });
+    },
+  });
+
+  const updateMutation = useMutation({
+    mutationFn: ({ id, data }: { id: string; data: any }) => merchantMetadataApi.update(id, data),
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["merchant-metadata"] });
+      setIsOpen(false);
+      setEditing(null);
+      setFormData(EMPTY_FORM);
+      toast({ title: "Merchant atualizado" });
+    },
+  });
+
+  const deleteMutation = useMutation({
+    mutationFn: (id: string) => merchantMetadataApi.delete(id),
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["merchant-metadata"] });
+      toast({ title: "Merchant removido" });
+    },
+  });
+
+  const openCreate = () => {
+    setEditing(null);
+    setFormData(EMPTY_FORM);
+    setIsOpen(true);
+  };
+
+  const openEdit = (item: any) => {
+    setEditing(item);
+    setFormData({
+      pattern: item.pattern,
+      friendlyName: item.friendlyName,
+      icon: item.icon,
+      color: item.color || "#6366f1",
+    });
+    setIsOpen(true);
+  };
+
+  const handleSave = () => {
+    const payload = {
+      pattern: formData.pattern.trim().toUpperCase(),
+      friendlyName: formData.friendlyName.trim(),
+      icon: formData.icon.trim(),
+      color: formData.color,
+    };
+
+    if (!payload.pattern || !payload.friendlyName || !payload.icon) {
+      toast({ title: "Preencha todos os campos", variant: "destructive" });
+      return;
+    }
+
+    if (editing) {
+      updateMutation.mutate({ id: editing.id, data: payload });
+    } else {
+      createMutation.mutate(payload);
+    }
+  };
+
+  const filtered = metadata.filter((m: any) => {
+    const query = search.toLowerCase();
+    return (
+      query === "" ||
+      m.pattern.toLowerCase().includes(query) ||
+      m.friendlyName.toLowerCase().includes(query)
+    );
+  });
+
+  return (
+    <AppLayout>
+      <div className="container mx-auto p-6 space-y-6">
+        <div className="flex items-center justify-between">
+          <div>
+            <h1 className="text-3xl font-bold">Merchant Metadata</h1>
+            <p className="text-muted-foreground">Personalize √≠cones e cores de merchants</p>
+          </div>
+          <Button onClick={openCreate} className="gap-2">
+            <Plus className="h-4 w-4" />
+            Novo Merchant
+          </Button>
+        </div>
+
+        <Card>
+          <CardContent className="pt-6">
+            <div className="relative">
+              <Search className="absolute left-3 top-3 h-4 w-4 text-muted-foreground" />
+              <Input
+                placeholder="Buscar por padr√£o ou nome..."
+                className="pl-9"
+                value={search}
+                onChange={(e) => setSearch(e.target.value)}
+              />
+            </div>
+          </CardContent>
+        </Card>
+
+        {isLoading ? (
+          <div className="flex items-center justify-center py-16 text-muted-foreground">
+            <Loader2 className="h-6 w-6 animate-spin" />
+          </div>
+        ) : filtered.length === 0 ? (
+          <Card>
+            <CardContent className="py-12 text-center text-muted-foreground">
+              Nenhum merchant encontrado
+            </CardContent>
+          </Card>
+        ) : (
+          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
+            {filtered.map((item: any) => (
+              <Card key={item.id} className="hover:shadow-md transition-shadow">
+                <CardContent className="pt-6">
+                  <div className="flex items-start justify-between mb-3">
+                    <div>
+                      <p className="text-xs text-muted-foreground">Padr√£o</p>
+                      <p className="font-semibold">{item.pattern}</p>
+                    </div>
+                    <div className="flex gap-2">
+                      <Button size="icon" variant="ghost" onClick={() => openEdit(item)}>
+                        <span className="sr-only">Editar merchant</span>
+                        <Edit2 className="h-4 w-4" />
+                      </Button>
+                      <Button size="icon" variant="ghost" onClick={() => deleteMutation.mutate(item.id)}>
+                        <span className="sr-only">Excluir merchant</span>
+                        <Trash2 className="h-4 w-4" />
+                      </Button>
+                    </div>
+                  </div>
+                  <div className="flex items-center gap-2">
+                    <Badge variant="secondary">{item.friendlyName}</Badge>
+                    <Badge variant="outline">{item.icon}</Badge>
+                    <div
+                      className="w-4 h-4 rounded-full border"
+                      style={{ backgroundColor: item.color || "#6366f1" }}
+                    />
+                  </div>
+                </CardContent>
+              </Card>
+            ))}
+          </div>
+        )}
+
+        <Dialog open={isOpen} onOpenChange={setIsOpen}>
+          <DialogContent className="max-w-lg">
+            <DialogHeader>
+              <DialogTitle>{editing ? "Editar Merchant" : "Novo Merchant"}</DialogTitle>
+            </DialogHeader>
+            <div className="space-y-4">
+              <div>
+                <Label>Padr√£o (ex: AMAZON)</Label>
+                <Input
+                  value={formData.pattern}
+                  onChange={(e) => setFormData((prev) => ({ ...prev, pattern: e.target.value }))}
+                />
+              </div>
+              <div>
+                <Label>Nome amig√°vel</Label>
+                <Input
+                  value={formData.friendlyName}
+                  onChange={(e) => setFormData((prev) => ({ ...prev, friendlyName: e.target.value }))}
+                />
+              </div>
+              <div>
+                <Label>√çcone (Lucide)</Label>
+                <Input
+                  value={formData.icon}
+                  onChange={(e) => setFormData((prev) => ({ ...prev, icon: e.target.value }))}
+                />
+              </div>
+              <div>
+                <Label>Cor</Label>
+                <Input
+                  type="color"
+                  value={formData.color}
+                  onChange={(e) => setFormData((prev) => ({ ...prev, color: e.target.value }))}
+                />
+              </div>
+              <div className="flex justify-end">
+                <Button onClick={handleSave} disabled={createMutation.isPending || updateMutation.isPending}>
+                  Salvar
+                </Button>
+              </div>
+            </div>
+          </DialogContent>
+        </Dialog>
+      </div>
+    </AppLayout>
+  );
+}
diff --git a/client/src/pages/notifications.tsx b/client/src/pages/notifications.tsx
index 1bb247c..33d87ac 100644
--- a/client/src/pages/notifications.tsx
+++ b/client/src/pages/notifications.tsx
@@ -2,7 +2,6 @@
  * Notifications Page
  *
  * Timeline of system notifications with filtering and mark-as-read functionality.
- * Note: This is a UI shell - backend integration pending.
  */
 
 import AppLayout from "@/components/layout/app-layout";
@@ -13,20 +12,16 @@ import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
 import {
   Bell,
   CheckCheck,
-  Upload,
   AlertTriangle,
-  TrendingUp,
-  Calendar,
-  CreditCard,
-  Target,
-  Sparkles,
-  ChevronRight,
   Check
 } from "lucide-react";
 import { cn } from "@/lib/utils";
 import { format } from "date-fns";
 import { ptBR } from "date-fns/locale";
-import { useState } from "react";
+import { useMemo, useState } from "react";
+import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
+import { notificationsApi } from "@/lib/api";
+import { Link } from "wouter";
 
 interface Notification {
   id: string;
@@ -34,84 +29,24 @@ interface Notification {
   message: string;
   type: "success" | "warning" | "info" | "error";
   isRead: boolean;
-  createdAt: Date;
+  createdAt: string;
   actionUrl?: string;
   icon?: React.ComponentType<any>;
 }
 
-// Mock notifications (replace with API call when backend is ready)
-const MOCK_NOTIFICATIONS: Notification[] = [
-  {
-    id: "1",
-    title: "Upload conclu√≠do",
-    message: "426 transa√ß√µes importadas de Miles & More",
-    type: "success",
-    isRead: false,
-    createdAt: new Date(Date.now() - 1000 * 60 * 15), // 15 min ago
-    actionUrl: "/transactions",
-    icon: Upload
-  },
-  {
-    id: "2",
-    title: "Or√ßamento excedido",
-    message: "Voc√™ gastou ‚Ç¨250/‚Ç¨200 em Lazer este m√™s",
-    type: "warning",
-    isRead: false,
-    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 2), // 2 hours ago
-    actionUrl: "/dashboard",
-    icon: AlertTriangle
-  },
-  {
-    id: "3",
-    title: "Ritual semanal dispon√≠vel",
-    message: "Est√° na hora de revisar suas finan√ßas da semana",
-    type: "info",
-    isRead: false,
-    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 5), // 5 hours ago
-    actionUrl: "/rituals",
-    icon: Calendar
-  },
-  {
-    id: "4",
-    title: "Novas transa√ß√µes para confirmar",
-    message: "23 transa√ß√µes aguardam revis√£o na fila de confirma√ß√£o",
-    type: "info",
-    isRead: true,
-    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 24), // 1 day ago
-    actionUrl: "/confirm",
-    icon: CheckCheck
-  },
-  {
-    id: "5",
-    title: "Meta atingida",
-    message: "Parab√©ns! Voc√™ economizou ‚Ç¨500 este m√™s",
-    type: "success",
-    isRead: true,
-    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 24 * 2), // 2 days ago
-    actionUrl: "/goals",
-    icon: Target
-  },
-  {
-    id: "6",
-    title: "Fatura do cart√£o pr√≥xima",
-    message: "American Express vence em 5 dias (‚Ç¨1,234.56)",
-    type: "warning",
-    isRead: true,
-    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 24 * 3), // 3 days ago
-    actionUrl: "/accounts",
-    icon: CreditCard
-  },
-  {
-    id: "7",
-    title: "An√°lise de IA dispon√≠vel",
-    message: "Identificamos 15 novas palavras-chave para categoriza√ß√£o",
-    type: "info",
-    isRead: true,
-    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 24 * 5), // 5 days ago
-    actionUrl: "/ai-keywords",
-    icon: Sparkles
+const resolveNotificationAction = (notification: Notification) => {
+  const title = notification.title.toLowerCase();
+  if (title.includes("upload")) {
+    return { label: "Ver uploads", href: "/uploads" };
+  }
+  if (title.includes("meta")) {
+    return { label: "Ver metas", href: "/goals" };
   }
-];
+  if (title.includes("ritual")) {
+    return { label: "Ver rituais", href: "/rituals" };
+  }
+  return null;
+};
 
 const NOTIFICATION_COLORS = {
   success: {
@@ -141,29 +76,47 @@ const NOTIFICATION_COLORS = {
 };
 
 export default function NotificationsPage() {
-  const [notifications, setNotifications] = useState<Notification[]>(MOCK_NOTIFICATIONS);
   const [activeTab, setActiveTab] = useState("all");
+  const queryClient = useQueryClient();
 
-  const unreadCount = notifications.filter(n => !n.isRead).length;
+  const { data: notifications = [], isLoading } = useQuery<Notification[]>({
+    queryKey: ["notifications"],
+    queryFn: () => notificationsApi.list(),
+  });
 
-  const markAsRead = (id: string) => {
-    setNotifications(prev =>
-      prev.map(n => n.id === id ? { ...n, isRead: true } : n)
-    );
-  };
+  const unreadCount = notifications.filter((n) => !n.isRead).length;
+
+  const markReadMutation = useMutation({
+    mutationFn: ({ id, isRead }: { id: string; isRead: boolean }) => notificationsApi.markRead(id, isRead),
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["notifications"] });
+    },
+  });
+
+  const deleteMutation = useMutation({
+    mutationFn: (id: string) => notificationsApi.delete(id),
+    onSuccess: () => {
+      queryClient.invalidateQueries({ queryKey: ["notifications"] });
+    },
+  });
 
   const markAllAsRead = () => {
-    setNotifications(prev =>
-      prev.map(n => ({ ...n, isRead: true }))
-    );
+    const unread = notifications.filter((n) => !n.isRead);
+    Promise.all(unread.map((n) => markReadMutation.mutateAsync({ id: n.id, isRead: true })));
   };
 
-  const filteredNotifications = notifications.filter(n => {
+  const filteredNotifications = notifications.filter((n) => {
     if (activeTab === "unread") return !n.isRead;
     if (activeTab === "important") return n.type === "warning" || n.type === "error";
     return true;
   });
 
+  const typeCounts = useMemo(() => {
+    return {
+      important: notifications.filter((n) => n.type === "warning" || n.type === "error").length,
+    };
+  }, [notifications]);
+
   return (
     <AppLayout>
       <div className="space-y-6">
@@ -232,7 +185,7 @@ export default function NotificationsPage() {
                 <div>
                   <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">Importantes</p>
                   <p className="text-3xl font-bold mt-1">
-                    {notifications.filter(n => n.type === "warning" || n.type === "error").length}
+                    {typeCounts.important}
                   </p>
                   <p className="text-xs text-muted-foreground mt-1">alertas</p>
                 </div>
@@ -266,138 +219,118 @@ export default function NotificationsPage() {
               </TabsList>
             </div>
 
-            <TabsContent value={activeTab} className="m-0">
-              <CardContent className="p-0">
-                {filteredNotifications.length === 0 ? (
-                  <div className="flex flex-col items-center justify-center py-16 px-4">
-                    <div className="w-16 h-16 rounded-full bg-muted/30 flex items-center justify-center mb-4">
-                      <Bell className="h-8 w-8 text-muted-foreground" />
-                    </div>
-                    <h3 className="text-lg font-semibold mb-1">Nenhuma notifica√ß√£o</h3>
-                    <p className="text-sm text-muted-foreground text-center">
-                      {activeTab === "unread"
-                        ? "Voc√™ est√° em dia! N√£o h√° notifica√ß√µes n√£o lidas."
-                        : "N√£o h√° notifica√ß√µes para exibir neste momento."}
-                    </p>
-                  </div>
-                ) : (
-                  <div className="divide-y">
-                    {filteredNotifications.map((notification) => {
-                      const colors = NOTIFICATION_COLORS[notification.type];
-                      const Icon = notification.icon || Bell;
-
-                      return (
-                        <div
-                          key={notification.id}
-                          className={cn(
-                            "p-5 transition-colors hover:bg-muted/30 cursor-pointer relative",
-                            !notification.isRead && "bg-primary/[0.02]"
-                          )}
-                          onClick={() => {
-                            if (!notification.isRead) {
-                              markAsRead(notification.id);
-                            }
-                            if (notification.actionUrl) {
-                              window.location.href = notification.actionUrl;
-                            }
-                          }}
-                        >
-                          {/* Unread indicator */}
-                          {!notification.isRead && (
-                            <div className={cn("absolute left-0 top-0 bottom-0 w-1", colors.dot)} />
-                          )}
-
-                          <div className="flex items-start gap-4">
-                            {/* Icon */}
-                            <div
-                              className={cn(
-                                "w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",
-                                colors.bg,
-                                "border",
-                                colors.border
-                              )}
-                            >
-                              <Icon className={cn("h-5 w-5", colors.icon)} />
-                            </div>
+            <TabsContent value={activeTab} className="p-6">
+              {isLoading ? (
+                <div className="py-12 text-center text-muted-foreground">
+                  Carregando notifica√ß√µes...
+                </div>
+              ) : filteredNotifications.length === 0 ? (
+                <div className="text-center py-12">
+                  <Bell className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
+                  <h3 className="text-lg font-semibold mb-1">Nenhuma notifica√ß√£o</h3>
+                  <p className="text-muted-foreground text-sm max-w-sm mx-auto">
+                    {activeTab === "unread"
+                      ? "Voc√™ est√° em dia! N√£o h√° notifica√ß√µes n√£o lidas."
+                      : "N√£o h√° notifica√ß√µes para exibir neste momento."}
+                  </p>
+                </div>
+              ) : (
+                <div className="space-y-3">
+                  {filteredNotifications.map((notification) => {
+                    const colors = NOTIFICATION_COLORS[notification.type];
+                    const Icon = notification.icon || Bell;
+                    const action = resolveNotificationAction(notification);
 
-                            {/* Content */}
-                            <div className="flex-1 min-w-0">
-                              <div className="flex items-start justify-between gap-2 mb-1">
-                                <h3 className={cn(
-                                  "font-semibold text-sm",
+                    return (
+                      <div
+                        key={notification.id}
+                        className={cn(
+                          "p-4 rounded-lg border transition-all cursor-pointer",
+                          colors.bg,
+                          colors.border,
+                          !notification.isRead && "bg-primary/[0.02]"
+                        )}
+                        onClick={() => {
+                          if (!notification.isRead) {
+                            markReadMutation.mutate({ id: notification.id, isRead: true });
+                          }
+                        }}
+                      >
+                        <div className="flex items-start gap-4">
+                          <div className={cn("w-10 h-10 rounded-lg flex items-center justify-center", colors.bg)}>
+                            <Icon className={cn("h-5 w-5", colors.icon)} />
+                          </div>
+                          <div className="flex-1">
+                            <div className="flex items-center justify-between mb-1">
+                              <h3
+                                className={cn(
+                                  "font-semibold",
                                   !notification.isRead && "text-foreground"
-                                )}>
-                                  {notification.title}
-                                </h3>
-                                <time className="text-xs text-muted-foreground flex-shrink-0">
-                                  {format(notification.createdAt, "HH:mm", { locale: ptBR })}
-                                </time>
-                              </div>
-                              <p className="text-sm text-muted-foreground mb-2">
-                                {notification.message}
-                              </p>
-                              <div className="flex items-center gap-3">
-                                <time className="text-xs text-muted-foreground">
-                                  {format(notification.createdAt, "dd 'de' MMMM", { locale: ptBR })}
-                                </time>
-                                {notification.actionUrl && (
-                                  <>
-                                    <span className="text-xs text-muted-foreground">‚Ä¢</span>
-                                    <button
-                                      className="text-xs font-medium text-primary hover:underline flex items-center gap-1"
-                                      onClick={(e) => {
-                                        e.stopPropagation();
-                                        window.location.href = notification.actionUrl!;
-                                      }}
+                                )}
+                              >
+                                {notification.title}
+                              </h3>
+                              <span className="text-xs text-muted-foreground">
+                                {format(new Date(notification.createdAt), "HH:mm", { locale: ptBR })}
+                              </span>
+                            </div>
+                            <p className="text-sm text-muted-foreground mb-2">
+                              {notification.message}
+                            </p>
+                            <div className="flex items-center justify-between">
+                              <span className="text-xs text-muted-foreground">
+                                {format(new Date(notification.createdAt), "dd 'de' MMMM", { locale: ptBR })}
+                              </span>
+                              <div className="flex items-center gap-2">
+                                {action && (
+                                  <Link href={action.href}>
+                                    <Button
+                                      size="sm"
+                                      variant="outline"
+                                      className="text-xs"
+                                      onClick={(e) => e.stopPropagation()}
                                     >
-                                      Ver detalhes
-                                      <ChevronRight className="h-3 w-3" />
-                                    </button>
-                                  </>
+                                      {action.label}
+                                    </Button>
+                                  </Link>
                                 )}
+                                {!notification.isRead && (
+                                  <Button
+                                    size="sm"
+                                    variant="ghost"
+                                    className="text-xs"
+                                    onClick={(e) => {
+                                      e.stopPropagation();
+                                      markReadMutation.mutate({ id: notification.id, isRead: true });
+                                    }}
+                                  >
+                                    <Check className="h-3.5 w-3.5 mr-1" />
+                                    Marcar como lida
+                                  </Button>
+                                )}
+                                <Button
+                                  size="sm"
+                                  variant="ghost"
+                                  className="text-xs text-rose-600"
+                                  onClick={(e) => {
+                                    e.stopPropagation();
+                                    deleteMutation.mutate(notification.id);
+                                  }}
+                                >
+                                  Excluir
+                                </Button>
                               </div>
                             </div>
-
-                            {/* Mark as read button */}
-                            {!notification.isRead && (
-                              <Button
-                                variant="ghost"
-                                size="sm"
-                                onClick={(e) => {
-                                  e.stopPropagation();
-                                  markAsRead(notification.id);
-                                }}
-                                className="flex-shrink-0 h-8 w-8 p-0"
-                              >
-                                <Check className="h-4 w-4" />
-                              </Button>
-                            )}
                           </div>
                         </div>
-                      );
-                    })}
-                  </div>
-                )}
-              </CardContent>
+                      </div>
+                    );
+                  })}
+                </div>
+              )}
             </TabsContent>
           </Tabs>
         </Card>
-
-        {/* Backend Integration Note */}
-        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
-          <div className="flex items-start gap-3">
-            <Sparkles className="h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5" />
-            <div>
-              <p className="font-medium text-sm text-blue-900 mb-1">
-                P√°gina em desenvolvimento
-              </p>
-              <p className="text-xs text-blue-700">
-                Esta √© uma interface de demonstra√ß√£o. A integra√ß√£o com o backend para
-                notifica√ß√µes reais est√° pendente e ser√° implementada na pr√≥xima fase.
-              </p>
-            </div>
-          </div>
-        </div>
       </div>
     </AppLayout>
   );
diff --git a/client/src/pages/rituals.tsx b/client/src/pages/rituals.tsx
index d8db421..4fcd0cb 100644
--- a/client/src/pages/rituals.tsx
+++ b/client/src/pages/rituals.tsx
@@ -36,7 +36,7 @@ import { useMonth } from "@/lib/month-context";
 import { Link } from "wouter";
 import { useState } from "react";
 import { useToast } from "@/hooks/use-toast";
-import { ritualsApi } from "@/lib/api";
+import { ritualsApi, dashboardApi } from "@/lib/api";
 import { queryClient } from "@/lib/queryClient";
 
 const CATEGORY_ICONS: Record<string, any> = {
@@ -93,20 +93,12 @@ export default function RitualsPage() {
 
   const { data: dashboard } = useQuery({
     queryKey: ["dashboard", month],
-    queryFn: async () => {
-      const res = await fetch(`/api/dashboard?month=${month}`);
-      if (!res.ok) return null;
-      return res.json();
-    }
+    queryFn: () => dashboardApi.get(month),
   });
 
   const { data: previousMonth } = useQuery({
     queryKey: ["dashboard-previous", getPreviousMonth(month)],
-    queryFn: async () => {
-      const res = await fetch(`/api/dashboard?month=${getPreviousMonth(month)}`);
-      if (!res.ok) return null;
-      return res.json();
-    }
+    queryFn: () => dashboardApi.get(getPreviousMonth(month)),
   });
 
   // Fetch existing rituals for current period
@@ -115,6 +107,11 @@ export default function RitualsPage() {
     queryFn: () => ritualsApi.list(ritualType, currentPeriod),
   });
 
+  const { data: ritualsHistory } = useQuery({
+    queryKey: ["rituals-history", ritualType],
+    queryFn: () => ritualsApi.list(ritualType),
+  });
+
   const currentRitual = ritualsData?.rituals?.[0];
   const isCompleted = currentRitual?.completedAt !== null;
 
@@ -191,6 +188,10 @@ export default function RitualsPage() {
     ? Math.round(((totalCurrentSpent - previousMonth.totalSpent) / previousMonth.totalSpent) * 100)
     : 0;
 
+  const historyItems = (ritualsHistory?.rituals || [])
+    .filter((r: any) => r.completedAt && r.period !== currentPeriod)
+    .slice(0, 5);
+
   const copyPreviousGoals = () => {
     toast({ title: `Metas de ${previousMonthName} copiadas para ${currentMonthName}` });
   };
@@ -573,6 +574,49 @@ export default function RitualsPage() {
             </Card>
           </TabsContent>
         </Tabs>
+
+        <Card className="bg-white border-0 shadow-sm">
+          <CardHeader className="flex flex-row items-center justify-between">
+            <div>
+              <CardTitle className="flex items-center gap-2">
+                <CalendarCheck className="h-5 w-5 text-primary" />
+                Hist√≥rico de rituais
+              </CardTitle>
+              <p className="text-sm text-muted-foreground mt-1">
+                Acompanhe acordos e decis√µes anteriores
+              </p>
+            </div>
+            <Badge variant="secondary">{historyItems.length} itens</Badge>
+          </CardHeader>
+          <CardContent className="space-y-3">
+            {historyItems.length === 0 ? (
+              <div className="text-sm text-muted-foreground">
+                Nenhum ritual conclu√≠do anteriormente.
+              </div>
+            ) : (
+              historyItems.map((item: any) => (
+                <div key={item.id} className="border rounded-lg p-3 flex items-start justify-between gap-4">
+                  <div>
+                    <p className="font-medium">
+                      {item.type === "weekly" ? "Ritual Semanal" : "Ritual Mensal"} ‚Ä¢ {item.period}
+                    </p>
+                    <p className="text-xs text-muted-foreground mt-1">
+                      Conclu√≠do em {new Date(item.completedAt).toLocaleDateString("pt-BR")}
+                    </p>
+                    {item.notes && (
+                      <p className="text-sm text-muted-foreground mt-2 line-clamp-2">
+                        {item.notes}
+                      </p>
+                    )}
+                  </div>
+                  <Badge variant="outline" className="text-[10px]">
+                    Conclu√≠do
+                  </Badge>
+                </div>
+              ))
+            )}
+          </CardContent>
+        </Card>
       </div>
     </AppLayout>
   );
diff --git a/client/src/pages/rules.tsx b/client/src/pages/rules.tsx
index 534bd0c..40caa95 100644
--- a/client/src/pages/rules.tsx
+++ b/client/src/pages/rules.tsx
@@ -5,14 +5,17 @@ import { Input } from "@/components/ui/input";
 import { Badge } from "@/components/ui/badge";
 import { Plus, Search, Trash2, Loader2, Sparkles, BookOpen, Settings2, Zap, Edit2, RefreshCw, ShoppingBag, Home, Car, Heart, Coffee, Globe, CircleDollarSign, ArrowLeftRight, Hash, Filter, Check, Download, Upload } from "lucide-react";
 import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
-import { rulesApi } from "@/lib/api";
+import { rulesApi, transactionsApi } from "@/lib/api";
 import { useToast } from "@/hooks/use-toast";
 import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from "@/components/ui/dialog";
 import { Label } from "@/components/ui/label";
 import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
-import { useState, useRef } from "react";
+import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
+import { useEffect, useState, useRef } from "react";
 import { cn } from "@/lib/utils";
 import { Switch } from "@/components/ui/switch";
+import { AIKeywordsPanel } from "@/components/ai-keywords-panel";
+import { useLocation } from "wouter";
 import * as XLSX from 'xlsx';
 
 const TYPE_COLORS: Record<string, string> = {
@@ -44,6 +47,18 @@ const CATEGORY_COLORS: Record<string, string> = {
   "Outros": "#6b7280"
 };
 
+const CATEGORY_OPTIONS = [
+  "Mercado",
+  "Moradia",
+  "Transporte",
+  "Sa√∫de",
+  "Lazer",
+  "Compras Online",
+  "Receitas",
+  "Interno",
+  "Outros"
+];
+
 interface RuleFormData {
   name: string;
   keywords: string;
@@ -69,6 +84,7 @@ const EMPTY_RULE: RuleFormData = {
 };
 
 export default function RulesPage() {
+  const [location] = useLocation();
   const queryClient = useQueryClient();
   const { toast } = useToast();
   const [isOpen, setIsOpen] = useState(false);
@@ -76,13 +92,23 @@ export default function RulesPage() {
   const [categoryFilter, setCategoryFilter] = useState("all");
   const [editingRule, setEditingRule] = useState<any>(null);
   const [formData, setFormData] = useState<RuleFormData>(EMPTY_RULE);
+  const [activeTab, setActiveTab] = useState("rules");
+  const [previewData, setPreviewData] = useState<{ count: number; samples: string[]; scanned: number } | null>(null);
+  const [previewLoading, setPreviewLoading] = useState(false);
   const fileInputRef = useRef<HTMLInputElement>(null);
+  const prefillHandledRef = useRef(false);
+  const previewTimeoutRef = useRef<number | null>(null);
 
   const { data: rules = [], isLoading } = useQuery({
     queryKey: ["rules"],
     queryFn: rulesApi.list,
   });
 
+  const { data: confirmQueue = [] } = useQuery({
+    queryKey: ["confirm-queue"],
+    queryFn: transactionsApi.confirmQueue,
+  });
+
   const createMutation = useMutation({
     mutationFn: rulesApi.create,
     onSuccess: () => {
@@ -145,6 +171,68 @@ export default function RulesPage() {
     setIsOpen(true);
   };
 
+  useEffect(() => {
+    if (prefillHandledRef.current) return;
+    const search = location.split("?")[1];
+    if (!search) return;
+
+    const params = new URLSearchParams(search);
+    if (params.get("prefill") !== "1") return;
+
+    const prefillData: RuleFormData = {
+      name: params.get("name") || "",
+      keywords: params.get("keywords") || "",
+      type: (params.get("type") as RuleFormData["type"]) || "Despesa",
+      fixVar: (params.get("fixVar") as RuleFormData["fixVar"]) || "Vari√°vel",
+      category1: params.get("category1") || "Outros",
+      category2: params.get("category2") || "",
+      category3: params.get("category3") || "",
+      priority: 600,
+      strict: false
+    };
+
+    setFormData({ ...EMPTY_RULE, ...prefillData });
+    setEditingRule(null);
+    setIsOpen(true);
+    prefillHandledRef.current = true;
+
+    window.history.replaceState({}, "", "/rules");
+  }, [location]);
+
+  useEffect(() => {
+    if (!isOpen) {
+      setPreviewData(null);
+      return;
+    }
+    if (!formData.keywords.trim()) {
+      setPreviewData(null);
+      return;
+    }
+    if (previewTimeoutRef.current) {
+      window.clearTimeout(previewTimeoutRef.current);
+    }
+    previewTimeoutRef.current = window.setTimeout(async () => {
+      try {
+        setPreviewLoading(true);
+        const data = await rulesApi.preview({
+          keywords: formData.keywords,
+          scope: "pending"
+        });
+        setPreviewData(data);
+      } catch (_error) {
+        setPreviewData(null);
+      } finally {
+        setPreviewLoading(false);
+      }
+    }, 500);
+
+    return () => {
+      if (previewTimeoutRef.current) {
+        window.clearTimeout(previewTimeoutRef.current);
+      }
+    };
+  }, [formData.keywords, isOpen]);
+
   const handleDownloadExcel = () => {
     if (rules.length === 0) {
       toast({ title: "Nenhuma regra para exportar", variant: "destructive" });
@@ -182,9 +270,29 @@ export default function RulesPage() {
       { wch: 10 }  // Sistema
     ];
 
+    const classificationRows = CATEGORY_OPTIONS.map((category) => ({
+      'Categoria 1': category,
+      'Categoria 2': '',
+      'Categoria 3': '',
+      'Tipo (Despesa/Receita)': '',
+      'Fixo/Vari√°vel': '',
+      'Palavras-chave': ''
+    }));
+
+    const classificationsSheet = XLSX.utils.json_to_sheet(classificationRows);
+    classificationsSheet['!cols'] = [
+      { wch: 20 }, // Categoria 1
+      { wch: 25 }, // Categoria 2
+      { wch: 25 }, // Categoria 3
+      { wch: 18 }, // Tipo
+      { wch: 15 }, // Fixo/Vari√°vel
+      { wch: 50 }  // Palavras-chave
+    ];
+
     // Create workbook
     const wb = XLSX.utils.book_new();
     XLSX.utils.book_append_sheet(wb, ws, 'Regras');
+    XLSX.utils.book_append_sheet(wb, classificationsSheet, 'Classificacoes');
 
     // Generate filename with current date
     const date = new Date().toISOString().split('T')[0];
@@ -205,9 +313,15 @@ export default function RulesPage() {
       try {
         const data = e.target?.result;
         const workbook = XLSX.read(data, { type: 'binary' });
-        const sheetName = workbook.SheetNames[0];
-        const worksheet = workbook.Sheets[sheetName];
-        const jsonData = XLSX.utils.sheet_to_json(worksheet);
+        const targetSheets = workbook.SheetNames.filter((name: string) =>
+          ["regras", "classificacoes", "classifica√ß√µes"].includes(name.toLowerCase())
+        );
+
+        const sheetsToParse = targetSheets.length > 0 ? targetSheets : [workbook.SheetNames[0]];
+        const jsonData = sheetsToParse.flatMap((sheetName: string) => {
+          const worksheet = workbook.Sheets[sheetName];
+          return XLSX.utils.sheet_to_json(worksheet);
+        });
 
         if (jsonData.length === 0) {
           toast({ title: "Arquivo vazio", variant: "destructive" });
@@ -222,12 +336,8 @@ export default function RulesPage() {
           const rowNum = index + 2; // +2 because Excel is 1-indexed and has header row
 
           // Validate required fields
-          if (!row['Nome']) {
-            errors.push(`Linha ${rowNum}: Nome √© obrigat√≥rio`);
-            return;
-          }
-          if (!row['Palavras-chave']) {
-            errors.push(`Linha ${rowNum}: Palavras-chave √© obrigat√≥rio`);
+          const hasKeywords = !!row['Palavras-chave'];
+          if (!hasKeywords) {
             return;
           }
           if (!row['Tipo (Despesa/Receita)'] || !['Despesa', 'Receita'].includes(row['Tipo (Despesa/Receita)'])) {
@@ -248,8 +358,10 @@ export default function RulesPage() {
             return;
           }
 
+          const name = row['Nome'] || row['Categoria 3'] || row['Categoria 2'] || row['Categoria 1'];
+
           rulesToImport.push({
-            name: row['Nome'],
+            name,
             keywords: row['Palavras-chave'],
             type: row['Tipo (Despesa/Receita)'],
             fixVar: row['Fixo/Vari√°vel'],
@@ -358,6 +470,7 @@ export default function RulesPage() {
   const systemRules = filteredRules.filter((r: any) => r.isSystem);
   const userRules = filteredRules.filter((r: any) => !r.isSystem);
   const categories = Array.from(new Set(rules.map((r: any) => r.category1))) as string[];
+  const pendingCount = confirmQueue.length;
 
   if (isLoading) {
     return (
@@ -371,8 +484,14 @@ export default function RulesPage() {
 
   return (
     <AppLayout>
-      <div className="space-y-6">
-        <div className="flex flex-col md:flex-row md:items-start justify-between gap-4">
+      <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
+        <TabsList className="w-full max-w-[420px] grid grid-cols-2">
+          <TabsTrigger value="rules">Regras</TabsTrigger>
+          <TabsTrigger value="suggestions">Sugest√µes IA</TabsTrigger>
+        </TabsList>
+
+        <TabsContent value="rules" className="space-y-6">
+          <div className="flex flex-col md:flex-row md:items-start justify-between gap-4">
           <div>
             <div className="flex items-center gap-2 mb-1">
               <h1 className="text-2xl font-bold">Motor de Regras</h1>
@@ -382,7 +501,7 @@ export default function RulesPage() {
               </Badge>
             </div>
             <p className="text-muted-foreground">
-              Categorize transacoes automaticamente com regras baseadas em palavras-chave.
+              Categorize transa√ß√µes automaticamente com regras baseadas em palavras-chave.
             </p>
           </div>
           
@@ -411,6 +530,11 @@ export default function RulesPage() {
                 <RefreshCw className="h-4 w-4" />
               )}
               Reaplicar Regras
+              {pendingCount > 0 && (
+                <Badge variant="secondary" className="bg-muted text-muted-foreground text-[10px] ml-1">
+                  {pendingCount} pendentes
+                </Badge>
+              )}
             </Button>
 
             <Button
@@ -538,7 +662,7 @@ export default function RulesPage() {
               </div>
               <h3 className="text-lg font-semibold mb-2">Nenhuma regra configurada</h3>
               <p className="text-muted-foreground mb-6 max-w-md mx-auto">
-                Crie regras para categorizar suas transacoes automaticamente durante a importacao.
+                Crie regras para categorizar suas transa√ß√µes automaticamente durante a importa√ß√£o.
               </p>
               <div className="flex gap-3 justify-center">
                 <Button 
@@ -548,7 +672,7 @@ export default function RulesPage() {
                   className="gap-2"
                 >
                   <Zap className="h-4 w-4" />
-                  Criar Regras Padrao
+                  Criar Regras Padr√£o
                 </Button>
                 <Button className="gap-2" onClick={openNewDialog}>
                   <Plus className="h-4 w-4" />
@@ -601,6 +725,7 @@ export default function RulesPage() {
                           size="icon" 
                           className="h-8 w-8"
                           onClick={() => openEditDialog(rule)}
+                          aria-label="Editar regra"
                         >
                           <Edit2 className="h-4 w-4" />
                         </Button>
@@ -611,6 +736,7 @@ export default function RulesPage() {
                             className="h-8 w-8 text-rose-500 hover:text-rose-600 hover:bg-rose-50"
                             onClick={() => deleteMutation.mutate(rule.id)}
                             data-testid={`btn-delete-rule-${rule.id}`}
+                            aria-label="Excluir regra"
                           >
                             <Trash2 className="h-4 w-4" />
                           </Button>
@@ -687,15 +813,11 @@ export default function RulesPage() {
                     <SelectValue />
                   </SelectTrigger>
                   <SelectContent>
-                    <SelectItem value="Mercado">Mercado</SelectItem>
-                    <SelectItem value="Moradia">Moradia</SelectItem>
-                    <SelectItem value="Transporte">Transporte</SelectItem>
-                    <SelectItem value="Sa√∫de">Saude</SelectItem>
-                    <SelectItem value="Lazer">Lazer</SelectItem>
-                    <SelectItem value="Compras Online">Compras Online</SelectItem>
-                    <SelectItem value="Receitas">Receitas</SelectItem>
-                    <SelectItem value="Interno">Interno</SelectItem>
-                    <SelectItem value="Outros">Outros</SelectItem>
+                    {CATEGORY_OPTIONS.map((category) => (
+                      <SelectItem key={category} value={category}>
+                        {category}
+                      </SelectItem>
+                    ))}
                   </SelectContent>
                 </Select>
               </div>
@@ -727,6 +849,10 @@ export default function RulesPage() {
                 </div>
               </div>
 
+              <p className="text-xs text-muted-foreground">
+                N√≠vel 1 define a macro categoria. N√≠vel 2 aprofunda o tipo (ex: Supermercado). N√≠vel 3 detalha o merchant (ex: LIDL).
+              </p>
+
               <div className="space-y-2">
                 <Label className="text-xs text-muted-foreground uppercase tracking-wide">Palavras-chave</Label>
                 <Input
@@ -736,7 +862,22 @@ export default function RulesPage() {
                   className="bg-muted/30 border-0"
                   data-testid="input-rule-keywords"
                 />
-                <p className="text-xs text-muted-foreground">Separe multiplas palavras com ponto e virgula (;)</p>
+                <p className="text-xs text-muted-foreground">Separe m√∫ltiplas palavras com ponto e v√≠rgula (;)</p>
+                {previewLoading && (
+                  <div className="text-xs text-muted-foreground">Calculando impacto...</div>
+                )}
+                {previewData && !previewLoading && (
+                  <div className="rounded-lg border bg-muted/20 p-3 text-xs text-muted-foreground">
+                    <p className="font-semibold text-foreground">
+                      Impacto estimado: {previewData.count} transa√ß√µes na fila
+                    </p>
+                    {previewData.samples.length > 0 && (
+                      <p className="mt-2">
+                        Exemplos: {previewData.samples.slice(0, 3).map((sample) => sample.split(" -- ")[0]).join(" ‚Ä¢ ")}
+                      </p>
+                    )}
+                  </div>
+                )}
               </div>
 
               <div className="grid grid-cols-2 gap-4">
@@ -770,7 +911,7 @@ export default function RulesPage() {
                   </div>
                 </div>
                 <div className="space-y-2">
-                  <Label className="text-xs text-muted-foreground uppercase tracking-wide">Variacao</Label>
+                  <Label className="text-xs text-muted-foreground uppercase tracking-wide">Varia√ß√£o</Label>
                   <div className="flex gap-2">
                     <Button
                       type="button"
@@ -788,7 +929,7 @@ export default function RulesPage() {
                       className="flex-1"
                       onClick={() => setFormData({ ...formData, fixVar: "Vari√°vel" })}
                     >
-                      Variavel
+                      Vari√°vel
                     </Button>
                   </div>
                 </div>
@@ -797,7 +938,7 @@ export default function RulesPage() {
               <div className="flex items-center justify-between p-4 bg-muted/30 rounded-xl">
                 <div>
                   <p className="font-medium text-sm">Regra Estrita</p>
-                  <p className="text-xs text-muted-foreground">Aplicar automaticamente com 100% confianca</p>
+                  <p className="text-xs text-muted-foreground">Aplicar automaticamente com 100% confian√ßa</p>
                 </div>
                 <Switch
                   checked={formData.strict}
@@ -824,7 +965,11 @@ export default function RulesPage() {
             </DialogFooter>
           </DialogContent>
         </Dialog>
-      </div>
+        </TabsContent>
+        <TabsContent value="suggestions">
+          <AIKeywordsPanel embedded />
+        </TabsContent>
+      </Tabs>
     </AppLayout>
   );
 }
diff --git a/client/src/pages/settings.tsx b/client/src/pages/settings.tsx
index f68e30c..854c966 100644
--- a/client/src/pages/settings.tsx
+++ b/client/src/pages/settings.tsx
@@ -7,7 +7,7 @@ import { Switch } from "@/components/ui/switch";
 import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
 import { Textarea } from "@/components/ui/textarea";
 import { Slider } from "@/components/ui/slider";
-import { User, Shield, Settings, Bell, Eye, Check, Globe, Palette, Database, Trash2, Download, Key, CreditCard, Mail, Moon, Sun, Sparkles } from "lucide-react";
+import { User, Shield, Settings, Bell, Eye, Check, Globe, Palette, Database, Trash2, Download, Key, CreditCard, Mail, Moon, Sun, Sparkles, BookOpen } from "lucide-react";
 import { cn } from "@/lib/utils";
 import { useState } from "react";
 import { Badge } from "@/components/ui/badge";
@@ -16,12 +16,13 @@ import { useQuery, useMutation } from "@tanstack/react-query";
 import { settingsApi } from "@/lib/api";
 import { queryClient } from "@/lib/queryClient";
 import { useToast } from "@/hooks/use-toast";
+import { Link } from "wouter";
 
 const TABS = [
-  { id: "conta", label: "Conta", icon: User, description: "Perfil e informacoes pessoais" },
-  { id: "preferencias", label: "Preferencias", icon: Settings, description: "Aparencia e comportamento" },
-  { id: "integracoes", label: "Integracoes", icon: Database, description: "Conexoes com outros servicos" },
-  { id: "seguranca", label: "Seguranca", icon: Shield, description: "Senha e autenticacao" },
+  { id: "conta", label: "Conta", icon: User, description: "Perfil e informa√ß√µes pessoais" },
+  { id: "preferencias", label: "Prefer√™ncias", icon: Settings, description: "Apar√™ncia e comportamento" },
+  { id: "integracoes", label: "Integra√ß√µes", icon: Database, description: "Conex√µes com outros servi√ßos" },
+  { id: "seguranca", label: "Seguran√ßa", icon: Shield, description: "Senha e autentica√ß√£o" },
 ];
 
 export default function SettingsPage() {
@@ -44,14 +45,14 @@ export default function SettingsPage() {
     onSuccess: () => {
       queryClient.invalidateQueries({ queryKey: ["settings"] });
       toast({
-        title: "Configuracoes salvas",
+        title: "Configura√ß√µes salvas",
         description: "Suas preferencias foram atualizadas com sucesso.",
       });
     },
     onError: () => {
       toast({
         title: "Erro ao salvar",
-        description: "Nao foi possivel salvar as configuracoes.",
+        description: "N√£o foi poss√≠vel salvar as configura√ß√µes.",
         variant: "destructive",
       });
     },
@@ -61,7 +62,7 @@ export default function SettingsPage() {
     <AppLayout>
       <div className="space-y-6">
         <div>
-          <h1 className="text-2xl font-bold">Configuracoes</h1>
+        <h1 className="text-2xl font-bold">Configura√ß√µes</h1>
           <p className="text-muted-foreground mt-1">
             Gerencie sua conta e personalize o RitualFin.
           </p>
@@ -142,18 +143,19 @@ export default function SettingsPage() {
                     <CardTitle className="text-base flex items-center gap-2">
                       <Download className="h-4 w-4 text-primary" />
                       Exportar Dados
+                      <Badge variant="secondary" className="text-[10px]">Em breve</Badge>
                     </CardTitle>
                     <CardDescription>
-                      Baixe todas as suas transacoes e configuracoes.
+                      Baixe todas as suas transa√ß√µes e configura√ß√µes.
                     </CardDescription>
                   </CardHeader>
                   <CardContent>
                     <div className="flex gap-3">
-                      <Button variant="outline" className="gap-2">
+                      <Button variant="outline" className="gap-2" disabled>
                         <Download className="h-4 w-4" />
                         Exportar CSV
                       </Button>
-                      <Button variant="outline" className="gap-2">
+                      <Button variant="outline" className="gap-2" disabled>
                         <Download className="h-4 w-4" />
                         Exportar JSON
                       </Button>
@@ -219,7 +221,10 @@ export default function SettingsPage() {
                           <p className="text-sm text-muted-foreground">Ativar modo noturno</p>
                         </div>
                       </div>
-                      <Switch checked={darkMode} onCheckedChange={setDarkMode} />
+                      <div className="flex items-center gap-2">
+                        <Badge variant="secondary" className="text-[10px]">Em breve</Badge>
+                        <Switch checked={darkMode} onCheckedChange={setDarkMode} disabled />
+                      </div>
                     </div>
                     <div className="flex items-center justify-between p-4 bg-muted/30 rounded-xl">
                       <div>
@@ -251,9 +256,9 @@ export default function SettingsPage() {
                     </div>
                     <div className="flex items-center justify-between p-4 bg-muted/30 rounded-xl">
                       <div>
-                        <p className="font-medium">Auto-confirmar Alta Confianca</p>
+                          <p className="font-medium">Auto-confirmar Alta Confian√ßa</p>
                         <p className="text-sm text-muted-foreground">
-                          Aceitar automaticamente sugestoes com {settings?.confidenceThreshold || 80}%+ de confianca
+                          Aceitar automaticamente sugest√µes com {settings?.confidenceThreshold || 80}%+ de confian√ßa
                         </p>
                       </div>
                       <Switch
@@ -267,7 +272,7 @@ export default function SettingsPage() {
                     {settings?.autoConfirmHighConfidence && (
                       <div className="p-4 bg-muted/30 rounded-xl space-y-3">
                         <div className="flex items-center justify-between">
-                          <Label className="text-sm font-medium">Limite de Confianca</Label>
+                          <Label className="text-sm font-medium">Limite de Confian√ßa</Label>
                           <span className="text-sm font-bold text-primary">{settings?.confidenceThreshold || 80}%</span>
                         </div>
                         <Slider
@@ -282,7 +287,7 @@ export default function SettingsPage() {
                           className="w-full"
                         />
                         <p className="text-xs text-muted-foreground">
-                          Transacoes com confianca acima deste limite serao confirmadas automaticamente
+                        Transa√ß√µes com confian√ßa acima deste limite ser√£o confirmadas automaticamente
                         </p>
                       </div>
                     )}
@@ -292,60 +297,88 @@ export default function SettingsPage() {
             )}
 
             {activeTab === "integracoes" && (
-              <Card className="bg-white border-0 shadow-sm">
-                <CardHeader>
-                  <CardTitle className="text-base flex items-center gap-2">
-                    <Database className="h-4 w-4 text-primary" />
-                    Fontes de Dados
-                  </CardTitle>
-                  <CardDescription>
-                    Conecte suas contas bancarias e cartoes via importacao CSV.
-                  </CardDescription>
-                </CardHeader>
-                <CardContent className="space-y-4">
-                  <div className="flex items-center justify-between p-4 bg-primary/5 rounded-xl border border-primary/20">
-                    <div className="flex items-center gap-3">
-                      <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
-                        <CreditCard className="h-5 w-5 text-blue-600" />
-                      </div>
-                      <div>
-                        <p className="font-medium">Miles & More</p>
-                        <p className="text-sm text-muted-foreground">Importacao CSV ativa</p>
+              <>
+                <Card className="bg-white border-0 shadow-sm">
+                  <CardHeader>
+                    <CardTitle className="text-base flex items-center gap-2">
+                      <Database className="h-4 w-4 text-primary" />
+                      Fontes de Dados
+                    </CardTitle>
+                    <CardDescription>
+                      Conecte suas contas banc√°rias e cart√µes via importa√ß√£o CSV.
+                    </CardDescription>
+                  </CardHeader>
+                  <CardContent className="space-y-4">
+                    <div className="flex items-center justify-between p-4 bg-primary/5 rounded-xl border border-primary/20">
+                      <div className="flex items-center gap-3">
+                        <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
+                          <CreditCard className="h-5 w-5 text-blue-600" />
+                        </div>
+                        <div>
+                          <p className="font-medium">Miles & More</p>
+                          <p className="text-sm text-muted-foreground">Importa√ß√£o CSV ativa</p>
+                        </div>
                       </div>
+                      <Badge className="bg-primary/10 text-primary border-0">Ativo</Badge>
                     </div>
-                    <Badge className="bg-primary/10 text-primary border-0">Ativo</Badge>
-                  </div>
-                  <div className="flex items-center justify-between p-4 bg-primary/5 rounded-xl border border-primary/20">
-                    <div className="flex items-center gap-3">
-                      <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
-                        <CreditCard className="h-5 w-5 text-blue-600" />
-                      </div>
-                      <div>
-                        <p className="font-medium">American Express</p>
-                        <p className="text-sm text-muted-foreground">Multi-cartoes suportado</p>
+                    <div className="flex items-center justify-between p-4 bg-primary/5 rounded-xl border border-primary/20">
+                      <div className="flex items-center gap-3">
+                        <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
+                          <CreditCard className="h-5 w-5 text-blue-600" />
+                        </div>
+                        <div>
+                          <p className="font-medium">American Express</p>
+                          <p className="text-sm text-muted-foreground">Multi-cart√µes suportado</p>
+                        </div>
                       </div>
+                      <Badge className="bg-primary/10 text-primary border-0">Ativo</Badge>
                     </div>
-                    <Badge className="bg-primary/10 text-primary border-0">Ativo</Badge>
-                  </div>
-                  <div className="flex items-center justify-between p-4 bg-primary/5 rounded-xl border border-primary/20">
-                    <div className="flex items-center gap-3">
-                      <div className="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center">
-                        <CreditCard className="h-5 w-5 text-red-600" />
-                      </div>
-                      <div>
-                        <p className="font-medium">Sparkasse</p>
-                        <p className="text-sm text-muted-foreground">Conta bancaria IBAN</p>
+                    <div className="flex items-center justify-between p-4 bg-primary/5 rounded-xl border border-primary/20">
+                      <div className="flex items-center gap-3">
+                        <div className="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center">
+                          <CreditCard className="h-5 w-5 text-red-600" />
+                        </div>
+                        <div>
+                          <p className="font-medium">Sparkasse</p>
+                          <p className="text-sm text-muted-foreground">Conta banc√°ria IBAN</p>
+                        </div>
                       </div>
+                      <Badge className="bg-primary/10 text-primary border-0">Ativo</Badge>
                     </div>
-                    <Badge className="bg-primary/10 text-primary border-0">Ativo</Badge>
-                  </div>
-                  <div className="p-4 bg-muted/20 rounded-xl border-2 border-dashed">
-                    <p className="text-sm text-muted-foreground">
-                      <strong>Proximas integracoes:</strong> Nubank, Revolut, N26, Wise
-                    </p>
-                  </div>
-                </CardContent>
-              </Card>
+                    <div className="p-4 bg-muted/20 rounded-xl border-2 border-dashed">
+                      <p className="text-sm text-muted-foreground">
+                        <strong>Pr√≥ximas integra√ß√µes:</strong> Nubank, Revolut, N26, Wise
+                      </p>
+                    </div>
+                  </CardContent>
+                </Card>
+
+                <Card className="bg-white border-0 shadow-sm">
+                  <CardHeader>
+                    <CardTitle className="text-base flex items-center gap-2">
+                      <BookOpen className="h-4 w-4 text-primary" />
+                      Dicion√°rio e Merchants
+                    </CardTitle>
+                    <CardDescription>
+                      Gerencie aliases e padr√µes de comerciantes para padronizar descri√ß√µes.
+                    </CardDescription>
+                  </CardHeader>
+                  <CardContent className="flex flex-col md:flex-row gap-3">
+                    <Link href="/merchant-dictionary">
+                      <Button variant="outline" className="gap-2">
+                        <BookOpen className="h-4 w-4" />
+                        Dicion√°rio de Comerciantes
+                      </Button>
+                    </Link>
+                    <Link href="/merchant-metadata">
+                      <Button variant="outline" className="gap-2">
+                        <Sparkles className="h-4 w-4" />
+                        Padr√µes de Merchants
+                      </Button>
+                    </Link>
+                  </CardContent>
+                </Card>
+              </>
             )}
 
             {activeTab === "seguranca" && (
diff --git a/client/src/pages/transactions.tsx b/client/src/pages/transactions.tsx
index 0a29507..3075256 100644
--- a/client/src/pages/transactions.tsx
+++ b/client/src/pages/transactions.tsx
@@ -6,12 +6,12 @@ import { Badge } from "@/components/ui/badge";
 import { Search, Download, Loader2, Edit2, Filter, X, Calendar, TrendingUp, TrendingDown, ArrowUpDown, Eye, Lock, RefreshCw, RotateCcw, ArrowLeftRight } from "lucide-react";
 import { getAccountIcon, getStatusIcon, IconBadge, TRANSACTION_ICONS } from "@/lib/icons";
 import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
-import { transactionsApi, accountsApi } from "@/lib/api";
+import { transactionsApi, accountsApi, rulesApi, merchantMetadataApi } from "@/lib/api";
 import { useToast } from "@/hooks/use-toast";
 import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from "@/components/ui/dialog";
 import { Label } from "@/components/ui/label";
 import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
-import { useState, useMemo } from "react";
+import { useState, useMemo, useEffect } from "react";
 import { cn } from "@/lib/utils";
 import { format } from "date-fns";
 import { ptBR } from "date-fns/locale";
@@ -20,7 +20,10 @@ import { useMonth } from "@/lib/month-context";
 import { Checkbox } from "@/components/ui/checkbox";
 import { TransactionDetailModal } from "@/components/transaction-detail-modal";
 import { getMerchantIcon } from "@/lib/merchant-icons";
+import { resolveMerchantMetadata } from "@/lib/merchant-metadata";
 import { TransactionListSkeleton } from "@/components/skeletons/transaction-list-skeleton";
+import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
+import { Link } from "wouter";
 
 const CATEGORY_COLORS: Record<string, string> = {
   "Mercado": "#22c55e",
@@ -54,6 +57,7 @@ export default function TransactionsPage() {
   const [categoryFilter, setCategoryFilter] = useState("all");
   const [typeFilter, setTypeFilter] = useState("all");
   const [showFilters, setShowFilters] = useState(false);
+  const [page, setPage] = useState(1);
   const [editingTransaction, setEditingTransaction] = useState<any>(null);
   const [viewingTransaction, setViewingTransaction] = useState<any>(null);
   const [formData, setFormData] = useState<TransactionForm | null>(null);
@@ -68,6 +72,16 @@ export default function TransactionsPage() {
     queryFn: accountsApi.list,
   });
 
+  const { data: rules = [] } = useQuery({
+    queryKey: ["rules"],
+    queryFn: rulesApi.list,
+  });
+
+  const { data: merchantMetadata = [] } = useQuery({
+    queryKey: ["merchant-metadata"],
+    queryFn: merchantMetadataApi.list,
+  });
+
   const accountsById = useMemo(() => {
     return accounts.reduce((map: any, account: any) => {
       map[account.id] = account;
@@ -75,6 +89,13 @@ export default function TransactionsPage() {
     }, {});
   }, [accounts]);
 
+  const rulesById = useMemo(() => {
+    return rules.reduce((map: any, rule: any) => {
+      map[rule.id] = rule;
+      return map;
+    }, {});
+  }, [rules]);
+
   const updateMutation = useMutation({
     mutationFn: ({ id, data }: { id: string; data: any }) => transactionsApi.update(id, data),
     onSuccess: () => {
@@ -157,6 +178,18 @@ export default function TransactionsPage() {
     });
   }, [transactions, search, accountFilter, categoryFilter, typeFilter]);
 
+  const pageSize = 50;
+  const totalPages = Math.max(1, Math.ceil(filteredTransactions.length / pageSize));
+
+  useEffect(() => {
+    setPage(1);
+  }, [search, accountFilter, categoryFilter, typeFilter, month]);
+
+  const pagedTransactions = useMemo(() => {
+    const start = (page - 1) * pageSize;
+    return filteredTransactions.slice(start, start + pageSize);
+  }, [filteredTransactions, page]);
+
   const stats = useMemo(() => {
     const totalIncome = filteredTransactions
       .filter((t: any) => t.type === "Receita")
@@ -355,9 +388,11 @@ export default function TransactionsPage() {
                     </tr>
                   </thead>
                   <tbody className="divide-y divide-border/50">
-                    {filteredTransactions.map((t: any) => {
+                    {pagedTransactions.map((t: any) => {
                       const categoryColor = CATEGORY_COLORS[t.category1] || "#6b7280";
-                      const merchantInfo = getMerchantIcon(t.descRaw);
+                      const metadataOverride = resolveMerchantMetadata(merchantMetadata, t.descRaw);
+                      const merchantInfo = metadataOverride || getMerchantIcon(t.descRaw);
+                      const rule = t.ruleIdApplied ? rulesById[t.ruleIdApplied] : null;
                       return (
                         <tr
                           key={t.id}
@@ -383,7 +418,9 @@ export default function TransactionsPage() {
                               <div className="flex-1 min-w-0">
                                 <div className="flex items-center gap-1.5">
                                   <p className="font-medium truncate">
-                                    {t.merchantAlias || t.descRaw?.split(" -- ")[0]?.replace(/\s+\d{4,}/g, '')}
+                                    {metadataOverride?.friendlyName ||
+                                      t.merchantAlias ||
+                                      t.descRaw?.split(" -- ")[0]?.replace(/\s+\d{4,}/g, '')}
                                   </p>
                                   {/* Icon badges for transaction attributes */}
                                   <div className="flex items-center gap-1 flex-shrink-0">
@@ -446,6 +483,30 @@ export default function TransactionsPage() {
                                 style={{ backgroundColor: categoryColor }}
                               />
                               <span className="text-sm">{t.category1}</span>
+                              <Popover>
+                                <PopoverTrigger asChild>
+                                  <Button
+                                    size="sm"
+                                    variant="ghost"
+                                    className="h-7 px-2 text-[10px]"
+                                    onClick={(e) => e.stopPropagation()}
+                                  >
+                                    Por que?
+                                  </Button>
+                                </PopoverTrigger>
+                                <PopoverContent className="w-64 text-xs">
+                                  <p className="font-semibold mb-1">Motivo da categoria</p>
+                                  <p className="text-muted-foreground">
+                                    {rule ? `Regra: ${rule.name}` : "Sem regra aplicada"}
+                                  </p>
+                                  {t.suggestedKeyword && (
+                                    <p className="text-muted-foreground">Keyword: {t.suggestedKeyword}</p>
+                                  )}
+                                  {t.confidence !== undefined && (
+                                  <p className="text-muted-foreground">Confian√ßa: {t.confidence}%</p>
+                                  )}
+                                </PopoverContent>
+                              </Popover>
                             </div>
                           </td>
                           <td className="px-5 py-4">
@@ -474,6 +535,7 @@ export default function TransactionsPage() {
                                   e.stopPropagation();
                                   setViewingTransaction(t);
                                 }}
+                                aria-label="Ver detalhes da transa√ß√£o"
                                 title="Ver detalhes"
                               >
                                 <Eye className="h-4 w-4" />
@@ -485,6 +547,7 @@ export default function TransactionsPage() {
                                   e.stopPropagation();
                                   openEditDialog(t);
                                 }}
+                                aria-label="Editar transa√ß√£o"
                                 title="Editar"
                               >
                                 <Edit2 className="h-4 w-4" />
@@ -498,6 +561,50 @@ export default function TransactionsPage() {
                 </table>
               </div>
             </CardContent>
+            {totalPages > 1 && (
+              <div className="flex items-center justify-between px-5 py-3 border-t text-sm text-muted-foreground">
+                <span>P√°gina {page} de {totalPages}</span>
+                <div className="flex items-center gap-2">
+                  <Button
+                    size="sm"
+                    variant="outline"
+                    disabled={page === 1}
+                    onClick={() => setPage((prev) => Math.max(1, prev - 1))}
+                  >
+                    Anterior
+                  </Button>
+                  <Button
+                    size="sm"
+                    variant="outline"
+                    disabled={page === totalPages}
+                    onClick={() => setPage((prev) => Math.min(totalPages, prev + 1))}
+                  >
+                    Pr√≥xima
+                  </Button>
+                </div>
+              </div>
+            )}
+          </Card>
+        )}
+
+        {!isLoading && (
+          <Card className="bg-gradient-to-r from-slate-50 to-primary/5 border-primary/10 shadow-sm">
+            <CardContent className="p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+              <div>
+                <h3 className="font-semibold text-foreground">Pr√≥ximo passo</h3>
+                <p className="text-sm text-muted-foreground mt-1">
+                  Exporte este m√™s ou revise transa√ß√µes pendentes na fila.
+                </p>
+              </div>
+              <div className="flex gap-2">
+                <Button variant="outline" onClick={handleExportCSV}>
+                  Exportar CSV
+                </Button>
+                <Link href="/confirm">
+                  <Button className="bg-primary hover:bg-primary/90">Ir para confirma√ß√£o</Button>
+                </Link>
+              </div>
+            </CardContent>
           </Card>
         )}
 
diff --git a/client/src/pages/uploads.tsx b/client/src/pages/uploads.tsx
index 174006a..cc322b6 100644
--- a/client/src/pages/uploads.tsx
+++ b/client/src/pages/uploads.tsx
@@ -1,16 +1,17 @@
 import AppLayout from "@/components/layout/app-layout";
 import { Button } from "@/components/ui/button";
 import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
+import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
 import { UploadCloud, FileSpreadsheet, CheckCircle2, XCircle, AlertCircle, Loader2, MoreVertical, Trash2, Filter, Clock, FileUp, Sparkles, RefreshCw, ChevronRight, Calendar, TrendingUp } from "lucide-react";
 import { cn } from "@/lib/utils";
 import { format } from "date-fns";
 import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
 import { uploadsApi } from "@/lib/api";
-import { useRef, useState } from "react";
+import { useEffect, useRef, useState } from "react";
 import { useToast } from "@/hooks/use-toast";
+import { Link } from "wouter";
 import { Badge } from "@/components/ui/badge";
 import { Progress } from "@/components/ui/progress";
-import { Link } from "wouter";
 import { BankBadge } from "@/components/bank-badge";
 import { detectBankProvider } from "@/lib/bank-logos";
 import { UploadHistorySkeleton } from "@/components/skeletons/upload-history-skeleton";
@@ -21,6 +22,11 @@ export default function UploadsPage() {
   const fileInputRef = useRef<HTMLInputElement>(null);
   const [isDragging, setIsDragging] = useState(false);
   const [uploadProgress, setUploadProgress] = useState(0);
+  const [errorDialogOpen, setErrorDialogOpen] = useState(false);
+  const [selectedUpload, setSelectedUpload] = useState<any>(null);
+  const [uploadErrors, setUploadErrors] = useState<any[]>([]);
+  const [errorsLoading, setErrorsLoading] = useState(false);
+  const [errorsByUpload, setErrorsByUpload] = useState<Record<string, any[]>>({});
 
   const { data: uploads = [], isLoading } = useQuery({
     queryKey: ["uploads"],
@@ -56,13 +62,13 @@ export default function UploadsPage() {
       
       if (result.rowsImported > 0) {
         toast({
-          title: "Importacao concluida",
-          description: `${result.rowsImported} transacoes importadas${result.duplicates > 0 ? `, ${result.duplicates} duplicatas ignoradas` : ""}`
+        title: "Importa√ß√£o conclu√≠da",
+          description: `${result.rowsImported} transa√ß√µes importadas${result.duplicates > 0 ? `, ${result.duplicates} duplicatas ignoradas` : ""}`
         });
       } else if (result.duplicates > 0) {
         toast({
           title: "Arquivo ja importado",
-          description: `Todas as ${result.duplicates} transacoes ja existem no sistema`,
+          description: `Todas as ${result.duplicates} transa√ß√µes j√° existem no sistema`,
           variant: "destructive"
         });
       }
@@ -70,7 +76,7 @@ export default function UploadsPage() {
     onError: (error: any) => {
       setUploadProgress(0);
       toast({
-        title: "Erro na importacao",
+        title: "Erro na importa√ß√£o",
         description: error.message || "Falha ao processar o arquivo",
         variant: "destructive"
       });
@@ -96,6 +102,65 @@ export default function UploadsPage() {
     if (file) handleFileSelect(file);
   };
 
+  const openErrors = async (upload: any) => {
+    setSelectedUpload(upload);
+    setErrorDialogOpen(true);
+    setErrorsLoading(true);
+    try {
+      const result = await uploadsApi.getErrors(upload.id);
+      setUploadErrors(result.errors || []);
+    } catch (error: any) {
+      toast({
+        title: "Erro ao carregar erros",
+        description: error.message || "Nao foi possivel carregar os erros deste upload",
+        variant: "destructive"
+      });
+      setUploadErrors([]);
+    } finally {
+      setErrorsLoading(false);
+    }
+  };
+
+  useEffect(() => {
+    const errorUploads = uploads.filter((upload: any) => (
+      (upload.status === "error" || upload.errorMessage) &&
+      !errorsByUpload[upload.id]
+    ));
+
+    if (errorUploads.length === 0) return;
+
+    let cancelled = false;
+
+    const loadErrorSummaries = async () => {
+      const entries = await Promise.all(
+        errorUploads.map(async (upload: any) => {
+          try {
+            const result = await uploadsApi.getErrors(upload.id);
+            return [upload.id, (result.errors || []).slice(0, 2)];
+          } catch {
+            return [upload.id, []];
+          }
+        })
+      );
+
+      if (cancelled) return;
+
+      setErrorsByUpload((prev) => {
+        const next = { ...prev };
+        entries.forEach(([id, errors]) => {
+          next[id as string] = errors as any[];
+        });
+        return next;
+      });
+    };
+
+    loadErrorSummaries();
+
+    return () => {
+      cancelled = true;
+    };
+  }, [uploads, errorsByUpload]);
+
   const totalImported = uploads.reduce((sum: number, u: any) => sum + (u.rowsImported || 0), 0);
   const successfulUploads = uploads.filter((u: any) => u.status === 'ready').length;
 
@@ -104,9 +169,9 @@ export default function UploadsPage() {
       <div className="space-y-6">
         <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
           <div>
-            <h1 className="text-2xl font-bold">Centro de Importacao</h1>
+            <h1 className="text-2xl font-bold">Centro de Importa√ß√£o</h1>
             <p className="text-muted-foreground">
-              Importe seus extratos CSV para categorizar transacoes automaticamente.
+              Importe seus extratos CSV para categorizar transa√ß√µes automaticamente.
             </p>
             <div className="flex flex-wrap gap-2 mt-2">
               <BankBadge provider="miles_and_more" size="sm" variant="compact" />
@@ -123,7 +188,7 @@ export default function UploadsPage() {
                 <div>
                   <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">Total Importado</p>
                   <p className="text-3xl font-bold mt-1">{totalImported}</p>
-                  <p className="text-xs text-muted-foreground mt-1">transacoes</p>
+                  <p className="text-xs text-muted-foreground mt-1">transa√ß√µes</p>
                 </div>
                 <div className="w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center">
                   <TrendingUp className="h-6 w-6 text-primary" />
@@ -151,7 +216,7 @@ export default function UploadsPage() {
             <CardContent className="p-5">
               <div className="flex items-center justify-between">
                 <div>
-                  <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">Proximo Passo</p>
+                  <p className="text-xs font-medium uppercase tracking-wide text-muted-foreground">Pr√≥ximo passo</p>
                   <p className="text-lg font-semibold mt-1">Revisar</p>
                   <Link href="/confirm" className="text-xs text-primary hover:underline flex items-center gap-1 mt-1">
                     Ver fila <ChevronRight className="h-3 w-3" />
@@ -199,7 +264,7 @@ export default function UploadsPage() {
                 <h3 className="font-semibold text-lg mb-2">Processando arquivo...</h3>
                 <Progress value={uploadProgress} className="h-2 mb-2" />
                 <p className="text-sm text-muted-foreground">
-                  Validando e categorizando transacoes
+                  Validando e categorizando transa√ß√µes
                 </p>
               </div>
             ) : (
@@ -235,7 +300,7 @@ export default function UploadsPage() {
           <div className="flex items-center justify-between">
             <div className="flex items-center gap-3">
               <Clock className="h-5 w-5 text-muted-foreground" />
-              <h2 className="text-lg font-semibold">Historico de Importacoes</h2>
+              <h2 className="text-lg font-semibold">Hist√≥rico de Importa√ß√µes</h2>
             </div>
           </div>
 
@@ -249,7 +314,7 @@ export default function UploadsPage() {
                 </div>
                 <h3 className="font-semibold text-lg mb-2">Nenhum arquivo importado</h3>
                 <p className="text-muted-foreground text-sm max-w-sm mx-auto">
-                  Arraste um arquivo CSV acima para comecar a organizar suas financas.
+                  Arraste um arquivo CSV acima para come√ßar a organizar suas finan√ßas.
                 </p>
               </CardContent>
             </Card>
@@ -262,6 +327,9 @@ export default function UploadsPage() {
                   data-testid={`card-upload-${upload.id}`}
                 >
                   <CardContent className="p-4">
+                    {(() => {
+                      const provider = detectBankProvider(upload.filename);
+                      return (
                     <div className="flex items-center gap-4">
                       <BankBadge provider={upload.filename} size="md" variant="icon" className="flex-shrink-0" />
 
@@ -269,6 +337,9 @@ export default function UploadsPage() {
                         <div className="flex items-center gap-2 mb-1">
                           <p className="font-semibold truncate">{upload.filename}</p>
                           <BankBadge provider={upload.filename} size="sm" variant="compact" />
+                          <Badge variant="outline" className="text-[10px] px-2 py-0.5">
+                            Formato: {provider.displayName}
+                          </Badge>
                           {upload.status === 'ready' && (
                             <Badge variant="secondary" className="bg-primary/10 text-primary text-xs">
                               Processado
@@ -289,17 +360,40 @@ export default function UploadsPage() {
                             <span>Ref: {upload.monthAffected}</span>
                           )}
                         </div>
+                        {errorsByUpload[upload.id]?.length > 0 && (
+                          <div className="mt-2 space-y-1 text-xs text-rose-600">
+                            {errorsByUpload[upload.id].map((err) => (
+                              <div key={err.id} className="truncate">
+                                Linha {err.rowNumber}: {err.errorMessage}
+                              </div>
+                            ))}
+                          </div>
+                        )}
+                        {(upload.status === "error" || upload.errorMessage) && (
+                          <button
+                            type="button"
+                            className="text-xs text-rose-600 hover:underline mt-1"
+                            onClick={(e) => {
+                              e.stopPropagation();
+                              openErrors(upload);
+                            }}
+                          >
+                            Ver erros
+                          </button>
+                        )}
                       </div>
                       
                       <div className="text-right">
                         <p className="text-2xl font-bold">{upload.rowsImported}</p>
-                        <p className="text-xs text-muted-foreground">transacoes</p>
+                        <p className="text-xs text-muted-foreground">transa√ß√µes</p>
                       </div>
                       
-                      <Button variant="ghost" size="icon" className="h-9 w-9 flex-shrink-0">
+                      <Button variant="ghost" size="icon" className="h-9 w-9 flex-shrink-0" aria-label="A√ß√µes do upload">
                         <MoreVertical className="h-4 w-4" />
                       </Button>
                     </div>
+                      );
+                    })()}
                   </CardContent>
                 </Card>
               ))}
@@ -307,6 +401,57 @@ export default function UploadsPage() {
           )}
         </div>
       </div>
+      {uploads.length > 0 && (
+        <Card className="bg-gradient-to-r from-primary/5 to-emerald-50 border-primary/20 shadow-sm">
+          <CardContent className="p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
+            <div>
+              <h3 className="font-semibold text-foreground">Pr√≥ximo passo</h3>
+              <p className="text-sm text-muted-foreground mt-1">
+                Revise a fila de confirma√ß√£o ou confira todas as transa√ß√µes importadas.
+              </p>
+            </div>
+            <div className="flex gap-2">
+              <Link href="/confirm">
+                <Button variant="outline">Revisar fila</Button>
+              </Link>
+              <Link href="/transactions">
+                <Button className="bg-primary hover:bg-primary/90">Ver transa√ß√µes</Button>
+              </Link>
+            </div>
+          </CardContent>
+        </Card>
+      )}
+      <Dialog open={errorDialogOpen} onOpenChange={setErrorDialogOpen}>
+        <DialogContent className="max-w-2xl">
+          <DialogHeader>
+            <DialogTitle>Erros de Importa√ß√£o</DialogTitle>
+          </DialogHeader>
+          {errorsLoading ? (
+            <div className="py-6 text-sm text-muted-foreground">Carregando erros...</div>
+          ) : uploadErrors.length === 0 ? (
+            <div className="py-6 text-sm text-muted-foreground">
+              Nenhum erro encontrado para este upload.
+            </div>
+          ) : (
+            <div className="space-y-3 max-h-[400px] overflow-y-auto">
+              {uploadErrors.map((err) => (
+                <div key={err.id} className="border rounded-lg p-3">
+                  <div className="flex items-center justify-between mb-1">
+                    <span className="text-xs font-semibold text-muted-foreground">Linha {err.rowNumber}</span>
+                    <span className="text-xs text-rose-600">Erro</span>
+                  </div>
+                  <p className="text-sm">{err.errorMessage}</p>
+                  {err.rawData && (
+                    <p className="text-xs text-muted-foreground mt-2 break-all">
+                      {err.rawData}
+                    </p>
+                  )}
+                </div>
+              ))}
+            </div>
+          )}
+        </DialogContent>
+      </Dialog>
     </AppLayout>
   );
 }
diff --git a/docs/_codex/CODEX_ACTIVITY_LOG.md b/docs/_codex/CODEX_ACTIVITY_LOG.md
index 20e606b..2ed5d0a 100644
--- a/docs/_codex/CODEX_ACTIVITY_LOG.md
+++ b/docs/_codex/CODEX_ACTIVITY_LOG.md
@@ -242,3 +242,59 @@
   - Fixed TypeScript AbortError typing in batch utils.
 - Observations & risks:
   - Dev server cannot start without DATABASE_URL; endpoint smoke test skipped.
+
+## 2025-12-29 21:02:58 +0100
+- Branch: main
+- Commands:
+  - git branch --show-current
+  - ls
+  - cat CLAUDE.md
+  - cat docs/ARCHITECTURE_AND_AI_LOGIC.md
+  - cat docs/IMPLEMENTATION_LOG.md
+  - ls docs/_codex
+  - cat docs/_codex/FEATURE_IMPLEMENTATION_PLAN.md
+  - cat docs/_codex/PRD_FROM_USER_FEEDBACK.md
+  - cat docs/_codex/USER_FEEDBACK_VERBATIM.md
+  - cat docs/_codex/RESOLVED_DECISIONS.md
+  - ls docs/_codex | rg NEXT_10_WORKPACKAGES
+  - cat package.json
+  - rg "process.env" -g"*.ts" -g"*.tsx"
+  - rg "VITE_" -g"*.ts" -g"*.tsx"
+  - rg "app\.(get|post|put|patch|delete)\(" server/routes.ts
+  - rg "/api/ai" server/routes.ts
+  - rg "fetch\(" client/src | rg "/api"
+  - node -e "env presence check"
+  - npm run check
+  - npm run build
+  - rg "pgTable\(" -n shared/schema.ts
+  - cat client/src/lib/api.ts
+  - sed -n 1,240p client/src/pages/dashboard.tsx
+  - sed -n 1,240p client/src/pages/confirm.tsx
+  - sed -n 1,220p client/src/pages/uploads.tsx
+  - sed -n 1,220p client/src/pages/settings.tsx
+  - sed -n 1,200p client/src/pages/ai-keywords.tsx
+  - sed -n 1,200p client/src/pages/login.tsx
+  - sed -n 1,200p client/src/pages/budgets.tsx
+  - sed -n 1,200p client/src/pages/goals.tsx
+  - sed -n 1,200p client/src/pages/rituals.tsx
+  - sed -n 1,220p client/src/components/layout/sidebar.tsx
+  - sed -n 1,220p server/index.ts
+  - sed -n 1,220p server/routes.ts
+  - cat server/db.ts
+  - cat vercel.json
+  - mkdir -p docs/_codex/reviews/2025-12-29
+- Output:
+  - Created review package in `docs/_codex/reviews/2025-12-29/`:
+    - EXECUTIVE_SUMMARY.md
+    - FEATURE_VERIFICATION_MATRIX.md
+    - UX_UI_REVIEW.md
+    - TECHNICAL_ASSESSMENT.md
+    - IMPROVEMENT_ROADMAP.md
+    - QA_RUNBOOK.md
+
+## 2025-12-29 (branch_feat)
+- Added calendar projected/realized filters, upload error previews, and goals onboarding CTA.
+- Applied merchant metadata overrides in dashboard/transactions/calendar/detail.
+- Added rules N1/N2/N3 guidance + pending impact badge.
+- Added balance updated timestamp and copy/accent normalization + aria labels.
+- Updated UX review docs and roadmap statuses.
diff --git a/docs/_codex/PHASE_3_4_IMPLEMENTATION_SPEC.md b/docs/_codex/PHASE_3_4_IMPLEMENTATION_SPEC.md
new file mode 100644
index 0000000..f5dee84
--- /dev/null
+++ b/docs/_codex/PHASE_3_4_IMPLEMENTATION_SPEC.md
@@ -0,0 +1,1251 @@
+# Merchant Dictionary - Phase 3 & 4 Implementation Specification
+
+## Document Overview
+
+This document provides detailed implementation specifications for Phase 3 (Icon Management) and Phase 4 (Background Sync Optimization) of the Merchant Dictionary feature.
+
+**Status**: Design specification for future implementation
+**Prerequisites**: Phase 1 & 2 must be completed
+**Estimated Effort**: Phase 3 (10-12 hours) + Phase 4 (4-6 hours) = 14-18 hours total
+
+---
+
+## Phase 3: Icon Management System
+
+### 3.1 Overview
+
+Implement automated merchant icon fetching and management to provide visual identity for merchants in transaction lists.
+
+**Goals**:
+- Automatically fetch merchant logos from external APIs
+- Cache icons locally or via CDN
+- Provide fallback mechanisms for missing icons
+- Allow manual icon URL override
+- Optimize for performance and cost
+
+**Database Schema**: Already exists (`merchant_icons` table)
+
+---
+
+### 3.2 Architecture Design
+
+#### 3.2.1 Icon Provider Strategy
+
+**Primary Provider: Clearbit Logo API**
+- URL Format: `https://logo.clearbit.com/{domain}`
+- Free tier: Unlimited requests
+- Returns PNG logo or 404 if not found
+- No API key required
+
+**Alternative Providers** (if Clearbit fails):
+1. **Google Favicon Service**: `https://www.google.com/s2/favicons?domain={domain}&sz=128`
+2. **DuckDuckGo Icon API**: `https://icons.duckduckgo.com/ip3/{domain}.ico`
+3. **Manual URL**: User-provided icon URL
+
+**Fallback Strategy**:
+```
+1. Try Clearbit Logo API
+2. If 404, try Google Favicon
+3. If still fails, use initials-based placeholder
+4. Allow manual override
+```
+
+#### 3.2.2 Domain Extraction Logic
+
+**Challenge**: Extract domain from merchant alias
+**Solution**: Pattern matching + known merchant database
+
+```typescript
+// server/icon-domain-mapper.ts
+
+interface DomainMapping {
+  alias: string;          // Normalized merchant name
+  domain: string;         // Website domain
+  confidence: number;     // 0-100
+  source: "automatic" | "manual" | "verified";
+}
+
+// Known merchant domains database
+const KNOWN_DOMAINS: Record<string, string> = {
+  "amazon": "amazon.de",
+  "rewe": "rewe.de",
+  "edeka": "edeka.de",
+  "lidl": "lidl.de",
+  "aldi": "aldi.de",
+  "dm": "dm.de",
+  "rossmann": "rossmann.de",
+  "spotify": "spotify.com",
+  "netflix": "netflix.com",
+  "paypal": "paypal.com",
+  // ... expand to 500+ common merchants
+};
+
+// Domain extraction strategies
+function extractDomain(aliasDesc: string): string | null {
+  // 1. Check known domains database (exact match)
+  const normalized = aliasDesc.toLowerCase().trim();
+  if (KNOWN_DOMAINS[normalized]) {
+    return KNOWN_DOMAINS[normalized];
+  }
+
+  // 2. Check partial match (fuzzy)
+  for (const [key, domain] of Object.entries(KNOWN_DOMAINS)) {
+    if (normalized.includes(key) || key.includes(normalized)) {
+      return domain;
+    }
+  }
+
+  // 3. Extract from alias if it looks like domain
+  if (normalized.match(/[a-z0-9-]+\.(com|de|net|org)/)) {
+    return normalized;
+  }
+
+  // 4. Try constructing domain (alias.de, alias.com)
+  // This is low confidence
+  return null;
+}
+```
+
+#### 3.2.3 Icon Storage Strategy
+
+**Option A: External URL Storage (Recommended for MVP)**
+- Store icon URL in `merchant_icons.iconSourceUrl`
+- Serve directly from provider (Clearbit/Google)
+- No storage costs
+- Depends on external service availability
+- Fast initial implementation
+
+**Option B: Local Storage with CDN**
+- Download icons to local filesystem
+- Store in `public/merchant-icons/{hash}.png`
+- Serve via CDN (Cloudflare, Vercel, etc.)
+- Higher reliability
+- Storage costs
+- Requires background job
+
+**Recommended**: Start with Option A, migrate to Option B if needed
+
+---
+
+### 3.3 Database Schema Usage
+
+**Table: `merchant_icons`** (already exists)
+
+```typescript
+{
+  id: string;                    // UUID
+  userId: string;                // FK to users
+  aliasDesc: string;             // Merchant alias (unique per user)
+  shouldFetchIcon: boolean;      // Enable/disable icon fetching
+  iconSourceUrl: string | null;  // URL to icon (Clearbit/Google/Manual)
+  iconLocalPath: string | null;  // Local path if downloaded
+  iconLastCheckedAt: Date | null;// Last fetch attempt
+  createdAt: Date;
+  updatedAt: Date;
+}
+```
+
+**Unique Constraint**: `(userId, aliasDesc)`
+
+---
+
+### 3.4 Backend Implementation
+
+#### 3.4.1 Icon Fetcher Service
+
+**File**: `server/icon-fetcher.ts`
+
+```typescript
+import fetch from 'node-fetch';
+import { logger } from './logger';
+
+interface IconFetchResult {
+  success: boolean;
+  iconUrl?: string;
+  provider?: "clearbit" | "google" | "duckduckgo" | "manual";
+  error?: string;
+}
+
+export class IconFetcher {
+  private static CLEARBIT_BASE = "https://logo.clearbit.com/";
+  private static GOOGLE_BASE = "https://www.google.com/s2/favicons?sz=128&domain=";
+
+  /**
+   * Fetch icon for merchant alias
+   */
+  async fetchIcon(aliasDesc: string, manualDomain?: string): Promise<IconFetchResult> {
+    try {
+      // 1. Extract domain from alias
+      const domain = manualDomain || this.extractDomain(aliasDesc);
+
+      if (!domain) {
+        return {
+          success: false,
+          error: "Could not determine domain for merchant"
+        };
+      }
+
+      // 2. Try Clearbit
+      const clearbitUrl = `${IconFetcher.CLEARBIT_BASE}${domain}`;
+      const clearbitValid = await this.validateIconUrl(clearbitUrl);
+
+      if (clearbitValid) {
+        return {
+          success: true,
+          iconUrl: clearbitUrl,
+          provider: "clearbit"
+        };
+      }
+
+      // 3. Try Google Favicon
+      const googleUrl = `${IconFetcher.GOOGLE_BASE}${domain}`;
+      const googleValid = await this.validateIconUrl(googleUrl);
+
+      if (googleValid) {
+        return {
+          success: true,
+          iconUrl: googleUrl,
+          provider: "google"
+        };
+      }
+
+      return {
+        success: false,
+        error: "No icon found from any provider"
+      };
+
+    } catch (error: any) {
+      logger.error("icon_fetch_error", {
+        aliasDesc,
+        error: error.message
+      });
+
+      return {
+        success: false,
+        error: error.message
+      };
+    }
+  }
+
+  /**
+   * Validate if icon URL returns valid image
+   */
+  private async validateIconUrl(url: string): Promise<boolean> {
+    try {
+      const response = await fetch(url, {
+        method: 'HEAD',
+        timeout: 5000
+      });
+
+      return response.ok && response.headers.get('content-type')?.startsWith('image/');
+    } catch {
+      return false;
+    }
+  }
+
+  /**
+   * Extract domain from merchant alias
+   */
+  private extractDomain(aliasDesc: string): string | null {
+    // Import known domains mapping
+    const { KNOWN_DOMAINS } = require('./icon-domain-mapper');
+
+    const normalized = aliasDesc.toLowerCase().trim();
+
+    // Exact match
+    if (KNOWN_DOMAINS[normalized]) {
+      return KNOWN_DOMAINS[normalized];
+    }
+
+    // Fuzzy match
+    for (const [key, domain] of Object.entries(KNOWN_DOMAINS)) {
+      if (normalized.includes(key)) {
+        return domain as string;
+      }
+    }
+
+    return null;
+  }
+
+  /**
+   * Batch fetch icons for multiple merchants
+   */
+  async batchFetchIcons(
+    merchants: Array<{ aliasDesc: string; domain?: string }>
+  ): Promise<Map<string, IconFetchResult>> {
+    const results = new Map<string, IconFetchResult>();
+
+    // Process in parallel with rate limiting
+    const chunks = this.chunk(merchants, 10); // 10 concurrent requests
+
+    for (const chunk of chunks) {
+      const promises = chunk.map(m =>
+        this.fetchIcon(m.aliasDesc, m.domain)
+          .then(result => ({ alias: m.aliasDesc, result }))
+      );
+
+      const chunkResults = await Promise.all(promises);
+
+      for (const { alias, result } of chunkResults) {
+        results.set(alias, result);
+      }
+
+      // Rate limiting: 100ms delay between chunks
+      await new Promise(resolve => setTimeout(resolve, 100));
+    }
+
+    return results;
+  }
+
+  private chunk<T>(array: T[], size: number): T[][] {
+    const chunks: T[][] = [];
+    for (let i = 0; i < array.length; i += size) {
+      chunks.push(array.slice(i, i + size));
+    }
+    return chunks;
+  }
+}
+
+export const iconFetcher = new IconFetcher();
+```
+
+#### 3.4.2 Storage Methods
+
+**Add to `server/storage.ts`**:
+
+```typescript
+// Fetch or create icon record
+async getOrCreateMerchantIcon(
+  userId: string,
+  aliasDesc: string
+): Promise<MerchantIcon> {
+  const existing = await this.getMerchantIconByAlias(userId, aliasDesc);
+
+  if (existing) {
+    return existing;
+  }
+
+  return this.createMerchantIcon({
+    userId,
+    aliasDesc,
+    shouldFetchIcon: true
+  });
+}
+
+// Update icon URL after fetch
+async updateMerchantIconUrl(
+  id: string,
+  iconUrl: string,
+  provider: string
+): Promise<void> {
+  await db.update(merchantIcons)
+    .set({
+      iconSourceUrl: iconUrl,
+      iconLastCheckedAt: new Date(),
+      updatedAt: new Date()
+    })
+    .where(eq(merchantIcons.id, id));
+}
+
+// Get all merchants needing icon fetch
+async getMerchantsNeedingIcons(userId: string): Promise<MerchantIcon[]> {
+  return db.select().from(merchantIcons)
+    .where(and(
+      eq(merchantIcons.userId, userId),
+      eq(merchantIcons.shouldFetchIcon, true),
+      or(
+        isNull(merchantIcons.iconSourceUrl),
+        // Re-fetch if older than 30 days
+        lt(merchantIcons.iconLastCheckedAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000))
+      )
+    ));
+}
+```
+
+#### 3.4.3 API Endpoints
+
+**Add to `server/routes.ts`**:
+
+```typescript
+// Trigger icon fetch for specific merchant
+app.post("/api/merchant-icons/:aliasDesc/fetch", async (req: Request, res: Response) => {
+  try {
+    const user = await storage.getUserByUsername("demo");
+    if (!user) return res.status(401).json({ error: "Unauthorized" });
+
+    const { aliasDesc } = req.params;
+    const { manualDomain } = req.body;
+
+    // Get or create icon record
+    const iconRecord = await storage.getOrCreateMerchantIcon(user.id, aliasDesc);
+
+    // Fetch icon
+    const result = await iconFetcher.fetchIcon(aliasDesc, manualDomain);
+
+    if (result.success && result.iconUrl) {
+      await storage.updateMerchantIconUrl(iconRecord.id, result.iconUrl, result.provider!);
+
+      res.json({
+        success: true,
+        iconUrl: result.iconUrl,
+        provider: result.provider
+      });
+    } else {
+      res.status(404).json({
+        success: false,
+        error: result.error
+      });
+    }
+
+  } catch (error: any) {
+    logger.error("icon_fetch_endpoint_error", { error: error.message });
+    res.status(500).json({ error: error.message });
+  }
+});
+
+// Batch fetch icons for all merchants
+app.post("/api/merchant-icons/batch-fetch", async (req: Request, res: Response) => {
+  try {
+    const user = await storage.getUserByUsername("demo");
+    if (!user) return res.status(401).json({ error: "Unauthorized" });
+
+    const merchantsNeedingIcons = await storage.getMerchantsNeedingIcons(user.id);
+
+    const merchants = merchantsNeedingIcons.map(m => ({
+      aliasDesc: m.aliasDesc
+    }));
+
+    const results = await iconFetcher.batchFetchIcons(merchants);
+
+    let successCount = 0;
+    let failCount = 0;
+
+    for (const [aliasDesc, result] of results.entries()) {
+      const iconRecord = merchantsNeedingIcons.find(m => m.aliasDesc === aliasDesc);
+
+      if (iconRecord && result.success && result.iconUrl) {
+        await storage.updateMerchantIconUrl(iconRecord.id, result.iconUrl, result.provider!);
+        successCount++;
+      } else {
+        failCount++;
+      }
+    }
+
+    res.json({
+      success: true,
+      total: merchants.length,
+      fetched: successCount,
+      failed: failCount
+    });
+
+  } catch (error: any) {
+    logger.error("batch_icon_fetch_error", { error: error.message });
+    res.status(500).json({ error: error.message });
+  }
+});
+
+// Update icon settings (enable/disable, manual URL)
+app.patch("/api/merchant-icons/:aliasDesc", async (req: Request, res: Response) => {
+  try {
+    const user = await storage.getUserByUsername("demo");
+    if (!user) return res.status(401).json({ error: "Unauthorized" });
+
+    const { aliasDesc } = req.params;
+    const updates = req.body;
+
+    const updated = await storage.updateMerchantIcon(aliasDesc, user.id, updates);
+
+    if (!updated) {
+      return res.status(404).json({ error: "Icon record not found" });
+    }
+
+    res.json(updated);
+
+  } catch (error: any) {
+    res.status(500).json({ error: error.message });
+  }
+});
+```
+
+---
+
+### 3.5 Frontend Implementation
+
+#### 3.5.1 Icon Display Component
+
+**File**: `client/src/components/merchant-icon.tsx`
+
+```typescript
+import { Building2 } from "lucide-react";
+import { useState } from "react";
+
+interface MerchantIconProps {
+  iconUrl?: string | null;
+  aliasDesc: string;
+  size?: "sm" | "md" | "lg";
+}
+
+export function MerchantIcon({ iconUrl, aliasDesc, size = "md" }: MerchantIconProps) {
+  const [imageError, setImageError] = useState(false);
+
+  const sizeClasses = {
+    sm: "w-5 h-5",
+    md: "w-8 h-8",
+    lg: "w-12 h-12"
+  };
+
+  const iconSize = {
+    sm: "w-3 h-3",
+    md: "w-4 h-4",
+    lg: "w-6 h-6"
+  };
+
+  // Show initials-based placeholder if no icon
+  if (!iconUrl || imageError) {
+    const initials = aliasDesc
+      .split(" ")
+      .slice(0, 2)
+      .map(w => w[0])
+      .join("")
+      .toUpperCase();
+
+    return (
+      <div
+        className={`${sizeClasses[size]} rounded-md bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-semibold text-xs`}
+        title={aliasDesc}
+      >
+        {initials || <Building2 className={iconSize[size]} />}
+      </div>
+    );
+  }
+
+  return (
+    <img
+      src={iconUrl}
+      alt={aliasDesc}
+      className={`${sizeClasses[size]} rounded-md object-contain bg-white border border-gray-200`}
+      onError={() => setImageError(true)}
+      title={aliasDesc}
+    />
+  );
+}
+```
+
+#### 3.5.2 Transaction List Integration
+
+**Update**: `client/src/pages/transactions.tsx`
+
+```typescript
+import { MerchantIcon } from "@/components/merchant-icon";
+
+// Inside transaction row rendering:
+<td className="px-5 py-4">
+  <div className="flex items-center gap-3">
+    {/* Merchant Icon */}
+    <MerchantIcon
+      iconUrl={t.merchantIconUrl}
+      aliasDesc={t.merchantAlias || t.descRaw}
+      size="sm"
+    />
+
+    {/* Account Badge */}
+    <AccountBadge account={accountsById[t.accountId]} size="sm" />
+  </div>
+</td>
+```
+
+#### 3.5.3 Icon Management UI
+
+**Update**: `client/src/pages/merchant-dictionary.tsx`
+
+Add icon management section:
+
+```typescript
+// Add to merchant dictionary page
+<div className="space-y-4">
+  <div className="flex items-center justify-between">
+    <h3 className="text-lg font-semibold">Gest√£o de √çcones</h3>
+    <Button
+      variant="outline"
+      onClick={handleBatchFetchIcons}
+      disabled={isFetchingIcons}
+    >
+      {isFetchingIcons ? (
+        <>
+          <Loader2 className="w-4 h-4 mr-2 animate-spin" />
+          Buscando...
+        </>
+      ) : (
+        <>
+          <Download className="w-4 h-4 mr-2" />
+          Buscar Todos os √çcones
+        </>
+      )}
+    </Button>
+  </div>
+
+  {/* Icon Preview Table */}
+  <div className="border rounded-lg">
+    <table className="w-full">
+      <thead className="bg-gray-50">
+        <tr>
+          <th className="px-4 py-3 text-left text-sm font-medium">√çcone</th>
+          <th className="px-4 py-3 text-left text-sm font-medium">Comerciante</th>
+          <th className="px-4 py-3 text-left text-sm font-medium">URL</th>
+          <th className="px-4 py-3 text-left text-sm font-medium">A√ß√µes</th>
+        </tr>
+      </thead>
+      <tbody>
+        {descriptions.map((d: any) => (
+          <tr key={d.id} className="border-t">
+            <td className="px-4 py-3">
+              <MerchantIcon
+                iconUrl={d.iconUrl}
+                aliasDesc={d.aliasDesc}
+                size="md"
+              />
+            </td>
+            <td className="px-4 py-3">{d.aliasDesc}</td>
+            <td className="px-4 py-3 text-xs text-gray-500 truncate max-w-xs">
+              {d.iconUrl || "Sem √≠cone"}
+            </td>
+            <td className="px-4 py-3">
+              <Button
+                size="sm"
+                variant="ghost"
+                onClick={() => handleFetchIcon(d.aliasDesc)}
+              >
+                Buscar
+              </Button>
+            </td>
+          </tr>
+        ))}
+      </tbody>
+    </table>
+  </div>
+</div>
+```
+
+#### 3.5.4 API Client Updates
+
+**Add to**: `client/src/lib/api.ts`
+
+```typescript
+export const merchantIconsApi = {
+  fetchIcon: (aliasDesc: string, manualDomain?: string) =>
+    api.post(`/api/merchant-icons/${aliasDesc}/fetch`, { manualDomain }),
+
+  batchFetch: () =>
+    api.post('/api/merchant-icons/batch-fetch'),
+
+  updateSettings: (aliasDesc: string, settings: any) =>
+    api.patch(`/api/merchant-icons/${aliasDesc}`, settings)
+};
+```
+
+---
+
+### 3.6 Implementation Checklist
+
+**Backend** (6-8 hours):
+- [ ] Create `server/icon-domain-mapper.ts` with known domains database
+- [ ] Create `server/icon-fetcher.ts` with Clearbit/Google integration
+- [ ] Add storage methods for icon management
+- [ ] Add 3 API endpoints (fetch, batch-fetch, update)
+- [ ] Add error handling and logging
+- [ ] Test icon fetching for 20+ merchants
+
+**Frontend** (4-6 hours):
+- [ ] Create `MerchantIcon` component with fallback
+- [ ] Integrate icon display in transaction lists
+- [ ] Add icon management section to merchant dictionary page
+- [ ] Add batch fetch button and progress indicator
+- [ ] Add manual domain override input
+- [ ] Test icon display across different screen sizes
+
+**Testing**:
+- [ ] Test Clearbit API with 50 merchants
+- [ ] Test Google Favicon fallback
+- [ ] Test placeholder rendering for unknown merchants
+- [ ] Test error handling for network failures
+- [ ] Performance test: 1000 merchants with icons
+
+---
+
+## Phase 4: Background Sync Optimization
+
+### 4.1 Overview
+
+Optimize merchant alias lookup performance through intelligent caching and background synchronization.
+
+**Current Performance Issue**:
+- `getTransactionsWithMerchantAlias()` does N+1 queries (1 query per transaction)
+- For 100 transactions: 100 individual merchant lookups
+- Total query time: ~500-1000ms for 100 transactions
+
+**Target Performance**:
+- Reduce to 2 queries: 1 for transactions, 1 batch for merchant aliases
+- Total query time: ~50-100ms for 100 transactions
+- **10x performance improvement**
+
+---
+
+### 4.2 Architecture Design
+
+#### 4.2.1 Caching Strategy
+
+**In-Memory Cache (Node.js)**
+- Store merchant aliases in memory (Map/LRU cache)
+- Invalidate on merchant description updates
+- TTL: 1 hour
+- Max size: 10,000 entries
+
+**Database Query Optimization**
+- Batch fetch merchant aliases in single query
+- Use SQL JOIN instead of N+1 queries
+- Add database indexes
+
+#### 4.2.2 Database Indexing
+
+**Add indexes to optimize lookups**:
+
+```sql
+-- Index on merchant_descriptions for fast lookup
+CREATE INDEX idx_merchant_desc_lookup
+ON merchant_descriptions(user_id, source, key_desc);
+
+-- Index on merchant_icons for fast retrieval
+CREATE INDEX idx_merchant_icons_alias
+ON merchant_icons(user_id, alias_desc);
+
+-- Composite index for transaction enrichment
+CREATE INDEX idx_transactions_enrichment
+ON transactions(user_id, payment_date DESC);
+```
+
+---
+
+### 4.3 Implementation
+
+#### 4.3.1 In-Memory Cache Service
+
+**File**: `server/merchant-cache.ts`
+
+```typescript
+import { LRUCache } from 'lru-cache';
+import { logger } from './logger';
+
+interface CacheEntry {
+  aliasDesc: string;
+  timestamp: number;
+}
+
+class MerchantAliasCache {
+  private cache: LRUCache<string, string>; // key -> aliasDesc
+  private userCaches: Map<string, LRUCache<string, string>>;
+
+  constructor() {
+    // Global cache for all users (max 10,000 entries)
+    this.cache = new LRUCache<string, string>({
+      max: 10000,
+      ttl: 1000 * 60 * 60, // 1 hour
+    });
+
+    this.userCaches = new Map();
+  }
+
+  /**
+   * Get cache key for merchant lookup
+   */
+  private getCacheKey(userId: string, source: string, keyDesc: string): string {
+    return `${userId}:${source}:${keyDesc}`;
+  }
+
+  /**
+   * Get merchant alias from cache
+   */
+  get(userId: string, source: string, keyDesc: string): string | undefined {
+    const key = this.getCacheKey(userId, source, keyDesc);
+    return this.cache.get(key);
+  }
+
+  /**
+   * Set merchant alias in cache
+   */
+  set(userId: string, source: string, keyDesc: string, aliasDesc: string): void {
+    const key = this.getCacheKey(userId, source, keyDesc);
+    this.cache.set(key, aliasDesc);
+  }
+
+  /**
+   * Batch set multiple aliases
+   */
+  setMany(entries: Array<{
+    userId: string;
+    source: string;
+    keyDesc: string;
+    aliasDesc: string;
+  }>): void {
+    for (const entry of entries) {
+      this.set(entry.userId, entry.source, entry.keyDesc, entry.aliasDesc);
+    }
+  }
+
+  /**
+   * Invalidate cache for specific merchant
+   */
+  invalidate(userId: string, source: string, keyDesc: string): void {
+    const key = this.getCacheKey(userId, source, keyDesc);
+    this.cache.delete(key);
+  }
+
+  /**
+   * Invalidate all cache for user
+   */
+  invalidateUser(userId: string): void {
+    // Clear all entries starting with userId
+    for (const key of this.cache.keys()) {
+      if (key.startsWith(`${userId}:`)) {
+        this.cache.delete(key);
+      }
+    }
+  }
+
+  /**
+   * Get cache statistics
+   */
+  getStats(): {
+    size: number;
+    maxSize: number;
+    hitRate: number;
+  } {
+    return {
+      size: this.cache.size,
+      maxSize: this.cache.max,
+      hitRate: this.cache.calculatedSize / (this.cache.calculatedSize + this.cache.size)
+    };
+  }
+}
+
+export const merchantCache = new MerchantAliasCache();
+```
+
+#### 4.3.2 Optimized Transaction Enrichment
+
+**Update**: `server/storage.ts`
+
+Replace N+1 query approach with batch query:
+
+```typescript
+async getTransactionsWithMerchantAlias(
+  userId: string,
+  month?: string
+): Promise<(Transaction & { merchantAlias?: string })[]> {
+  const { generateKeyDesc, detectTransactionSource } = await import("./key-desc-generator");
+  const { merchantCache } = await import("./merchant-cache");
+
+  // 1. Get all transactions (single query)
+  const txs = await this.getTransactions(userId, month);
+
+  if (txs.length === 0) {
+    return [];
+  }
+
+  // 2. Build list of unique (source, keyDesc) pairs
+  const merchantLookups = new Map<string, { source: string; keyDesc: string }>();
+  const txMerchantKeys = new Map<string, string>(); // txId -> lookupKey
+
+  for (const tx of txs) {
+    const source = detectTransactionSource(tx.accountSource);
+    const keyDesc = generateKeyDesc(tx.descRaw, tx.accountSource);
+    const lookupKey = `${source}:${keyDesc}`;
+
+    merchantLookups.set(lookupKey, { source, keyDesc });
+    txMerchantKeys.set(tx.id, lookupKey);
+  }
+
+  // 3. Check cache first
+  const aliasMap = new Map<string, string>();
+  const uncachedLookups: typeof merchantLookups = new Map();
+
+  for (const [lookupKey, { source, keyDesc }] of merchantLookups.entries()) {
+    const cached = merchantCache.get(userId, source, keyDesc);
+
+    if (cached) {
+      aliasMap.set(lookupKey, cached);
+    } else {
+      uncachedLookups.set(lookupKey, { source, keyDesc });
+    }
+  }
+
+  logger.info("merchant_cache_stats", {
+    total: merchantLookups.size,
+    cached: aliasMap.size,
+    uncached: uncachedLookups.size,
+    hitRate: (aliasMap.size / merchantLookups.size * 100).toFixed(1) + "%"
+  });
+
+  // 4. Batch fetch uncached aliases (single query with IN clause)
+  if (uncachedLookups.size > 0) {
+    const conditions = Array.from(uncachedLookups.values()).map(
+      ({ source, keyDesc }) => and(
+        eq(merchantDescriptions.userId, userId),
+        eq(merchantDescriptions.source, source),
+        eq(merchantDescriptions.keyDesc, keyDesc)
+      )
+    );
+
+    const results = await db.select()
+      .from(merchantDescriptions)
+      .where(or(...conditions));
+
+    // Add to cache and map
+    for (const result of results) {
+      const lookupKey = `${result.source}:${result.keyDesc}`;
+      aliasMap.set(lookupKey, result.aliasDesc);
+      merchantCache.set(userId, result.source, result.keyDesc, result.aliasDesc);
+    }
+  }
+
+  // 5. Enrich transactions with aliases
+  return txs.map(tx => ({
+    ...tx,
+    merchantAlias: aliasMap.get(txMerchantKeys.get(tx.id)!)
+  }));
+}
+```
+
+**Performance Comparison**:
+
+Before (N+1):
+```
+- Query 1: SELECT * FROM transactions (50ms)
+- Query 2-101: SELECT * FROM merchant_descriptions (100 x 5ms = 500ms)
+- Total: 550ms
+```
+
+After (Batch + Cache):
+```
+- Query 1: SELECT * FROM transactions (50ms)
+- Query 2: SELECT * FROM merchant_descriptions WHERE ... (single IN query, 30ms)
+- Total: 80ms (first request)
+- Total: 50ms (subsequent requests with 100% cache hit)
+```
+
+**Result: 7-10x faster** ‚ö°
+
+#### 4.3.3 Cache Invalidation
+
+**Update**: `server/routes.ts`
+
+Add cache invalidation on merchant updates:
+
+```typescript
+import { merchantCache } from './merchant-cache';
+
+// Update merchant description endpoint
+app.patch("/api/merchant-descriptions/:id", async (req: Request, res: Response) => {
+  try {
+    const user = await storage.getUserByUsername("demo");
+    if (!user) return res.status(401).json({ error: "Unauthorized" });
+
+    const { aliasDesc } = req.body;
+    const updated = await storage.updateMerchantDescription(req.params.id, { aliasDesc });
+
+    if (updated) {
+      // Invalidate cache
+      merchantCache.invalidate(user.id, updated.source, updated.keyDesc);
+
+      queryClient.invalidateQueries({ queryKey: ["merchant-descriptions"] });
+      res.json(updated);
+    } else {
+      res.status(404).json({ error: "Not found" });
+    }
+  } catch (error: any) {
+    res.status(500).json({ error: error.message });
+  }
+});
+
+// Delete merchant description endpoint
+app.delete("/api/merchant-descriptions/:id", async (req: Request, res: Response) => {
+  try {
+    const user = await storage.getUserByUsername("demo");
+    if (!user) return res.status(401).json({ error: "Unauthorized" });
+
+    const merchant = await storage.getMerchantDescriptionById(req.params.id, user.id);
+
+    if (merchant) {
+      // Invalidate cache before delete
+      merchantCache.invalidate(user.id, merchant.source, merchant.keyDesc);
+
+      await storage.deleteMerchantDescription(req.params.id);
+      res.json({ success: true });
+    } else {
+      res.status(404).json({ error: "Not found" });
+    }
+  } catch (error: any) {
+    res.status(500).json({ error: error.message });
+  }
+});
+```
+
+#### 4.3.4 Background Sync Job (Optional)
+
+For very large datasets (10,000+ transactions), implement background pre-warming:
+
+**File**: `server/background-sync.ts`
+
+```typescript
+import { storage } from './storage';
+import { merchantCache } from './merchant-cache';
+import { logger } from './logger';
+
+export class BackgroundSyncService {
+  private syncInterval: NodeJS.Timeout | null = null;
+
+  /**
+   * Start background sync (runs every 5 minutes)
+   */
+  start(): void {
+    if (this.syncInterval) {
+      return; // Already running
+    }
+
+    logger.info("background_sync_started");
+
+    this.syncInterval = setInterval(async () => {
+      await this.syncMerchantCache();
+    }, 5 * 60 * 1000); // 5 minutes
+
+    // Run immediately on start
+    this.syncMerchantCache();
+  }
+
+  /**
+   * Stop background sync
+   */
+  stop(): void {
+    if (this.syncInterval) {
+      clearInterval(this.syncInterval);
+      this.syncInterval = null;
+      logger.info("background_sync_stopped");
+    }
+  }
+
+  /**
+   * Sync merchant descriptions to cache
+   */
+  private async syncMerchantCache(): Promise<void> {
+    try {
+      const startTime = Date.now();
+
+      // Get all users (in real app, get active users)
+      const users = await storage.getUsers();
+
+      let totalSynced = 0;
+
+      for (const user of users) {
+        // Get all merchant descriptions for user
+        const merchants = await storage.getMerchantDescriptions(user.id);
+
+        // Pre-warm cache
+        merchantCache.setMany(merchants.map(m => ({
+          userId: user.id,
+          source: m.source,
+          keyDesc: m.keyDesc,
+          aliasDesc: m.aliasDesc
+        })));
+
+        totalSynced += merchants.length;
+      }
+
+      const duration = Date.now() - startTime;
+
+      logger.info("background_sync_complete", {
+        totalSynced,
+        durationMs: duration,
+        cacheSize: merchantCache.getStats().size
+      });
+
+    } catch (error: any) {
+      logger.error("background_sync_error", {
+        error: error.message
+      });
+    }
+  }
+}
+
+export const backgroundSync = new BackgroundSyncService();
+```
+
+**Start in server**:
+
+```typescript
+// server/index.ts
+import { backgroundSync } from './background-sync';
+
+// Start background sync
+if (process.env.NODE_ENV === 'production') {
+  backgroundSync.start();
+}
+```
+
+---
+
+### 4.4 Performance Monitoring
+
+Add monitoring endpoint to track cache performance:
+
+```typescript
+// server/routes.ts
+
+app.get("/api/admin/cache-stats", async (req: Request, res: Response) => {
+  try {
+    const stats = merchantCache.getStats();
+
+    res.json({
+      cache: stats,
+      recommendations: {
+        shouldIncrease: stats.size >= stats.maxSize * 0.9,
+        shouldWarmup: stats.hitRate < 0.5
+      }
+    });
+  } catch (error: any) {
+    res.status(500).json({ error: error.message });
+  }
+});
+```
+
+---
+
+### 4.5 Implementation Checklist
+
+**Backend** (4-6 hours):
+- [ ] Install LRU cache dependency: `npm install lru-cache`
+- [ ] Create `server/merchant-cache.ts` with cache service
+- [ ] Update `getTransactionsWithMerchantAlias()` to use batch query
+- [ ] Add cache invalidation to update/delete endpoints
+- [ ] Create database indexes for performance
+- [ ] Add cache stats monitoring endpoint
+- [ ] (Optional) Create `server/background-sync.ts` for pre-warming
+- [ ] Test cache performance with 1000+ transactions
+
+**Database**:
+- [ ] Add indexes to merchant_descriptions table
+- [ ] Add indexes to transactions table
+- [ ] Verify query performance with EXPLAIN ANALYZE
+
+**Testing**:
+- [ ] Benchmark before/after performance (N+1 vs batch)
+- [ ] Test cache invalidation on updates
+- [ ] Test cache hit rate after 100 requests
+- [ ] Load test with 10,000 transactions
+- [ ] Monitor memory usage with cache
+
+---
+
+## Implementation Priority
+
+### Recommended Order
+
+1. **Phase 3 - Icon Management** (10-12 hours)
+   - High user-facing value
+   - Visual improvement to UX
+   - Independent of Phase 4
+
+2. **Phase 4 - Background Sync** (4-6 hours)
+   - Performance optimization
+   - Becomes more important as data grows
+   - Can be implemented incrementally
+
+### MVP vs Full Implementation
+
+**MVP** (6-8 hours total):
+- Phase 3: Basic icon fetching (Clearbit only, no batch)
+- Phase 4: In-memory cache only (no background sync)
+
+**Full** (14-18 hours total):
+- Phase 3: Full icon management with batch fetch and manual override
+- Phase 4: Complete caching with background sync and monitoring
+
+---
+
+## Success Metrics
+
+### Phase 3 Success Criteria
+- ‚úÖ Icons display for 80%+ of common merchants
+- ‚úÖ Fallback placeholder works for unknown merchants
+- ‚úÖ Icon fetch completes in <2 seconds per merchant
+- ‚úÖ Batch fetch processes 100 merchants in <30 seconds
+
+### Phase 4 Success Criteria
+- ‚úÖ Transaction list load time reduced by 70%+
+- ‚úÖ Cache hit rate >80% after warmup
+- ‚úÖ Memory usage <100MB for 10,000 cached entries
+- ‚úÖ Background sync completes in <10 seconds
+
+---
+
+## Cost Analysis
+
+### Phase 3 Costs
+- **Clearbit Logo API**: Free (unlimited)
+- **Google Favicon**: Free (unlimited)
+- **Storage**: Minimal (URLs only, ~50 bytes per merchant)
+- **Bandwidth**: Low (icons served from external CDN)
+
+**Monthly Cost**: $0-5 (mostly storage)
+
+### Phase 4 Costs
+- **Memory**: ~10MB for 10,000 cached entries
+- **CPU**: Negligible (LRU cache is O(1))
+- **Database**: Reduced load (fewer queries)
+
+**Monthly Cost**: $0 (optimization reduces costs)
+
+---
+
+## Risk Assessment
+
+### Phase 3 Risks
+- **Icon provider downtime**: Mitigated by fallback providers + placeholder
+- **Invalid icons**: Mitigated by validation + manual override
+- **Rate limiting**: Mitigated by batch processing with delays
+
+**Risk Level**: LOW
+
+### Phase 4 Risks
+- **Memory leaks**: Mitigated by LRU cache with max size
+- **Stale cache**: Mitigated by TTL and invalidation
+- **Cache stampede**: Mitigated by batch query approach
+
+**Risk Level**: LOW
+
+---
+
+## Future Enhancements
+
+### Phase 3 Extensions
+1. **Custom icon upload**: Allow users to upload their own merchant logos
+2. **Icon color extraction**: Extract dominant colors for theming
+3. **Icon CDN**: Self-host icons on Cloudflare/Vercel for reliability
+4. **Machine learning**: Train model to predict domains from merchant names
+
+### Phase 4 Extensions
+1. **Redis cache**: Distributed caching for multi-instance deployments
+2. **Query result caching**: Cache entire transaction lists
+3. **Incremental sync**: Only sync changed merchants
+4. **Predictive pre-fetching**: Pre-load likely viewed transactions
+
+---
+
+## Conclusion
+
+Both Phase 3 and Phase 4 provide significant value:
+
+- **Phase 3** improves user experience with visual merchant identification
+- **Phase 4** improves performance and scalability
+
+**Recommendation**: Implement Phase 3 first for immediate UX benefits, then Phase 4 when performance becomes a concern (>1000 transactions per user).
+
+Both phases are **low-risk, high-value** additions to the Merchant Dictionary feature.
diff --git a/docs/_codex/reviews/2025-12-29/EXECUTIVE_SUMMARY.md b/docs/_codex/reviews/2025-12-29/EXECUTIVE_SUMMARY.md
new file mode 100644
index 0000000..0e95381
--- /dev/null
+++ b/docs/_codex/reviews/2025-12-29/EXECUTIVE_SUMMARY.md
@@ -0,0 +1,47 @@
+# Executive Summary
+
+Verdict: NOT READY
+
+Summary
+- Scope vs PRD mismatch and production-blocking API routing issues prevent a release-quality state.
+- Runtime QA blocked because DATABASE_URL is not set in this environment; only static and build-time checks completed.
+- Mandatory docs present except `docs/_codex/NEXT_10_WORKPACKAGES.md` (missing).
+
+Update (branch_feat)
+- Upload error drilldown UI + format detected now implemented.
+- Upload cards now preview top errors inline.
+- Dashboard income sourced from Goals + "Disponivel real" added.
+- Calendar projected vs realized legend + badges + filters added.
+- Confirm merchant bundling + "Por que?" explanations added.
+- Notifications backend integration + unread badge added.
+- Merchant metadata CRUD UI added + applied in lists.
+- Direct `/api` fetches replaced with API client (Goals, Rituals, Event Detail, AI Keywords).
+- Transactions pagination (50 per page) added.
+- Copy normalization + aria-labels for icon buttons applied.
+- Accounts balance shows last updated time.
+
+Top 10 Issues (ranked by severity)
+1) P0: Auth is demo-only with auto-created users; no session validation or access control. All data is effectively public to any user hitting the API. (`server/routes.ts`, `server/storage.ts`).
+2) P0: No real user scoping/authorization; endpoints fetch by hardcoded demo user. This is a release blocker for any multi-user or production context (`server/routes.ts`).
+3) P1: Image/screenshot import pipeline (OCR, balances) is required by PRD but not implemented (no UI or backend endpoints).
+4) P1: AI assistant backend (streaming chat) not implemented; UI shell exists in UX notes but no `/api/ai/chat` endpoint.
+5) P1: CSV processing uses per-row duplicate checks (N+1) and per-row inserts; large files can be slow or timeout (routes + storage). No async chunking (see PRD and plans).
+6) P2: Client bundle is large (676KB JS, 126KB CSS); build warns about chunk size, likely affecting first load (`npm run build`).
+7) P2: Category icon/color definitions are duplicated across pages, increasing maintenance cost.
+
+Top 10 Improvements (UX + Reliability, ranked by impact)
+1) Replace demo auth with real auth/session middleware; enforce user scoping on all endpoints.
+2) Implement image/screenshot import pipeline or remove UI promises from PRD and navigation.
+3) Implement AI assistant backend (SSE) or hide/disclose the feature as planned/coming soon.
+4) Add async/chunked CSV processing with progress reporting (per existing plan).
+5) Add system-triggered notifications (uploads, goals, rituals) to avoid manual creation.
+6) Add rule impact preview (real counts, not just pending).
+7) Consolidate icon/color maps into shared constants.
+8) Introduce server-side filters or pagination for heavy datasets.
+
+Tests Executed
+- `npm run check` (PASS)
+- `npm run build` (PASS with chunk-size warnings)
+
+Runtime QA
+- BLOCKED: `DATABASE_URL` not set. All API smoke tests requiring DB were blocked in this environment.
diff --git a/docs/_codex/reviews/2025-12-29/FEATURE_VERIFICATION_MATRIX.md b/docs/_codex/reviews/2025-12-29/FEATURE_VERIFICATION_MATRIX.md
new file mode 100644
index 0000000..5f4d48c
--- /dev/null
+++ b/docs/_codex/reviews/2025-12-29/FEATURE_VERIFICATION_MATRIX.md
@@ -0,0 +1,38 @@
+# Feature Verification Matrix
+
+Legend: PASS / FAIL / BLOCKED
+
+| Feature / Flow | Expected Behavior | How Tested (steps/commands) | Result |
+| --- | --- | --- | --- |
+| Repo build gate | Typecheck and production build succeed | `npm run check`; `npm run build` | PASS |
+| Health check | `/api/health` returns ok or degraded with DB status | BLOCKED (no `DATABASE_URL`) | BLOCKED (DB not configured) |
+| Auth: login | `POST /api/auth/login` creates/returns user | Static review: `server/routes.ts` | PASS (demo-only) |
+| Auth: get me | `GET /api/auth/me` returns current user | Static review: `server/routes.ts` | PASS (demo-only) |
+| Settings (auto-confirm) | GET/PATCH user settings | Static review: `server/routes.ts`, `client/src/pages/settings.tsx` | PASS (demo-only) |
+| Notifications CRUD | List/create/update/delete notifications | Static review: `server/routes.ts`, `client/src/pages/notifications.tsx` | PASS (backend + UI) |
+| Accounts CRUD | List/create/update/archive accounts | Static review: `server/routes.ts`, `client/src/pages/accounts.tsx` | PASS (code) |
+| Account balance | `/api/accounts/:id/balance` returns aggregate | Static review: `server/routes.ts`, `client/src/pages/accounts.tsx` | PASS (backend + UI) |
+| Upload CSV | Upload CSV, parse, dedupe, create transactions | Static review: `server/csv-parser.ts`, `server/routes.ts`, `client/src/pages/uploads.tsx` | PASS (code) |
+| Upload errors detail | `/api/uploads/:id/errors` returns row errors | Static review: `server/routes.ts`, `client/src/pages/uploads.tsx` | PASS (backend + UI) |
+| Transactions list | `/transactions` displays filtered month list | Static review: `client/src/pages/transactions.tsx` | PASS (code) |
+| Transaction edit | Edit in dialog updates transaction | Static review: `client/src/pages/transactions.tsx`, `server/routes.ts` | PASS (code) |
+| Export CSV | Exports filtered transactions | Static review: `client/src/pages/transactions.tsx` | PASS (code) |
+| Confirm queue | `/confirm` lists `needsReview` items; bulk confirm | Static review: `client/src/pages/confirm.tsx`, `server/routes.ts` | PASS (code) |
+| Rules CRUD | Create/update/delete rules; reapply | Static review: `client/src/pages/rules.tsx`, `server/routes.ts` | PASS (code) |
+| Dashboard metrics | `/dashboard` shows totals + categories | Static review: `client/src/pages/dashboard.tsx`, `server/routes.ts` | PASS (code) |
+| Dashboard -> calendar events fetch | Pulls calendar events via API | Static review: `client/src/pages/dashboard.tsx` uses API client | PASS (code) |
+| Calendar view | Month view + events | Static review: `client/src/pages/calendar.tsx` uses API client | PASS (code) |
+| Calendar event detail | Event detail page uses API client | Static review: `client/src/pages/event-detail.tsx` | PASS (code) |
+| Budgets | CRUD monthly budgets | Static review: `client/src/pages/budgets.tsx`, `server/routes.ts` | PASS (code) |
+| Goals | Monthly goals and progress | Static review: `client/src/pages/goals.tsx`, `server/routes.ts` | PASS (code) |
+| Rituals | Weekly/monthly ritual flow | Static review: `client/src/pages/rituals.tsx`, `server/routes.ts` | PASS (code) |
+| AI keyword analysis | Analyze and apply suggestions | Static review: `client/src/pages/ai-keywords.tsx`, `server/routes.ts` | PASS (code) |
+| AI usage logs | `/api/ai/usage` returns logs | Static review: `server/routes.ts` | PASS (backend) / BLOCKED (no DB) |
+| Merchant metadata | CRUD + match | Static review: `server/routes.ts`, `client/src/pages/merchant-metadata.tsx` | PASS (backend + UI) |
+| AI assistant chat | SSE chat backend | Code search: no `/api/ai/chat` route | FAIL (not implemented) |
+| Screenshot/image import | Upload screenshots, OCR, balances | Code search: no endpoints/UI | FAIL (not implemented) |
+| Production API base routing | Client should call backend URL in prod | Static review: no direct `/api` fetches in pages | PASS (code) |
+
+Notes
+- Runtime endpoint tests were blocked because `DATABASE_URL` is not set in this environment.
+- PASS (code) indicates static verification only; functional runtime verification pending DB and dev server.
diff --git a/docs/_codex/reviews/2025-12-29/IMPROVEMENT_ROADMAP.md b/docs/_codex/reviews/2025-12-29/IMPROVEMENT_ROADMAP.md
new file mode 100644
index 0000000..1125815
--- /dev/null
+++ b/docs/_codex/reviews/2025-12-29/IMPROVEMENT_ROADMAP.md
@@ -0,0 +1,45 @@
+# Improvement Roadmap
+
+Status Update (branch_feat)
+- Done: Upload error drilldown UI + format detected in Uploads.
+- Done: Upload cards now preview top errors.
+- Done: Dashboard income sourced from Goals + "Disponivel real".
+- Done: Calendar projected vs realized legend + badges + filters.
+- Done: Confirm merchant bundling + "Por que?" explanations.
+- Done: Notifications backend integration + unread badge.
+- Done: Merchant metadata CRUD UI + applied overrides in lists.
+- Done: Accounts balance now sourced from `/api/accounts/:id/balance`.
+- Done: Balance cards show last updated time.
+- Done: IA Keywords integrated into Rules tab.
+- Done: Transactions pagination (50 per page).
+- Done: Copy normalization + aria-labels in core icon buttons.
+
+Prioritized Backlog
+
+P0 (Release Blockers)
+| Item | Effort | Dependencies | Notes |
+| --- | --- | --- | --- |
+| Replace demo auth with real auth/session middleware and per-user scoping | L | DB + session store | Requires storage changes and route guards across endpoints. |
+| Remove or label non-functional login options (Google) until implemented | S | None | Avoid misleading users. |
+
+P1 (High Value)
+| Item | Effort | Dependencies | Notes |
+| --- | --- | --- | --- |
+| Implement AI assistant backend (`/api/ai/chat`) or hide UI | L | OpenAI key + C.4 usage tracking | PRD expectation. |
+| Implement screenshot/image import pipeline (OCR + balance extraction) | L | OCR service + schema changes | PRD requirement. |
+| Add impact preview before reapply in Rules (real counts) | S | None | Currently pending count only. |
+| Add system-triggered notifications (uploads, goals, rituals) | M | None | In-app triggers only. |
+
+P2 (Polish)
+| Item | Effort | Dependencies | Notes |
+| --- | --- | --- | --- |
+| Consolidate category icon/color maps into shared constants | S | None | Maintainability. |
+| Add build chunking/route-based code split | M | None | Performance. |
+
+Suggested Batch Packages (for Codex execution)
+1) Batch A (P0): API base fix + Google button gating
+2) Batch B (P0): Auth + user scoping + session store
+3) Batch C (P1): Upload error UI + account balance UI
+4) Batch D (P1): AI assistant backend + usage logging integration
+5) Batch E (P1): Screenshot import pipeline (OCR)
+6) Batch F (P2): Copy polish + accessibility + shared constants
diff --git a/docs/_codex/reviews/2025-12-29/QA_RUNBOOK.md b/docs/_codex/reviews/2025-12-29/QA_RUNBOOK.md
new file mode 100644
index 0000000..7a9acda
--- /dev/null
+++ b/docs/_codex/reviews/2025-12-29/QA_RUNBOOK.md
@@ -0,0 +1,52 @@
+# QA Runbook
+
+Preflight
+1) Install deps (if needed): `npm install`
+2) Typecheck: `npm run check`
+3) Build: `npm run build`
+
+Environment (names only)
+- Required: `DATABASE_URL`
+- Optional: `OPENAI_API_KEY`, `CORS_ORIGIN`, `PORT`, `VITE_API_URL`
+- Optional (Replit integrations): `AI_INTEGRATIONS_OPENAI_API_KEY`, `AI_INTEGRATIONS_OPENAI_BASE_URL`
+
+Database Setup (if DB available)
+1) Set `DATABASE_URL`
+2) Apply schema: `npm run db:push`
+
+Run Dev Server
+- `npm run dev`
+- Expect server on `http://localhost:5000`
+
+Smoke Tests (curl)
+- Health: `curl http://localhost:5000/api/health`
+- Auth: `curl -X POST http://localhost:5000/api/auth/login -H "Content-Type: application/json" -d '{"username":"demo","password":"demo"}'`
+- Me: `curl http://localhost:5000/api/auth/me`
+- Dashboard: `curl "http://localhost:5000/api/dashboard?month=2025-12"`
+- Accounts: `curl http://localhost:5000/api/accounts`
+- Uploads list: `curl http://localhost:5000/api/uploads`
+- Transactions list: `curl "http://localhost:5000/api/transactions?month=2025-12"`
+- Confirm queue: `curl http://localhost:5000/api/transactions/confirm-queue`
+- Rules list: `curl http://localhost:5000/api/rules`
+- Budgets list: `curl "http://localhost:5000/api/budgets?month=2025-12"`
+- Goals list: `curl "http://localhost:5000/api/goals?month=2025-12"`
+- Calendar events list: `curl http://localhost:5000/api/calendar-events`
+- Rituals list: `curl "http://localhost:5000/api/rituals?type=weekly&period=2025-W01"`
+- Notifications list: `curl http://localhost:5000/api/notifications`
+
+Upload Flow (manual)
+1) Start dev server.
+2) Open `/uploads` in browser.
+3) Upload sample CSV (M&M, Amex, Sparkasse).
+4) Verify upload history updated and confirm queue populated.
+5) Open `/confirm` and confirm items.
+
+AI Keyword Analysis (requires OPENAI_API_KEY)
+- POST `http://localhost:5000/api/ai/analyze-keywords`
+- POST `http://localhost:5000/api/ai/apply-suggestions`
+
+What "Done" Means
+- `npm run check` and `npm run build` pass
+- Health endpoint returns `ok` when DB is configured
+- Core flows (upload -> confirm -> dashboard) complete without errors
+- No production routing issues (all client calls use VITE_API_URL)
diff --git a/docs/_codex/reviews/2025-12-29/TECHNICAL_ASSESSMENT.md b/docs/_codex/reviews/2025-12-29/TECHNICAL_ASSESSMENT.md
new file mode 100644
index 0000000..6559a62
--- /dev/null
+++ b/docs/_codex/reviews/2025-12-29/TECHNICAL_ASSESSMENT.md
@@ -0,0 +1,45 @@
+# Technical Assessment
+
+Architecture Overview
+- Frontend: React + Vite, Wouter routing, TanStack Query. API client uses VITE_API_URL via `client/src/lib/api.ts`.
+- Backend: Express (TypeScript, tsx), routes in `server/routes.ts`, storage in `server/storage.ts` via Drizzle ORM.
+- Data: PostgreSQL schema in `shared/schema.ts` with users, transactions, rules, uploads, accounts, goals, budgets, rituals, etc.
+- AI: OpenAI SDK optional via `OPENAI_API_KEY`. AI keyword analysis endpoints exist; AI assistant chat not implemented.
+
+Repo & Runtime Baseline
+- Scripts: `npm run dev`, `npm run build`, `npm run check`, `npm run db:push`.
+- Required env var names (detected): `DATABASE_URL`, `OPENAI_API_KEY`, `CORS_ORIGIN`, `PORT`, `VITE_API_URL`, `AI_INTEGRATIONS_OPENAI_API_KEY`, `AI_INTEGRATIONS_OPENAI_BASE_URL`.
+- App can start without DB (health returns degraded), but all data operations will fail.
+
+Key Risks
+
+Security
+- Demo auth only: login auto-creates a user and there is no session/auth middleware (release blocker).
+- No authorization on endpoints; all queries are for demo user or unrestricted.
+- Request logging in `server/index.ts` now redacts response bodies and logs only keys.
+- No rate limiting or CSRF protection (acceptable for demo but not production).
+
+Reliability
+- Split deployment risk mitigated: client pages now use API client and VITE_API_URL consistently.
+- CSV pipeline: N+1 duplicate checks, row-by-row inserts; can be slow for large CSVs.
+- No retry or circuit-breaker for OpenAI calls; failures surface as generic errors.
+
+Performance
+- Large client bundle (676KB JS) with warning; likely affects time-to-interactive.
+- Transactions list now paginated (50/page); virtualized list still absent for very large datasets.
+- Server-side dashboard endpoints likely compute aggregates without caching.
+
+Maintainability
+- Category icons/colors duplicated across pages; risk of drift.
+- API client usage is now consistent across major pages.
+- Copy normalization is mostly complete; minor inconsistencies remain.
+
+Deployment Readiness Notes
+- `vercel.json` rewrites all routes to `index.html` and does not proxy `/api`; frontend must use VITE_API_URL for all API calls.
+- Health endpoint supports degraded mode when DB is not configured; good for smoke tests.
+- No explicit error boundaries in UI; runtime errors may break pages without fallback.
+
+Observability / Logging Gaps
+- Structured logging exists for upload pipeline (`server/logger.ts`), but most endpoints do not log business events.
+- Request logger redacts response content; still lacks per-endpoint context.
+- No metrics or tracing (response times, DB latency) beyond basic request logging.
diff --git a/docs/_codex/reviews/2025-12-29/UX_UI_REVIEW.md b/docs/_codex/reviews/2025-12-29/UX_UI_REVIEW.md
new file mode 100644
index 0000000..73a4d64
--- /dev/null
+++ b/docs/_codex/reviews/2025-12-29/UX_UI_REVIEW.md
@@ -0,0 +1,84 @@
+# UX/UI Review (Revised After Repo Update)
+
+Information Architecture / Navigation
+- Sidebar now clusters by journey (Vis√£o Geral, Planejamento, A√ß√µes, Automa√ß√£o, Opera√ß√µes, Colabora√ß√£o), which aligns better with the PRD.
+- Naming still inconsistent: "Confirmar" vs "Fila de Confirma√ß√£o"; "IA Keywords" still feels isolated from Regras.
+- Notifica√ß√µes entry now integrated with unread badge.
+- Settings route now exposed in the footer area of the sidebar.
+
+Screen-by-screen Assessment
+
+Login (`client/src/pages/login.tsx`)
+- Clarity: Clear hierarchy and CTA.
+- Friction: Google login, cadastro, e esqueci senha s√£o placeholders.
+- Errors: Still no visible error feedback.
+
+Dashboard (`client/src/pages/dashboard.tsx`)
+- Clarity: KPIs and insights are strong.
+- Improvement: Merchant icon integration exists for recent transactions.
+- Improvement: Estimated income now sourced from Goals.
+- Improvement: "Dispon√≠vel real" reflects commitments.
+
+Calendar (`client/src/pages/calendar.tsx` + `client/src/components/calendar/detail-panel.tsx`)
+- Improvement: Contextual detail panel now exists (day/week summary + badges).
+- Improvement: Projected vs realized is now visually distinct + legend.
+- Improvement: Toggle filters added for projected vs realized.
+- Missing: Week overview for all 4 weeks (per PRD).
+
+Uploads (`client/src/pages/uploads.tsx`)
+- Clarity: Dropzone and provider badges are excellent.
+- Improvement: Row-level error drilldown now available.
+- Improvement: Format detected shown in history.
+- Improvement: Top errors preview visible in upload cards.
+
+Confirm Queue (`client/src/pages/confirm.tsx`)
+- Clarity: Confidence buckets and totals are strong.
+- Improvement: Merchant bundling for batch categorization.
+- Improvement: "why this category" inline (rule/keyword/confidence).
+
+Transactions (`client/src/pages/transactions.tsx`)
+- Improvement: Merchant icons in list.
+- Improvement: "why this category" inline.
+- Performance: Pagination added (50 per page).
+
+Rules (`client/src/pages/rules.tsx`)
+- Improvement: N1/N2/N3 guidance in form.
+- Partial: Impact preview (pending count) before reapply.
+- Improvement: AI Keywords now lives as a tab inside Rules.
+
+Accounts (`client/src/pages/accounts.tsx`)
+- Improvement: Balance now computed from `/api/accounts/:id/balance`.
+- Improvement: Balance now shows last updated time.
+
+Goals (`client/src/pages/goals.tsx`)
+- Copy now clarifies goals vs budget; empty state still needs CTA.
+
+Budgets (`client/src/pages/budgets.tsx`)
+- Still lacks copy/replicate from previous month and suggestions.
+
+Rituals (`client/src/pages/rituals.tsx`)
+- Structure solid; agreements history now visible, still missing linkage to budget/goals changes.
+
+AI Keywords (`client/src/pages/ai-keywords.tsx`)
+- Strong bulk analysis UI.
+- Missing: Impact preview before apply; now integrated into Rules.
+
+Notifications (`client/src/pages/notifications.tsx`)
+- Backend integration done with mark-as-read + delete.
+- Missing: auto-triggered notifications from system events.
+
+Settings (`client/src/pages/settings.tsx`)
+- Auto-confirm settings are functional.
+- Still includes placeholder controls (integrations/export/dark mode).
+
+Consistency / Accessibility
+- Copy normalization largely complete; remaining inconsistencies s√£o pontuais.
+- Icon-only buttons now have aria-labels in core flows.
+- Local icon/color maps are duplicated across pages.
+
+Concrete Improvement Proposals (specific, no implementation)
+1) Add impact preview before reapply in Rules (real counts, not just pending).
+2) Add upload image flow (per PRD).
+3) Add AI chat backend + persistent history.
+4) Add system-triggered notifications (uploads, goals, rituals).
+5) Unify icon/color maps into shared constants.
diff --git a/docs/_codex/ux_review/MICROCOPY_AND_LANGUAGE_REVIEW.md b/docs/_codex/ux_review/MICROCOPY_AND_LANGUAGE_REVIEW.md
new file mode 100644
index 0000000..9b04ec1
--- /dev/null
+++ b/docs/_codex/ux_review/MICROCOPY_AND_LANGUAGE_REVIEW.md
@@ -0,0 +1,23 @@
+# Microcopy and Language Review (Revised)
+
+## Diagnostico rapido
+- Linguagem e amigavel, agora com acentos corrigidos nos fluxos principais.
+- Alguns controles ainda sao placeholders (integracoes, Google login), agora marcados como "Em breve".
+
+## Correcoes de naming (antes -> depois)
+- "Confirmar" -> "Fila de Confirma√ß√£o".
+- "IA Keywords" -> "IA: Sugest√µes de Regras".
+- "Centro de Importa√ß√£o" -> "Importar Extratos".
+- "Or√ßamentos" -> "Or√ßamento do M√™s".
+- "Metas" -> "Metas (Objetivos)".
+- "Motor de Regras" -> "Regras de Categoriza√ß√£o".
+
+## Copy que gera confusao
+- "A IA pre-analisou" -> "Regras e IA sugeriram categorias para revisao".
+- "Integracoes" -> marcar "Em breve" (feito).
+- "Exportar" em settings -> marcar "Em breve" se nao funcional (feito).
+
+## Regras globais de linguagem
+- CTAs no imperativo: "Importar", "Revisar", "Aplicar", "Salvar".
+- Sempre indicar unidade e periodo (EUR, mes atual).
+- Evitar termos tecnicos sem explicacao (strict).
diff --git a/docs/_codex/ux_review/MISSING_FEATURES_AND_OPPORTUNITIES.md b/docs/_codex/ux_review/MISSING_FEATURES_AND_OPPORTUNITIES.md
new file mode 100644
index 0000000..1342b09
--- /dev/null
+++ b/docs/_codex/ux_review/MISSING_FEATURES_AND_OPPORTUNITIES.md
@@ -0,0 +1,28 @@
+# Missing Features and Opportunities (Revised)
+
+## Gaps que bloqueiam confianca (ainda abertos)
+- Upload de imagens (promessa do PRD) nao existe.
+- Gestao de categorias ainda e um shell (falta CRUD e impacto em regras/transacoes).
+- IA chat ainda sem backend real (respostas simuladas).
+- Notificacoes sem gatilhos automaticos (apenas CRUD manual).
+- Projetado vs realizado nao aparece em Rituais (apenas Calendario).
+
+## Pequenas features com alto ROI (pendentes)
+- CTA "Criar regra" dentro do detalhe da transacao.
+- Sugestoes de merchants (autocomplete de padr√µes mais usados).
+- Filtros por "Compromissos" no Dashboard.
+
+## Instrumentacao esperada pelo usuario
+- "O que mudou desde semana passada?" (delta em dashboard e rituais).
+- "O que devo fazer agora?" (proximo passo claro por tela).
+
+## Oportunidades de produto
+- Resumo semanal automatico (ritual): 3 insights + 1 acao.
+- Assistente contextual (badge de contexto) ja implementado, falta integrar com dados reais.
+- Biblioteca de contas: saldo em tempo real j√° integrado; falta limite e recencia de atualiza√ß√£o.
+
+## Fluxos ausentes ou incompletos
+- Gestao de categorias (arvore N1-N3) sem backend.
+- Upload de imagens (promessa do PRD) nao existe.
+- Historico de conversas da IA apenas local (sem persistencia).
+- IA Keywords ja integrado em Regras, falta preview de impacto.
diff --git a/docs/_codex/ux_review/MISSING_FEATURES_PLAN.md b/docs/_codex/ux_review/MISSING_FEATURES_PLAN.md
new file mode 100644
index 0000000..6a39538
--- /dev/null
+++ b/docs/_codex/ux_review/MISSING_FEATURES_PLAN.md
@@ -0,0 +1,452 @@
+# Missing and New Features Plan (Sprint-Ready)
+
+This plan aligns with backend readiness and splits items into quick wins vs dependency-bound work.
+
+Legend
+- Estimate: S (0.5‚Äì1d), M (2‚Äì4d), L (5‚Äì8d)
+- Owner: FE, BE, Design, QA, PM
+- Backend Ready: Yes/No
+
+## Quick Wins (Backend Ready)
+
+### Ticket QW-01: Upload Errors UI + Format Detected
+- Backend Ready: Yes (upload_errors endpoint exists)
+- Owner: FE, Design, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Call GET `/api/uploads/:id/errors` on demand.
+  2) Store error rows in local state for modal display.
+- UX/UI
+  1) Add \"Formato\" badge per upload (M&M, Amex, Sparkasse).
+  2) Add \"Ver erros\" link when errors exist.
+  3) Modal lists row number, message, raw data (if present).
+  4) Empty state: \"Nenhum erro encontrado\".
+- Acceptance
+  - User can open row-level errors for a given upload.
+
+### Ticket QW-02: Notifications Backend Integration
+- Backend Ready: Yes (notifications endpoints exist)
+- Owner: FE, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Replace mock data with GET `/api/notifications`.
+  2) Wire PATCH `/api/notifications/:id/read` and DELETE.
+- UX/UI
+  1) Keep tabs (Todas/N√£o lidas/Importantes).
+  2) Add loading + empty states.
+  3) Add unread badge in sidebar.
+- Acceptance
+  - Notifications list reflects real data and persists read state.
+
+### Ticket QW-03: Merchant Metadata UI
+- Backend Ready: Yes (merchant_metadata endpoints exist)
+- Owner: FE, Design, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) CRUD UI for `/api/merchant-metadata`.
+  2) Add match preview (description -> matched merchant).
+- UX/UI
+  1) Table/list with pattern, icon, color.
+  2) Edit modal with live preview.
+- Acceptance
+  - Users can add/edit merchant icons without code changes.
+
+### Ticket QW-04: \"Why this category\" in Confirm + Transactions
+- Backend Ready: Yes (ruleIdApplied, suggestedKeyword, confidence exist)
+- Owner: FE, Design, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Ensure list queries include ruleIdApplied/suggestedKeyword/confidence.
+  2) Add inline popover component.
+- UX/UI
+  1) \"Por que?\" icon in Confirm + Transactions list.
+  2) Popover shows rule name, keyword, confidence.
+- Acceptance
+  - Explanation visible in 1 click without leaving list.
+
+### Ticket QW-05: Preview de erros no card de upload
+- Backend Ready: Yes (upload_errors endpoint exists)
+- Owner: FE, Design
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Prefetch dos erros por upload com status de erro.
+  2) Mostrar as 2 primeiras linhas no card.
+- UX/UI
+  1) Texto enxuto com linha + mensagem.
+  2) Link \"Ver erros\" continua abrindo modal completo.
+- Acceptance
+  - Usu√°rio v√™ os principais erros sem abrir modal.
+
+### Ticket QW-06: Filtros de projetado/realizado no Calend√°rio
+- Backend Ready: Yes
+- Owner: FE, Design
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Toggle para ocultar transa√ß√µes realizadas.
+  2) Toggle para ocultar proje√ß√µes de compromissos.
+- UX/UI
+  1) Controles pr√≥ximos da legenda.
+  2) Estado persistente na sess√£o.
+- Acceptance
+  - Usu√°rio controla visibilidade por tipo de item.
+
+### Ticket QW-07: Merchant metadata aplicado na UI
+- Backend Ready: Yes (merchant_metadata endpoints)
+- Owner: FE, Design
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Resolver override por pattern no cliente.
+  2) Priorizar friendlyName + cor + √≠cone do cadastro.
+- UX/UI
+  1) Dashboard, Transa√ß√µes e Calend√°rio usam override.
+  2) Fallback para √≠cones padr√£o quando n√£o houver match.
+- Acceptance
+  - Cadastro de merchant altera o visual nas listas.
+
+### Ticket QW-08: Preview leve do impacto em Regras
+- Backend Ready: Yes (confirm queue)
+- Owner: FE, Design
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Mostrar contagem de pendentes ao lado do bot√£o de reaplicar.
+- UX/UI
+  1) Badge discreto com n√∫mero de pend√™ncias.
+- Acceptance
+  - Usu√°rio entende o alcance antes de executar.
+
+### Ticket QW-09: Guia N1/N2/N3 no formul√°rio de regras
+- Backend Ready: Yes
+- Owner: Design, FE
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Texto curto explicando os n√≠veis.
+- UX/UI
+  1) Microcopy abaixo das categorias.
+- Acceptance
+  - Usu√°rio entende a hierarquia sem documenta√ß√£o externa.
+
+### Ticket QW-10: CTAs de onboarding e rec√™ncia de saldo
+- Backend Ready: Yes
+- Owner: FE, Design
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) CTA de metas quando vazio.
+  2) Timestamp de atualiza√ß√£o do saldo em contas.
+- UX/UI
+  1) Card discreto em Metas.
+  2) \"Atualizado HH:mm\" em Contas.
+- Acceptance
+  - Usu√°rio entende onde come√ßar e quando o saldo foi atualizado.
+
+### Ticket QW-11: CTA "Criar regra" em detalhe da transa√ß√£o
+- Backend Ready: Yes
+- Owner: FE, Design, QA
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Expor CTA no detalhe da transa√ß√£o com deep link para `/rules`.
+  2) Prefill de descri√ß√£o, categoria, tipo, fixo/vari√°vel e palavra-chave.
+- UX/UI
+  1) Bot√£o secund√°rio "Criar regra".
+  2) Feedback por toast ao abrir modal j√° preenchido.
+- Acceptance
+  - Usu√°rio cria regra em 1 clique a partir de uma transa√ß√£o.
+
+### Ticket QW-12: Notifica√ß√µes autom√°ticas (uploads, metas, rituais)
+- Backend Ready: Yes (notifications endpoints + triggers)
+- Owner: BE, FE, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Criar notifica√ß√µes ao finalizar upload (sucesso/duplicado/erro).
+  2) Criar notifica√ß√µes ao criar/atualizar metas.
+  3) Criar notifica√ß√µes ao concluir rituais.
+- UX/UI
+  1) Copys claras com resultado e a√ß√£o sugerida.
+  2) Badge de n√£o lidas atualizado.
+- Acceptance
+  - Eventos cr√≠ticos geram notifica√ß√µes automaticamente.
+
+### Ticket QW-13: Regras ‚Äî export/import com Classifica√ß√µes completas
+- Backend Ready: Yes
+- Owner: FE, BE, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Exportar planilha com duas abas: "Regras" e "Classificacoes".
+  2) "Classificacoes" cont√©m todas as categorias (mesmo sem keywords).
+  3) Import aceita ambas as abas, ignora linhas vazias.
+- UX/UI
+  1) Microcopy explicando a diferen√ßa entre regras e classifica√ß√µes.
+  2) Mensagem de sucesso com contagem por aba.
+- Acceptance
+  - Usu√°rio consegue migrar regras e mapa de categorias.
+
+### Ticket QW-14: Dicion√°rio de Comerciantes dentro de Configura√ß√µes
+- Backend Ready: Yes
+- Owner: FE, Design, QA
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Links diretos na aba Integra√ß√µes das Configura√ß√µes.
+  2) Remover item do menu principal para reduzir ru√≠do.
+- UX/UI
+  1) Descri√ß√£o clara do objetivo do dicion√°rio.
+- Acceptance
+  - Dicion√°rio encontrado onde o usu√°rio espera (Configura√ß√µes).
+
+### Ticket QW-15: An√°lise Inteligente de Keywords (mapeamento real)
+- Backend Ready: Yes
+- Owner: BE, FE, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Basear an√°lise em tabelas de mapeamento e alias.
+  2) Remover sugest√µes j√° presentes nas regras.
+  3) Expor dados consolidados para o painel.
+- UX/UI
+  1) Indicar fontes (mapeamento vs regras).
+  2) Mostrar exemplos de descri√ß√µes agrupadas.
+- Acceptance
+  - Sugest√µes refletem dados reais do usu√°rio.
+
+### Ticket QW-16: Sparkasse CSV ‚Äî fix de detec√ß√£o com BOM
+- Backend Ready: Yes
+- Owner: BE, QA
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Remover BOM na detec√ß√£o e parsing.
+- UX/UI
+  1) Nenhuma mudan√ßa vis√≠vel, mas erro eliminado.
+- Acceptance
+  - CSV Sparkasse com BOM √© detectado corretamente.
+
+### Ticket QW-17: √çcones antes da descri√ß√£o (listas e agrupamentos)
+- Backend Ready: Yes
+- Owner: FE, Design, QA
+- Estimate: S
+- Dependencies: Merchant metadata
+- Status: Done (branch_feat)
+- Logic
+  1) Usar merchant metadata para resolver √≠cone/nome.
+  2) Fallback para √≠cones gen√©ricos quando n√£o houver match.
+- UX/UI
+  1) √çcone alinhado com o texto da descri√ß√£o.
+- Acceptance
+  - Listas mostram √≠cones consistentes antes da descri√ß√£o.
+
+### Ticket QW-18: Revis√£o de Portugu√™s (acentos e clareza)
+- Backend Ready: Yes
+- Owner: Design, FE, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Varredura de strings sem acento/termos amb√≠guos.
+  2) Ajustar labels e microcopy conforme guia.
+- UX/UI
+  1) Manter tom calmo e preciso.
+- Acceptance
+  - Interface em portugu√™s consistente e correta.
+
+## Dependency-Bound Items
+
+### Ticket DEP-01: Dashboard \"Dispon√≠vel Real\"
+- Backend Ready: Partial (needs consistent income source)
+- Owner: FE, BE, Design, QA
+- Estimate: M
+- Dependencies: Goals/Budget as income source
+- Status: Done (branch_feat, using Goals)
+- Logic
+  1) Pull estimated income from Goals or Budget total.
+  2) Fetch commitments (calendar events) for month.
+  3) Compute `disponivel = renda_estimada - gasto_real - compromissos_futuros`.
+- UX/UI
+  1) KPI \"Dispon√≠vel real\".
+  2) Breakdown tooltip: renda, gasto, compromissos.
+  3) CTA if income missing.
+- Acceptance
+  - Dashboard shows a trustworthy number with explanation.
+
+### Ticket DEP-02: Confirm Queue Merchant Bundling
+- Backend Ready: Yes
+- Owner: FE, Design, QA
+- Estimate: L
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Group pending transactions by normalized merchant.
+  2) Apply category to group.
+  3) Optional rule creation from group keyword.
+- UX/UI
+  1) Toggle \"Agrupar por merchant\".
+  2) Group card shows count, total, samples.
+  3) One form applies to all.
+- Acceptance
+  - User can confirm 10+ similar transactions in one action.
+
+### Ticket DEP-03: Calendar Projected vs Realized
+- Backend Ready: Partial (needs projected markers)
+- Owner: FE, Design, QA
+- Estimate: M
+- Dependencies: Commitments data and tagging
+- Status: Done (branch_feat)
+- Logic
+  1) Tag events as projected and transactions as realized.
+  2) Week view totals split.
+- UX/UI
+  1) Legend (Projetado vs Realizado).
+  2) Distinct styles (solid vs dashed).
+  3) Summary card with two totals.
+- Acceptance
+  - Users visually separate future commitments from actual spend.
+
+### Ticket DEP-04: Categories Management Screen
+- Backend Ready: Yes
+- Owner: BE, FE, Design, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Read hierarchy (N1/N2/N3) from schema or config.
+  2) Allow rename/move with validation.
+- UX/UI
+  1) Tree view.
+  2) Impact preview: \"X regras / Y transa√ß√µes\".
+- Acceptance
+  - Taxonomy is editable and explainable.
+
+### Ticket DEP-05: Goals vs Budget Clarification
+- Backend Ready: Yes
+- Owner: Design, FE, QA
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Align data source for dashboard totals.
+- UX/UI
+  1) Rename labels to \"Objetivos\" vs \"Or√ßamento\".
+  2) Add explainer text on both screens.
+- Acceptance
+  - Users understand difference without reading docs.
+
+### Ticket DEP-06: Notifications + recomenda√ß√µes de a√ß√£o
+- Backend Ready: Yes
+- Owner: FE, Design, QA
+- Estimate: S
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Mapear notifica√ß√µes por t√≠tulo para a√ß√£o sugerida.
+  2) Exibir CTA contextual (Uploads, Metas, Rituais).
+- UX/UI
+  1) Bot√£o "Ver uploads", "Ver metas", "Ver rituais".
+- Acceptance
+  - Notifica√ß√µes guiam a√ß√µes concretas.
+
+### Ticket DEP-07: Dicion√°rio de Comerciantes ‚Äî upload/download
+- Backend Ready: Yes
+- Owner: BE, FE, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Upload CSV/Excel de aliases.
+  2) Export com padr√µes e contagem de ocorr√™ncias.
+- UX/UI
+  1) Valida√ß√£o com preview e erros por linha.
+- Acceptance
+  - Usu√°rio consegue migrar dicion√°rio sem esfor√ßo.
+
+### Ticket DEP-08: Regras com preview de impacto real
+- Backend Ready: Yes
+- Owner: BE, FE, Design, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Simular regra e retornar n√∫mero de transa√ß√µes afetadas.
+- UX/UI
+  1) Preview no modal antes de salvar.
+- Acceptance
+  - Usu√°rio entende o impacto antes de aplicar.
+
+### Ticket DEP-09: AI Assistant com contexto real
+- Backend Ready: Yes (chat endpoint + contexto resumido)
+- Owner: BE, FE, Design, QA
+- Estimate: L
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) SSE com contexto de transa√ß√µes, metas e or√ßamento.
+  2) Persist√™ncia de conversas.
+- UX/UI
+  1) Respostas com refer√™ncias ("com base em...").
+- Acceptance
+  - Chat entrega respostas √∫teis e verific√°veis.
+
+### Ticket DEP-10: Gest√£o de Categorias completa
+- Backend Ready: Yes
+- Owner: BE, FE, Design, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) CRUD com valida√ß√£o e impacto em regras/transa√ß√µes.
+- UX/UI
+  1) √Årvore + painel de impacto.
+- Acceptance
+  - Usu√°rio controla a taxonomia sem riscos.
+
+### Ticket DEP-06: AI Chat History + Context Badge
+- Backend Ready: Yes
+- Owner: BE, FE, Design, QA
+- Estimate: M
+- Dependencies: None
+- Status: Done (branch_feat)
+- Logic
+  1) Persist conversation list or local history.
+  2) Pass current route as context.
+- UX/UI
+  1) Badge \"Contexto atual\" in chat header.
+  2) Simple list of past conversations.
+- Acceptance
+  - Users know what data the AI is using.
+
+## Suggested Sprint Order
+
+Sprint 1 (Quick Wins)
+- QW-01, QW-02, QW-03, QW-04, QW-05, QW-06, QW-07, QW-08, QW-09, QW-10
+
+Sprint 2 (Core UX)
+- DEP-01, DEP-02, DEP-03
+
+Sprint 3 (Platform UX)
+- DEP-04, DEP-05, DEP-06
diff --git a/docs/_codex/ux_review/NAVIGATION_AND_INFORMATION_ARCHITECTURE.md b/docs/_codex/ux_review/NAVIGATION_AND_INFORMATION_ARCHITECTURE.md
new file mode 100644
index 0000000..ba84d76
--- /dev/null
+++ b/docs/_codex/ux_review/NAVIGATION_AND_INFORMATION_ARCHITECTURE.md
@@ -0,0 +1,54 @@
+# Navigation and Information Architecture (Revised)
+
+## Estado atual
+- Sidebar clusterizada por jornada (Visao Geral, Planejamento, Acoes, Automacao, Operacoes, Colaboracao).
+- Notificacoes integradas e com badge de nao lidas.
+- Settings aparece no rodape da sidebar (fora dos clusters).
+- IA Keywords foi movida para aba dentro de Regras; item removido do menu.
+
+## Ajustes recomendados
+
+### 1) Visao Geral
+- Dashboard
+- Calendario
+- Notificacoes
+Racional: leitura rapida e alertas.
+
+### 2) Acoes
+- Fila de Confirmacao
+- Transacoes
+Racional: limpar pendencias e auditar.
+
+### 3) Planejamento
+- Orcamento do Mes
+- Metas (Objetivos)
+- Rituais
+Racional: ciclo de planejamento.
+
+### 4) Automacao
+- Regras de Categorizacao
+- Categorias (quando backend estiver pronto)
+- Dicionario de Merchants
+- Merchants (iconografia)
+- IA: Sugestoes (como aba de Regras)
+Racional: governanca do sistema (reduzir itens soltos).
+
+### 5) Operacoes
+- Uploads
+- Contas
+Racional: entrada de dados e contas.
+
+### 6) Configuracoes
+- Configuracoes
+Racional: preferencia e controle (hoje esta escondido).
+
+## Nomenclatura recomendada
+- "Confirmar" -> "Fila de Confirmacao".
+- "IA Keywords" -> "IA: Sugestoes de Regras".
+- "Orcamentos" -> "Orcamento do Mes".
+- "Metas" -> "Metas (Objetivos)".
+
+## O que deve ser escondido ou mesclado
+- Mesclar IA Keywords dentro de Regras para reduzir ruido.
+- Mover "Merchants" e "Dicionario" para um sub-menu unico de "Merchants".
+- Se Settings mantiver abas "em breve", sinalizar e isolar dessas funcoes.
diff --git a/docs/_codex/ux_review/PHASE_B_UX_IMPLEMENTATION_CHECKLIST.md b/docs/_codex/ux_review/PHASE_B_UX_IMPLEMENTATION_CHECKLIST.md
new file mode 100644
index 0000000..8a2f41d
--- /dev/null
+++ b/docs/_codex/ux_review/PHASE_B_UX_IMPLEMENTATION_CHECKLIST.md
@@ -0,0 +1,162 @@
+# Phase B UX Implementation Checklist (Revised)
+
+Scope: Convert current gaps into engineering tasks with acceptance criteria.
+
+## Update (branch_feat)
+- Done: "Why this category" in Confirm + Transactions.
+- Done: Projected vs Realized styling in Calendar + detail panel.
+- Done: Upload format + row-level errors UI.
+- Done: Merchant bundling in Confirm.
+- Done: Dashboard "Disponivel real" + remove hardcoded income (uses Goals).
+- Done: Notifications backend integration + unread badge.
+- Done: Goals vs Budget copy clarification.
+- Done: IA Keywords integrated into Rules (tab).
+- Done: Rituals history section.
+- Done: Next-step CTAs on key screens.
+
+## Global (cross-cutting)
+
+1) Consistent Portuguese copy + accents
+- Acceptance: No missing accents in primary UI labels; menu title matches page title.
+
+2) "Why this category" affordance
+- Acceptance: Rule/keyword/confidence visible in 1 click in Confirm + Transactions.
+
+3) Projected vs Realized visual language
+- Acceptance: Future values labeled "Projetado" and styled distinctly; past values labeled "Realizado".
+
+4) API base safety
+- Acceptance: No direct `/api` fetches; all requests use shared API base.
+
+## Screen: Login
+
+1) Demo mode clarity
+- Acceptance: UI explicitly indicates demo mode and data source.
+
+2) Error feedback
+- Acceptance: Invalid login shows inline error; button disabled while loading.
+
+3) Placeholder actions
+- Acceptance: Google login and cadastro are functional or marked "Em breve".
+
+## Screen: Dashboard
+
+1) Disponivel real KPI
+- Acceptance: KPI = renda estimada - gastos - compromissos; breakdown accessible.
+
+2) Remove hardcoded income
+- Acceptance: Income source is Goals/Budget or user setting.
+
+3) Empty state
+- Acceptance: If no data, show CTA to Uploads.
+
+## Screen: Calendar
+
+1) Projected vs realized styling
+- Acceptance: Events vs transactions visually distinct; legend visible.
+
+2) Weekly summary (4 weeks)
+- Acceptance: Week view shows all 4 weeks with totals and capacity.
+
+3) Contextual detail panel
+- Acceptance: Title and summary adapt to day vs week.
+
+## Screen: Uploads
+
+1) Format detected column
+- Acceptance: Upload history shows provider badge.
+
+2) Row-level errors UI
+- Acceptance: "Ver erros" opens row list from upload_errors endpoint.
+
+3) Partial success messaging
+- Acceptance: Toasts and history reflect imported vs failed rows.
+
+## Screen: Confirm Queue
+
+1) Merchant bundling
+- Acceptance: Group by merchant; one form applies to group.
+
+2) Explain suggestions
+- Acceptance: Each suggestion shows source + confidence.
+
+3) Empty state
+- Acceptance: No pending items shows CTA to Regras/Uploads.
+
+## Screen: Transactions
+
+1) Status column
+- Acceptance: List shows Auto/Manual/Pendente/Interno with legend.
+
+2) Quick "why"
+- Acceptance: Inline popover shows rule/keyword/confidence.
+
+3) Pagination/virtualization
+- Acceptance: Responsive at 5k+ rows.
+
+## Screen: Rules
+
+1) Impact preview
+- Acceptance: Reapply shows "X transacoes mudariam" before applying.
+
+2) Category hierarchy guidance
+- Acceptance: UI explains N1/N2/N3 and shows full path.
+
+3) Empty state
+- Acceptance: First-time user sees education + CTA.
+
+## Screen: Accounts
+
+1) Balance source clarity
+- Acceptance: Each balance shows origin (upload/manual) and last update.
+
+2) Net position explanation
+- Acceptance: Explains formula in tooltip.
+
+## Screen: Goals
+
+1) Clarify goals vs budget
+- Acceptance: Copy separates "Objetivos" from "Orcamento".
+
+2) Empty state
+- Acceptance: When no goals, show CTA with example.
+
+## Screen: Budgets
+
+1) Copy from previous month
+- Acceptance: One-click copy; confirmation toast.
+
+2) Suggestions
+- Acceptance: Button applies last-month/3-month average values.
+
+## Screen: Rituals
+
+1) Agreements history
+- Acceptance: Past agreements visible with status.
+
+2) Next step CTA
+- Acceptance: After ritual, CTA to adjust budget/goals.
+
+## Screen: AI Keywords
+
+1) Impact preview
+- Acceptance: "X transacoes serao atualizadas" before apply.
+
+2) Merge into Rules
+- Acceptance: Appears as tab within Rules or deep link.
+
+## Screen: Notifications
+
+1) Backend integration
+- Acceptance: Notifications list uses API, not mock data.
+
+2) Mark as read
+- Acceptance: PATCH /read wired and reflected in UI.
+
+## Screen: Settings
+
+1) Functional vs placeholder
+- Acceptance: Placeholders marked "Em breve" or hidden.
+
+2) Auto-confirm explanation
+- Acceptance: Explains threshold effect and shows current value.
diff --git a/docs/_codex/ux_review/PRODUCT_EXPERIENCE_OVERVIEW.md b/docs/_codex/ux_review/PRODUCT_EXPERIENCE_OVERVIEW.md
new file mode 100644
index 0000000..d8842c4
--- /dev/null
+++ b/docs/_codex/ux_review/PRODUCT_EXPERIENCE_OVERVIEW.md
@@ -0,0 +1,33 @@
+# Product Experience Overview (Revised)
+
+## Problema que o app resolve (1 paragrafo)
+RitualFin transforma CSVs e screenshots em uma visao confiavel do mes, destacando gastos reais, compromissos futuros e o quanto e seguro gastar agora. O valor central e reduzir ansiedade com transparencia: transferencias internas nao distorcem, categorizacao e explicavel, e o usuario ensina o sistema com pouco esforco.
+
+## Modelo mental primario do usuario
+O usuario pensa em rituais: importar -> revisar -> planejar -> acompanhar. Ele quer uma leitura rapida (dashboard), um funil de limpeza (confirmacao), e um sistema que aprende sem perder governanca.
+
+## O UI respeita esse modelo? Onde quebra
+- Alinha: Dashboard, Confirmacao, Regras e Rituais se encaixam no fluxo de trabalho.
+- Alinha: Notificacoes integradas e feedback de upload mais claro.
+- Quebra: projetado vs realizado ainda nao se estende a Rituais.
+- Quebra: Metas vs Orcamento ainda pedem explicacao comparativa.
+- Quebra: IA ainda nao usa dados reais nem tem historico persistente.
+
+## Forcas principais da experiencia atual
+- Fila de confirmacao com confianca e bulk action acelera o trabalho.
+- Upload com CTA claro para o proximo passo.
+- Transacoes + contas oferecem boa rastreabilidade (badges, export, saldo).
+- Merchant icons aumentam legibilidade em dashboard e transacoes.
+
+## Riscos de experiencia se for para producao como esta
+- Upload de imagens ainda ausente (promessa do PRD).
+- Gestao de categorias sem backend (apenas shell).
+- IA chat ainda simulado (sem valor real percebido).
+- Notificacoes sem gatilhos automaticos podem parecer vazias.
+
+## Principios de UX para RitualFin (3-5)
+1) Verdade financeira acima de estetica: projetado vs realizado sempre distinguivel.
+2) Revisao mais rapida que correcoes: confirmar deve ser mais facil que editar.
+3) Aprendizado explicavel: toda sugestao precisa mostrar "por que".
+4) Um proximo passo por tela: cada pagina termina com uma acao principal clara.
+5) Controles simples, efeitos fortes: poucas configuracoes, impacto visivel.
diff --git a/docs/_codex/ux_review/SCREEN_BY_SCREEN_REVIEW.md b/docs/_codex/ux_review/SCREEN_BY_SCREEN_REVIEW.md
new file mode 100644
index 0000000..465d22b
--- /dev/null
+++ b/docs/_codex/ux_review/SCREEN_BY_SCREEN_REVIEW.md
@@ -0,0 +1,313 @@
+# Screen by Screen Review (Revised)
+
+## Login / Entry
+
+### a) Screen purpose
+"Como entro com seguranca e sem friccao?"
+
+### b) O que funciona bem
+- Hierarquia clara e CTA principal visivel.
+
+### c) Friccoes e problemas
+- Google login e cadastro sao placeholders; geram expectativa falsa.
+- Sem feedback de erro de login.
+
+### d) Propostas
+- Exibir "modo demo" explicitamente.
+- Adicionar mensagem de erro de autenticacao.
+- Marcar links como "em breve" se nao funcionam.
+
+### e) Estados ausentes
+- Erro de login.
+- Bloqueio de clique repetido no Google login.
+
+---
+
+## Dashboard
+
+### a) Screen purpose
+"Quanto posso gastar agora e o que ainda vai cair?"
+
+### b) O que funciona bem
+- KPIs e insights com leitura rapida.
+- Merchant icons em transacoes recentes.
+
+### c) Friccoes e problemas
+- "Disponivel real" ainda nao tem breakdown visivel (renda/gasto/compromissos).
+
+### d) Propostas
+- Manter "Disponivel real" como KPI principal e expor breakdown em tooltip.
+
+### e) Estados ausentes
+- Sem dados (primeiro uso) com CTA para Uploads.
+
+---
+
+## Calendario (Mes + Semana)
+
+### a) Screen purpose
+"Onde estao meus gastos e compromissos no tempo?"
+
+### b) O que funciona bem
+- Detail panel contextual com resumo dia/semana.
+- Filtros de projetado/realizado no calendario.
+
+### c) Friccoes e problemas
+- Semana nao mostra 4 semanas do mes (PRD).
+
+### d) Propostas
+- Manter legenda visual e adicionar totais separados por semana.
+- Semana com 4 blocos e totais por semana.
+
+### e) Estados ausentes
+- Dia vazio (sem transacoes e eventos).
+
+---
+
+## Event Detail (Calendario)
+
+### a) Screen purpose
+"Qual o impacto e historico deste compromisso?"
+
+### b) O que funciona bem
+- Resumo do evento e proximo vencimento.
+
+### c) Friccoes e problemas
+- Sem link entre evento e transacoes reais.
+
+### d) Propostas
+- "Vincular transacao" ou "Marcar como pago".
+
+---
+
+## Upload (CSV + Imagens)
+
+### a) Screen purpose
+"Importar dados e entender o resultado."
+
+### b) O que funciona bem
+- Dropzone clara, KPIs e CTA para Confirmacao.
+- Formato detectado e preview dos erros direto no card.
+
+### c) Friccoes e problemas
+- Progress bar e fake.
+- Upload de imagens (prometido) nao existe.
+
+### d) Propostas
+- Melhorar progress com progresso real ou remover.
+- Adicionar tab "CSV" e "Imagens" quando houver upload de imagem.
+
+---
+
+## Confirmacao / Fila de Classificacao
+
+### a) Screen purpose
+"Resolver pendencias rapido e ensinar o sistema."
+
+### b) O que funciona bem
+- Confianca em buckets e CTA de bulk confirm.
+
+### c) Friccoes e problemas
+- Agrupamento por merchant ainda nao cria regra com 1 clique.
+- Explicacao de sugestao nao aparece no fluxo de bulk confirm.
+
+### d) Propostas
+- Adicionar opcao "Criar regra" no grupo.
+- Levar "Por que?" para o modo agrupado (dentro do card).
+
+---
+
+## Transacoes (Lista + Detalhes)
+
+### a) Screen purpose
+"Ledger completo, confiavel e editavel."
+
+### b) O que funciona bem
+- Filtros, export, badges de conta e merchant icons.
+- Pagina√ß√£o por p√°gina (50 itens) para performance.
+
+### c) Friccoes e problemas
+- Nenhuma fric√ß√£o cr√≠tica ap√≥s pagina√ß√£o.
+
+### d) Propostas
+- Virtualiza√ß√£o opcional acima de 5k.
+
+---
+
+## Transaction Detail Modal
+
+### a) Screen purpose
+"Explicar e ajustar com confianca."
+
+### b) O que funciona bem
+- Edicao completa e manualOverride.
+
+### c) Friccoes e problemas
+- Nao mostra regra/keyword/confidencia.
+
+### d) Propostas
+- Bloco "Motivo da categoria".
+
+---
+
+## Regras
+
+### a) Screen purpose
+"Governar automacao sem medo."
+
+### b) O que funciona bem
+- CRUD direto e reaplicar regras.
+- Guia rapido de N1/N2/N3 no formulario.
+
+### c) Friccoes e problemas
+- Preview de impacto ainda √© parcial (pendentes).
+
+### d) Propostas
+- Simulador de descricao.
+- Preview "X transacoes mudariam" com contagem real.
+- Aba "Sugestoes IA" dentro de Regras (done).
+
+---
+
+## Categories Management (Shell)
+
+### a) Screen purpose
+"Controlar taxonomia N1-N3."
+
+### b) O que falta
+- Backend de CRUD e impactos em regras/transacoes.
+
+---
+
+## Orcamento Mensal
+
+### a) Screen purpose
+"Definir limites por categoria para o mes."
+
+### b) O que funciona bem
+- Progress por categoria e atualizacao inline.
+
+### c) Friccoes e problemas
+- Sem copiar mes anterior.
+- Sem sugestoes baseadas em historico.
+
+### d) Propostas
+- Botao "Copiar mes anterior".
+- Sugestao automatica (media 3 meses).
+
+---
+
+## Metas
+
+### a) Screen purpose
+"Definir objetivos estrategicos."
+
+### b) O que funciona bem
+- Progresso por categoria.
+
+### c) Friccoes e problemas
+- Confusao com Orcamento.
+
+### d) Propostas
+- Copy ja clarificada, mas falta explicacao comparativa (quando usar cada).
+- CTA inicial agora aponta para renda estimada.
+
+---
+
+## Contas
+
+### a) Screen purpose
+"Ver contas/cartoes, saldos e recencia."
+
+### b) O que funciona bem
+- Saldo agora calculado por transacoes; limite e posicao liquida aparecem.
+- Timestamp "Atualizado" deixa a recencia clara.
+
+### c) Friccoes e problemas
+- Origem do saldo ainda nao diferencia manual vs calculado.
+
+### d) Propostas
+- Mostrar origem do saldo (calculado vs manual) e ultimo update.
+
+---
+
+## AI Assistant (Chat)
+
+### a) Screen purpose
+"Perguntar sobre dados com contexto."
+
+### b) O que existe
+- Botao flutuante e modal.
+
+### c) Friccoes e problemas
+- Contexto aparece, mas IA ainda nao usa dados reais.
+- Historico apenas local (sem persistencia).
+
+### d) Propostas
+- Badge "Contexto atual".
+
+---
+
+## AI Keywords
+
+### a) Screen purpose
+"Criar regras em lote."
+
+### b) O que funciona bem
+- Analise por confianca.
+
+### c) Friccoes e problemas
+- Sem preview de impacto antes de aplicar.
+- Muito separado de Regras.
+
+### d) Propostas
+- Preview "X transacoes mudariam".
+- Mover para aba de Regras (done).
+
+---
+
+## Notificacoes
+
+### a) Screen purpose
+"Alertar sobre uploads, limites, rituais."
+
+### b) O que funciona bem
+- UI completa com filtros e mark-as-read.
+
+### c) Friccoes e problemas
+- Sem gatilhos automaticos (uploads, rituais, metas).
+
+### d) Propostas
+- Definir eventos geradores e templates por tipo.
+
+---
+
+## Rituais
+
+### a) Screen purpose
+"Conduzir revisao guiada e acordos."
+
+### b) O que funciona bem
+- Stepper e estrutura.
+
+### c) Friccoes e problemas
+- Historico agora existe, falta relacionar com metas/orcamentos.
+
+### d) Propostas
+- Timeline de acordos e CTA de ajuste (done).
+
+---
+
+## Settings
+
+### a) Screen purpose
+"Preferencias e confianca do sistema."
+
+### b) O que funciona bem
+- Auto-confirm e threshold existem.
+
+### c) Friccoes e problemas
+- Muitos toggles sao placeholders.
+
+### d) Propostas
+- Separar "Funcional" vs "Em breve".
diff --git a/docs/_codex/ux_review/UX_CONTRACTS_AND_RULES.md b/docs/_codex/ux_review/UX_CONTRACTS_AND_RULES.md
new file mode 100644
index 0000000..19a1c08
--- /dev/null
+++ b/docs/_codex/ux_review/UX_CONTRACTS_AND_RULES.md
@@ -0,0 +1,31 @@
+# UX Contracts and Rules (Revised)
+
+## Contratos nao negociaveis
+
+1) Interna (transferencias)
+- Sempre visivel no ledger, sempre excluida de gastos/receitas/orcamento.
+- Badge "Interno" consistente em todas as telas.
+
+2) Projetado vs Realizado
+- Valores futuros = "Projetado".
+- Valores passados = "Realizado".
+- Nunca misturar sem explicacao (ex: "Disponivel real").
+
+3) Confianca e automacao
+- Toda sugestao mostra origem (Regra/IA), confianca e explicacao.
+- Auto-confirmacao so quando usuario habilitou e limiar atingido.
+
+4) Upload e transparencia
+- Upload deve mostrar status claro + formato detectado.
+- Erros por linha acessiveis na UI.
+
+5) Explicabilidade de categorias
+- Transacoes precisam de regra/keyword/confidencia acessiveis em 1 clique.
+
+6) Saldos e recencia
+- Qualquer saldo exibido mostra data e origem (upload/manual).
+
+7) Linguagem
+- Portugues consistente e acentuacao correta.
+- Status e termos operacionais iguais em todas as telas.
+
diff --git a/docs/_codex/ux_review/UX_IMPROVEMENT_ROADMAP.md b/docs/_codex/ux_review/UX_IMPROVEMENT_ROADMAP.md
new file mode 100644
index 0000000..85f07ac
--- /dev/null
+++ b/docs/_codex/ux_review/UX_IMPROVEMENT_ROADMAP.md
@@ -0,0 +1,109 @@
+# UX Improvement Roadmap (Revised)
+
+## Concluido (branch_feat)
+
+1) Upload transparency (UI)
+- Solucao entregue: "Formato" + "Ver erros" por upload.
+- Impacto: visibilidade de falhas e rastreio por linha.
+
+2) Disponivel real no Dashboard
+- Solucao entregue: KPI "Disponivel real" + CTA quando renda nao definida.
+
+3) Explicabilidade da categorizacao
+- Solucao entregue: popover "Por que?" em Confirmacao e Transacoes.
+
+4) Confirmacao em lote por merchant
+- Solucao entregue: toggle de agrupamento + confirmacao por grupo.
+
+5) Notificacoes integradas
+- Solucao entregue: lista real com marcar como lida + excluir + badge no menu.
+
+6) Calendario com projetado vs realizado
+- Solucao entregue: legenda + itens projetados + badge no painel.
+
+7) Metas vs Orcamento clarificado
+- Solucao entregue: ajustes de copy nas telas.
+
+8) Merchant metadata UI
+- Solucao entregue: CRUD completo com busca e preview.
+
+9) Assistente contextual
+- Solucao entregue: badge de contexto + historico local.
+
+10) IA Keywords integrada a Regras
+- Solucao entregue: aba "Sugestoes IA" dentro de Regras.
+
+11) Estado "Proximo passo" por tela
+- Solucao entregue: CTAs em Dashboard, Uploads, Confirmacao, Transacoes e Metas.
+
+12) Historico de rituais e acordos
+- Solucao entregue: timeline de rituais concluidos.
+
+13) Erros de upload visiveis no card
+- Solucao entregue: preview dos 2 primeiros erros no historico.
+
+14) Filtros de projetado/realizado no Calendario
+- Solucao entregue: toggles para mostrar/ocultar itens.
+
+15) Merchant metadata aplicado no app
+- Solucao entregue: overrides de icon/cor/nome em Dashboard, Transacoes e Calendario.
+
+16) Preview leve de impacto em Regras
+- Solucao entregue: badge com volume pendente antes de reaplicar.
+
+17) Guia N1/N2/N3 no formulario de regras
+- Solucao entregue: microcopy explicando hierarquia.
+
+18) CTA de onboarding em Metas
+- Solucao entregue: card "Comece com uma meta simples" quando vazio.
+
+19) Recencia de saldo em Contas
+- Solucao entregue: timestamp "Atualizado HH:mm" no resumo.
+
+20) Copy + acessibilidade base
+- Solucao entregue: acentos corrigidos + aria-labels em botoes de icone.
+
+21) CTA "Criar regra" no detalhe da transacao
+- Solucao entregue: deep link com prefill direto para Regras.
+
+22) Notificacoes automaticas por eventos
+- Solucao entregue: uploads, metas e rituais disparam notificacoes.
+
+23) Regras com export/import de classificacoes
+- Solucao entregue: planilha com abas "Regras" e "Classificacoes".
+
+24) Dicionario de Comerciantes em Configuracoes
+- Solucao entregue: links diretos na aba Integracoes.
+
+25) IA Keywords baseada em mapeamento real
+- Solucao entregue: analise usa tabelas de alias e exclui termos ja cobertos.
+
+26) Sparkasse CSV com BOM
+- Solucao entregue: deteccao corrigida (BOM stripping).
+
+27) Icones antes da descricao
+- Solucao entregue: confirmacao e grupos exibem icones com overrides.
+
+28) Dicionario de Comerciantes com upload/download
+- Solucao entregue: bulk import/export com preview.
+
+29) Notificacoes com CTA de acao
+- Solucao entregue: CTAs contextuais nas notificacoes.
+
+30) Regras com preview de impacto
+- Solucao entregue: impacto estimado ao editar palavras-chave.
+
+31) Gestao de categorias (N1-N3)
+- Solucao entregue: CRUD de hierarquia com UI real.
+
+32) Assistente IA com contexto real
+- Solucao entregue: chat integrado com contexto de gastos.
+
+33) Historico de conversas IA
+- Solucao entregue: conversas persistidas e listadas.
+
+## P1 ‚Äî High impact improvements (pendentes)
+Sem pendencias nesta faixa no momento.
+
+## P2 ‚Äî Polish and delight (pendentes)
+Sem pendencias nesta faixa no momento.
diff --git a/server/csv-parser.ts b/server/csv-parser.ts
index 2a714ee..a894d97 100644
--- a/server/csv-parser.ts
+++ b/server/csv-parser.ts
@@ -154,7 +154,7 @@ function parseAmountStandard(amountStr: string): number {
 
 function detectCsvFormat(lines: string[]): { format: CsvFormat; separator: string } {
   for (let i = 0; i < Math.min(5, lines.length); i++) {
-    const line = lines[i];
+    const line = lines[i].replace(/^\uFEFF/, "");
 
     const commaCols = line.split(",").map(c => c.trim().replace(/^"|"$/g, ""));
     if (commaCols.some(c => c.toLowerCase() === "datum") &&
@@ -163,7 +163,7 @@ function detectCsvFormat(lines: string[]): { format: CsvFormat; separator: strin
       return { format: "amex", separator: "," };
     }
 
-    const semiCols = line.split(";").map(c => c.trim().replace(/^"|"$/g, ""));
+    const semiCols = line.split(";").map(c => c.trim().replace(/^"|"$/g, "").replace(/^\uFEFF/, ""));
 
     if (semiCols.some(c => c.toLowerCase() === "authorised on")) {
       return { format: "miles_and_more", separator: ";" };
@@ -196,14 +196,14 @@ function parseCSVLine(line: string, separator: string): string[] {
       }
       inQuotes = !inQuotes;
     } else if (char === separator && !inQuotes) {
-      result.push(current.trim().replace(/^"|"$/g, ""));
+      result.push(current.trim().replace(/^"|"$/g, "").replace(/^\uFEFF/, ""));
       current = "";
     } else {
       current += char;
     }
     i++;
   }
-  result.push(current.trim().replace(/^"|"$/g, ""));
+  result.push(current.trim().replace(/^"|"$/g, "").replace(/^\uFEFF/, ""));
   
   return result;
 }
diff --git a/server/index.ts b/server/index.ts
index b9b49b9..2297a10 100644
--- a/server/index.ts
+++ b/server/index.ts
@@ -64,8 +64,14 @@ app.use((req, res, next) => {
     const duration = Date.now() - start;
     if (path.startsWith("/api")) {
       let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;
-      if (capturedJsonResponse) {
-        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;
+      if (capturedJsonResponse && res.statusCode >= 400) {
+        const allowedKeys = ["error", "message", "success", "count", "status", "uploadId", "errorsCount"];
+        const safePayload = Object.fromEntries(
+          Object.entries(capturedJsonResponse).filter(([key]) => allowedKeys.includes(key)),
+        );
+        if (Object.keys(safePayload).length > 0) {
+          logLine += ` :: ${JSON.stringify(safePayload)}`;
+        }
       }
 
       log(logLine);
@@ -101,10 +107,11 @@ app.use((req, res, next) => {
   // this serves both the API and the client.
   // It is the only port that is not firewalled.
   const port = parseInt(process.env.PORT || "5000", 10);
+  const host = process.env.HOST || "0.0.0.0";
   httpServer.listen(
     {
       port,
-      host: "0.0.0.0",
+      host,
       reusePort: true,
     },
     () => {
diff --git a/server/routes.ts b/server/routes.ts
index 7dbb576..e9678fa 100644
--- a/server/routes.ts
+++ b/server/routes.ts
@@ -5,6 +5,7 @@ import { insertRuleSchema, insertGoalSchema, insertCategoryGoalSchema, insertRit
 import { z } from "zod";
 import { parseCSV, type ParsedTransaction } from "./csv-parser";
 import { categorizeTransaction, suggestKeyword, AI_SEED_RULES } from "./rules-engine";
+import { generateAliasDescHeuristic } from "./key-desc-generator";
 import OpenAI from "openai";
 import { logger } from "./logger";
 import { withOpenAIUsage } from "./ai-usage";
@@ -432,6 +433,17 @@ export async function registerRoutes(
           rowsImported: 0
         });
 
+        try {
+          await storage.createNotification({
+            userId: user.id,
+            title: "Upload falhou",
+            message: `${filename || "Arquivo"}: ${parseResult.errors[0] || "Erro ao processar CSV"}`,
+            type: "error"
+          });
+        } catch (notifyError) {
+          logger.warn("upload_notification_failed", { uploadId: upload.id });
+        }
+
         // Save parse errors to database
         for (const errorStr of parseResult.errors) {
           const match = errorStr.match(/^Linha (\d+): (.+)$/);
@@ -641,6 +653,22 @@ export async function registerRoutes(
         errorMessage: errors.length > 0 ? errors.join("; ") : undefined
       });
 
+      try {
+        const title = finalStatus === "duplicate" ? "Upload duplicado" : "Upload conclu√≠do";
+        const message = finalStatus === "duplicate"
+          ? `${filename || "Arquivo"} j√° foi importado anteriormente.`
+          : `${filename || "Arquivo"}: ${importedCount} transa√ß√µes importadas, ${duplicateCount} duplicatas.`;
+
+        await storage.createNotification({
+          userId: user.id,
+          title,
+          message,
+          type: finalStatus === "duplicate" ? "info" : "success"
+        });
+      } catch (notifyError) {
+        logger.warn("upload_notification_failed", { uploadId: upload.id });
+      }
+
       const duration = Date.now() - startTime;
 
       logger.info("upload_complete", {
@@ -913,6 +941,61 @@ export async function registerRoutes(
   });
 
   // ===== RULES =====
+  const normalizeForMatch = (text: string) => {
+    return text
+      .toUpperCase()
+      .normalize("NFD")
+      .replace(/[\u0300-\u036f]/g, "")
+      .replace(/\s+/g, " ")
+      .trim();
+  };
+
+  app.post("/api/rules/preview", async (req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.status(401).json({ error: "Usu√°rio n√£o encontrado" });
+
+      const { keywords, scope = "pending", month } = req.body || {};
+      if (!keywords || typeof keywords !== "string") {
+        return res.status(400).json({ error: "Palavras-chave s√£o obrigat√≥rias" });
+      }
+
+      const keywordList = keywords
+        .split(";")
+        .map((k) => normalizeForMatch(k))
+        .filter((k) => k.length > 0);
+
+      if (keywordList.length === 0) {
+        return res.json({ count: 0, samples: [], scanned: 0 });
+      }
+
+      const transactions =
+        scope === "all"
+          ? await storage.getTransactions(user.id, month)
+          : await storage.getTransactionsByNeedsReview(user.id);
+
+      let count = 0;
+      const samples: string[] = [];
+      for (const tx of transactions) {
+        const haystack = normalizeForMatch(tx.descNorm || tx.descRaw || "");
+        if (keywordList.some((keyword) => haystack.includes(keyword))) {
+          count++;
+          if (samples.length < 5 && tx.descRaw) {
+            samples.push(tx.descRaw);
+          }
+        }
+      }
+
+      res.json({
+        count,
+        samples,
+        scanned: transactions.length
+      });
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
   app.get("/api/rules", async (_req: Request, res: Response) => {
     try {
       const user = await storage.getUserByUsername("demo");
@@ -1091,6 +1174,75 @@ export async function registerRoutes(
     }
   });
 
+  // ===== CATEGORY HIERARCHY =====
+  app.get("/api/categories", async (_req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.json([]);
+      const entries = await storage.getCategoryHierarchy(user.id);
+      res.json(entries);
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
+  app.post("/api/categories", async (req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.status(404).json({ error: "User not found" });
+
+      const { category1, category2, category3 } = req.body;
+      if (!category1 || !category2) {
+        return res.status(400).json({ error: "Categoria 1 e Categoria 2 s√£o obrigat√≥rias" });
+      }
+
+      const created = await storage.createCategoryHierarchy({
+        userId: user.id,
+        category1,
+        category2,
+        category3: category3 || null
+      });
+
+      res.status(201).json(created);
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
+  app.patch("/api/categories/:id", async (req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.status(404).json({ error: "User not found" });
+
+      const { category1, category2, category3 } = req.body;
+      const updated = await storage.updateCategoryHierarchy(req.params.id, user.id, {
+        category1,
+        category2,
+        category3: category3 || null
+      });
+
+      if (!updated) {
+        return res.status(404).json({ error: "Categoria n√£o encontrada" });
+      }
+
+      res.json(updated);
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
+  app.delete("/api/categories/:id", async (req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.status(404).json({ error: "User not found" });
+
+      await storage.deleteCategoryHierarchy(req.params.id, user.id);
+      res.json({ success: true });
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
   // ===== DASHBOARD =====
   app.get("/api/dashboard", async (req: Request, res: Response) => {
     try {
@@ -1167,6 +1319,78 @@ export async function registerRoutes(
     }
   });
 
+  // Bulk upsert merchant descriptions
+  app.post("/api/merchant-descriptions/bulk", async (req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.status(404).json({ error: "User not found" });
+
+      const items = Array.isArray(req.body?.items) ? req.body.items : [];
+      if (items.length === 0) {
+        return res.status(400).json({ error: "Items are required" });
+      }
+
+      const allowedSources = new Set(["Sparkasse", "Amex", "M&M"]);
+      const errors: Array<{ row: number; message: string }> = [];
+      let created = 0;
+      let updated = 0;
+
+      for (let index = 0; index < items.length; index++) {
+        const row = items[index];
+        const rowNum = index + 1;
+        const source = row?.source;
+        const keyDesc = row?.keyDesc;
+        const aliasDesc = row?.aliasDesc;
+
+        if (!allowedSources.has(source)) {
+          errors.push({ row: rowNum, message: "Fonte inv√°lida (use Sparkasse, Amex ou M&M)" });
+          continue;
+        }
+        if (!keyDesc || typeof keyDesc !== "string") {
+          errors.push({ row: rowNum, message: "Descri√ß√£o Chave √© obrigat√≥ria" });
+          continue;
+        }
+        if (!aliasDesc || typeof aliasDesc !== "string") {
+          errors.push({ row: rowNum, message: "Alias √© obrigat√≥rio" });
+          continue;
+        }
+
+        const existing = await storage.getMerchantDescription(user.id, source, keyDesc);
+        const result = await storage.upsertMerchantDescription(
+          user.id,
+          source,
+          keyDesc,
+          aliasDesc,
+          true
+        );
+
+        if (existing) {
+          updated++;
+        } else if (result) {
+          created++;
+        }
+
+        const existingIcon = await storage.getMerchantIcon(user.id, aliasDesc);
+        if (!existingIcon) {
+          await storage.createMerchantIcon({
+            userId: user.id,
+            aliasDesc,
+            shouldFetchIcon: true
+          });
+        }
+      }
+
+      res.json({
+        created,
+        updated,
+        failed: errors.length,
+        errors
+      });
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
   // Update merchant description
   app.patch("/api/merchant-descriptions/:id", async (req: Request, res: Response) => {
     try {
@@ -1429,6 +1653,24 @@ export async function registerRoutes(
 
       const goal = await storage.createGoal(validatedData);
 
+      try {
+        await storage.createNotification({
+          userId: user.id,
+          title: "Meta criada",
+          message: `Meta de ${goal.month} criada com renda estimada de ${goal.estimatedIncome.toFixed(2)}.`,
+          type: "success"
+        });
+      } catch (notifyError) {
+        console.log(JSON.stringify({
+          timestamp: new Date().toISOString(),
+          level: "WARN",
+          endpoint: `${req.method} ${req.path}`,
+          userId: user.id,
+          action: "goal_notification_failed",
+          metadata: { goalId: goal.id }
+        }));
+      }
+
       console.log(JSON.stringify({
         timestamp: new Date().toISOString(),
         level: "INFO",
@@ -1499,6 +1741,24 @@ export async function registerRoutes(
         return res.status(404).json({ error: "Goal not found" });
       }
 
+      try {
+        await storage.createNotification({
+          userId: user.id,
+          title: "Meta atualizada",
+          message: `Meta de ${updated.month} atualizada.`,
+          type: "info"
+        });
+      } catch (notifyError) {
+        console.log(JSON.stringify({
+          timestamp: new Date().toISOString(),
+          level: "WARN",
+          endpoint: `${req.method} ${req.path}`,
+          userId: user.id,
+          action: "goal_notification_failed",
+          metadata: { goalId }
+        }));
+      }
+
       console.log(JSON.stringify({
         timestamp: new Date().toISOString(),
         level: "INFO",
@@ -2223,6 +2483,24 @@ export async function registerRoutes(
         return res.status(404).json({ error: "Ritual not found" });
       }
 
+      try {
+        await storage.createNotification({
+          userId: user.id,
+          title: "Ritual conclu√≠do",
+          message: `Ritual ${completed.type} de ${completed.period} conclu√≠do.`,
+          type: "success"
+        });
+      } catch (notifyError) {
+        console.log(JSON.stringify({
+          timestamp: new Date().toISOString(),
+          level: "WARN",
+          endpoint: `${req.method} ${req.path}`,
+          userId: user.id,
+          action: "ritual_notification_failed",
+          metadata: { ritualId }
+        }));
+      }
+
       console.log(JSON.stringify({
         timestamp: new Date().toISOString(),
         level: "INFO",
@@ -2275,22 +2553,52 @@ export async function registerRoutes(
 
       // Get all uncategorized transactions
       const uncategorized = await storage.getUncategorizedTransactions(user.id);
-      
-      if (uncategorized.length === 0) {
-        return res.json({ suggestions: [], message: "Nenhuma transa√ß√£o pendente de categoriza√ß√£o" });
-      }
 
-      // Group by suggested keyword
-      const grouped: Record<string, { count: number; total: number; samples: string[] }> = {};
-      for (const tx of uncategorized) {
-        const keyword = tx.suggestedKeyword || suggestKeyword(tx.descNorm);
-        if (!grouped[keyword]) {
-          grouped[keyword] = { count: 0, total: 0, samples: [] };
+      const grouped: Record<string, { count: number; total: number; samples: string[]; alias?: string }> = {};
+
+      if (uncategorized.length > 0) {
+        // Group by suggested keyword (transactions)
+        for (const tx of uncategorized) {
+          const keyword = tx.suggestedKeyword || suggestKeyword(tx.descNorm);
+          if (!grouped[keyword]) {
+            grouped[keyword] = { count: 0, total: 0, samples: [] };
+          }
+          grouped[keyword].count++;
+          grouped[keyword].total += Math.abs(tx.amount);
+          if (grouped[keyword].samples.length < 3) {
+            grouped[keyword].samples.push(tx.descRaw);
+          }
         }
-        grouped[keyword].count++;
-        grouped[keyword].total += Math.abs(tx.amount);
-        if (grouped[keyword].samples.length < 3) {
-          grouped[keyword].samples.push(tx.descRaw);
+      } else {
+        // Fallback: use merchant dictionary mapping table
+        const rules = await storage.getRules(user.id);
+        const ruleKeywords = new Set<string>();
+        for (const rule of rules) {
+          rule.keywords
+            .split(";")
+            .map(k => k.trim().toLowerCase())
+            .filter(Boolean)
+            .forEach(k => ruleKeywords.add(k));
+        }
+
+        const merchantDescriptions = await storage.getMerchantDescriptions(user.id);
+        const candidates = merchantDescriptions
+          .filter((d) => d.keyDesc && !ruleKeywords.has(d.keyDesc.toLowerCase()))
+          .slice(0, 200);
+
+        for (const desc of candidates) {
+          const keyword = desc.keyDesc;
+          const matches = await storage.getTransactionsByKeyword(user.id, keyword);
+          grouped[keyword] = {
+            count: matches.length,
+            total: matches.reduce((sum, t) => sum + Math.abs(t.amount), 0),
+            samples: matches.slice(0, 3).map(t => t.descRaw),
+            alias: desc.aliasDesc
+          };
+        }
+
+        if (Object.keys(grouped).length === 0) {
+          return res.json({ suggestions: [], message: "Nenhuma transa√ß√£o pendente de categoriza√ß√£o" });
         }
       }
 
@@ -2299,6 +2607,7 @@ export async function registerRoutes(
         .filter(([_, data]) => data.count >= 1)
         .map(([keyword, data]) => ({
           keyword,
+          alias: data.alias,
           count: data.count,
           total: data.total,
           samples: data.samples
@@ -2321,6 +2630,8 @@ Para cada palavra-chave, retorne um JSON com categoriza√ß√£o em 3 n√≠veis:
 - confidence: n√∫mero de 0 a 100 indicando sua confian√ßa
 - reason: explica√ß√£o breve em portugu√™s
 
+Se o campo "alias" estiver presente, use como contexto para entender o merchant.
+
 Exemplos de categoriza√ß√£o em 3 n√≠veis:
 - "LIDL" ‚Üí N√≠vel 1: "Mercado", N√≠vel 2: "Supermercado", N√≠vel 3: "LIDL"
 - "STADTWERK" ‚Üí N√≠vel 1: "Moradia", N√≠vel 2: "Utilidades", N√≠vel 3: "√Ågua/G√°s"
@@ -2383,6 +2694,231 @@ Retorne APENAS um array JSON v√°lido, sem markdown ou texto adicional.`;
     }
   });
 
+  app.post("/api/ai/merchant-suggestions", async (_req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) {
+        return res.status(401).json({ error: "Usu√°rio n√£o encontrado" });
+      }
+
+      const merchantDescriptions = await storage.getMerchantDescriptions(user.id);
+      if (merchantDescriptions.length === 0) {
+        return res.json({ suggestions: [], message: "Nenhum merchant para analisar" });
+      }
+
+      const candidates = merchantDescriptions
+        .filter((d) => d.keyDesc)
+        .slice(0, 120);
+
+      if (!openai) {
+        const fallback = candidates.map((desc) => ({
+          id: desc.id,
+          keyDesc: desc.keyDesc,
+          source: desc.source,
+          currentAlias: desc.aliasDesc,
+          suggestedAlias: generateAliasDescHeuristic(desc.keyDesc),
+          confidence: 50,
+          reason: "Sugest√£o heur√≠stica baseada na descri√ß√£o-chave"
+        }));
+        return res.json({ suggestions: fallback, total: fallback.length, mode: "heuristic" });
+      }
+
+      const systemPrompt = `Voc√™ √© um assistente especializado em padroniza√ß√£o de nomes de comerciantes.
+Receba descri√ß√µes-chave (keyDesc) e proponha um alias amig√°vel e consistente em portugu√™s.
+Responda APENAS com um array JSON contendo:
+- id
+- suggestedAlias
+- confidence (0-100)
+- reason (breve)
+`;
+
+      const response = await withOpenAIUsage(
+        {
+          featureTag: "merchant_suggestions",
+          model: "gpt-4o-mini",
+          userId: user.id,
+          extractUsage: (result) => result.usage
+        },
+        () =>
+          openai.chat.completions.create({
+            model: "gpt-4o-mini",
+            messages: [
+              { role: "system", content: systemPrompt },
+              { role: "user", content: JSON.stringify(candidates.map((c) => ({
+                id: c.id,
+                keyDesc: c.keyDesc,
+                source: c.source,
+                currentAlias: c.aliasDesc
+              }))) }
+            ],
+            temperature: 0.3,
+            max_tokens: 2000
+          })
+      );
+
+      const content = response.choices[0]?.message?.content || "[]";
+      let aiSuggestions: any[] = [];
+      try {
+        aiSuggestions = JSON.parse(content.replace(/```json\n?|\n?```/g, ""));
+      } catch (e) {
+        aiSuggestions = [];
+      }
+
+      const merged = candidates.map((desc) => {
+        const match = aiSuggestions.find((s) => s.id === desc.id) || {};
+        return {
+          id: desc.id,
+          keyDesc: desc.keyDesc,
+          source: desc.source,
+          currentAlias: desc.aliasDesc,
+          suggestedAlias: match.suggestedAlias || generateAliasDescHeuristic(desc.keyDesc),
+          confidence: match.confidence ?? 50,
+          reason: match.reason || "Sugest√£o autom√°tica"
+        };
+      });
+
+      res.json({ suggestions: merged, total: merged.length, mode: "ai" });
+    } catch (error: any) {
+      console.error("Merchant suggestions error:", error);
+      res.status(500).json({ error: error.message });
+    }
+  });
+
+  // ===== AI CHAT =====
+  app.get("/api/ai/conversations", async (_req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.json([]);
+      const conversations = await storage.getConversations(user.id);
+      res.json(conversations);
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
+  app.get("/api/ai/conversations/:id/messages", async (req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) return res.status(401).json({ error: "Usu√°rio n√£o encontrado" });
+
+      const conversation = await storage.getConversationById(req.params.id, user.id);
+      if (!conversation) {
+        return res.status(404).json({ error: "Conversa n√£o encontrada" });
+      }
+
+      const messages = await storage.getMessages(conversation.id);
+      res.json(messages);
+    } catch (error: any) {
+      res.status(500).json({ error: error.message });
+    }
+  });
+
+  app.post("/api/ai/chat", async (req: Request, res: Response) => {
+    try {
+      const user = await storage.getUserByUsername("demo");
+      if (!user) {
+        return res.status(401).json({ error: "Usu√°rio n√£o encontrado" });
+      }
+
+      const { message, conversationId, context } = req.body || {};
+      if (!message || typeof message !== "string") {
+        return res.status(400).json({ error: "Mensagem √© obrigat√≥ria" });
+      }
+
+      let activeConversationId = conversationId as string | undefined;
+      if (activeConversationId) {
+        const conversation = await storage.getConversationById(activeConversationId, user.id);
+        if (!conversation) {
+          return res.status(404).json({ error: "Conversa n√£o encontrada" });
+        }
+      } else {
+        const title = message.slice(0, 60);
+        const createdConversation = await storage.createConversation({
+          userId: user.id,
+          title
+        });
+        activeConversationId = createdConversation.id;
+      }
+
+      const userMessage = await storage.createMessage({
+        conversationId: activeConversationId,
+        role: "user",
+        content: message
+      });
+
+      const month = context?.month || new Date().toISOString().slice(0, 7);
+      const dashboard = await storage.getDashboardData(user.id, month);
+      const pending = await storage.getTransactionsByNeedsReview(user.id);
+
+      const contextSummary = {
+        screen: context?.screen || "Geral",
+        month,
+        totalSpent: dashboard.totalSpent,
+        totalIncome: dashboard.totalIncome,
+        pendingReviewCount: pending.length,
+        topCategories: dashboard.spentByCategory?.slice(0, 5) || []
+      };
+
+      if (!openai) {
+        const fallbackContent = `No momento estou sem acesso ao modelo IA. Aqui vai um resumo r√°pido:\n- M√™s: ${contextSummary.month}\n- Gastos: ${contextSummary.totalSpent.toFixed(2)}\n- Receitas: ${contextSummary.totalIncome.toFixed(2)}\n- Pendentes: ${contextSummary.pendingReviewCount}\n\nPosso ajudar com insights b√°sicos quando a IA estiver ativa.`;
+        const assistantMessage = await storage.createMessage({
+          conversationId: activeConversationId,
+          role: "assistant",
+          content: fallbackContent
+        });
+
+        return res.json({
+          conversationId: activeConversationId,
+          messageId: userMessage.id,
+          replyId: assistantMessage.id,
+          reply: assistantMessage.content,
+          context: contextSummary,
+          mode: "fallback"
+        });
+      }
+
+      const systemPrompt = `Voc√™ √© um assistente financeiro pessoal. Responda em portugu√™s, de forma clara e objetiva.\nContexto atual (JSON): ${JSON.stringify(contextSummary)}.\nSe faltar informa√ß√£o, pe√ßa ao usu√°rio.`;
+
+      const response = await withOpenAIUsage(
+        {
+          featureTag: "ai_chat",
+          model: "gpt-4o-mini",
+          userId: user.id,
+          extractUsage: (result) => result.usage
+        },
+        () =>
+          openai.chat.completions.create({
+            model: "gpt-4o-mini",
+            messages: [
+              { role: "system", content: systemPrompt },
+              { role: "user", content: message }
+            ],
+            temperature: 0.3,
+            max_tokens: 800
+          })
+      );
+
+      const reply = response.choices[0]?.message?.content || "N√£o consegui gerar uma resposta.";
+      const assistantMessage = await storage.createMessage({
+        conversationId: activeConversationId,
+        role: "assistant",
+        content: reply
+      });
+
+      res.json({
+        conversationId: activeConversationId,
+        messageId: userMessage.id,
+        replyId: assistantMessage.id,
+        reply,
+        context: contextSummary,
+        mode: "ai"
+      });
+    } catch (error: any) {
+      console.error("AI chat error:", error);
+      res.status(500).json({ error: error.message });
+    }
+  });
+
   // Apply AI suggestions as rules
   app.post("/api/ai/apply-suggestions", async (req: Request, res: Response) => {
     try {
diff --git a/server/storage.ts b/server/storage.ts
index 0dfb340..130d0a8 100644
--- a/server/storage.ts
+++ b/server/storage.ts
@@ -1,6 +1,6 @@
 import {
-  users, accounts, uploads, uploadErrors, merchantMetadata, transactions, rules, budgets, calendarEvents, eventOccurrences, goals, categoryGoals, rituals, settings,
-  aiUsageLogs, notifications, merchantDescriptions, merchantIcons,
+  users, accounts, uploads, uploadErrors, merchantMetadata, transactions, rules, categoryHierarchy, budgets, calendarEvents, eventOccurrences, goals, categoryGoals, rituals, settings,
+  aiUsageLogs, notifications, merchantDescriptions, merchantIcons, conversations, messages,
   type User, type InsertUser,
   type Account, type InsertAccount,
   type Upload, type InsertUpload,
@@ -8,6 +8,7 @@ import {
   type MerchantMetadata, type InsertMerchantMetadata,
   type Transaction, type InsertTransaction,
   type Rule, type InsertRule,
+  type CategoryHierarchy, type InsertCategoryHierarchy,
   type Budget, type InsertBudget,
   type CalendarEvent, type InsertCalendarEvent,
   type EventOccurrence, type InsertEventOccurrence,
@@ -18,7 +19,9 @@ import {
   type AiUsageLog, type InsertAiUsageLog,
   type Notification, type InsertNotification, type UpdateNotification,
   type MerchantDescription, type InsertMerchantDescription,
-  type MerchantIcon, type InsertMerchantIcon
+  type MerchantIcon, type InsertMerchantIcon,
+  type Conversation, type InsertConversation,
+  type Message, type InsertMessage
 } from "@shared/schema";
 import { db } from "./db";
 import { eq, and, desc, sql, like, gte, lt, or, isNull } from "drizzle-orm";
@@ -44,6 +47,13 @@ export interface IStorage {
   updateNotification(id: string, userId: string, data: UpdateNotification): Promise<Notification | undefined>;
   deleteNotification(id: string, userId: string): Promise<void>;
 
+  // Conversations & Messages
+  getConversations(userId: string): Promise<Conversation[]>;
+  getConversationById(id: string, userId: string): Promise<Conversation | undefined>;
+  createConversation(conversation: InsertConversation): Promise<Conversation>;
+  getMessages(conversationId: string): Promise<Message[]>;
+  createMessage(message: InsertMessage): Promise<Message>;
+
   // Accounts
   getAccounts(userId: string): Promise<Account[]>;
   getAccount(id: string): Promise<Account | undefined>;
@@ -88,6 +98,13 @@ export interface IStorage {
   createRule(rule: InsertRule): Promise<Rule>;
   updateRule(id: string, data: Partial<Rule>): Promise<Rule | undefined>;
   deleteRule(id: string): Promise<void>;
+
+  // Category Hierarchy
+  getCategoryHierarchy(userId: string): Promise<CategoryHierarchy[]>;
+  getCategoryHierarchyById(id: string, userId: string): Promise<CategoryHierarchy | undefined>;
+  createCategoryHierarchy(entry: InsertCategoryHierarchy): Promise<CategoryHierarchy>;
+  updateCategoryHierarchy(id: string, userId: string, data: Partial<CategoryHierarchy>): Promise<CategoryHierarchy | undefined>;
+  deleteCategoryHierarchy(id: string, userId: string): Promise<void>;
   
   // Budgets
   getBudgets(userId: string, month: string): Promise<Budget[]>;
@@ -257,6 +274,35 @@ export class DatabaseStorage implements IStorage {
     await db.delete(notifications).where(and(eq(notifications.id, id), eq(notifications.userId, userId)));
   }
 
+  // Conversations & Messages
+  async getConversations(userId: string): Promise<Conversation[]> {
+    return db.select().from(conversations)
+      .where(eq(conversations.userId, userId))
+      .orderBy(desc(conversations.createdAt));
+  }
+
+  async getConversationById(id: string, userId: string): Promise<Conversation | undefined> {
+    const [conversation] = await db.select().from(conversations)
+      .where(and(eq(conversations.id, id), eq(conversations.userId, userId)));
+    return conversation || undefined;
+  }
+
+  async createConversation(conversation: InsertConversation): Promise<Conversation> {
+    const [created] = await db.insert(conversations).values(conversation).returning();
+    return created;
+  }
+
+  async getMessages(conversationId: string): Promise<Message[]> {
+    return db.select().from(messages)
+      .where(eq(messages.conversationId, conversationId))
+      .orderBy(messages.createdAt);
+  }
+
+  async createMessage(message: InsertMessage): Promise<Message> {
+    const [created] = await db.insert(messages).values(message).returning();
+    return created;
+  }
+
   // Accounts
   async getAccounts(userId: string): Promise<Account[]> {
     return db.select().from(accounts)
@@ -507,6 +553,37 @@ export class DatabaseStorage implements IStorage {
     await db.delete(rules).where(eq(rules.id, id));
   }
 
+  // Category Hierarchy
+  async getCategoryHierarchy(userId: string): Promise<CategoryHierarchy[]> {
+    return db.select().from(categoryHierarchy)
+      .where(eq(categoryHierarchy.userId, userId))
+      .orderBy(categoryHierarchy.category1, categoryHierarchy.category2, categoryHierarchy.category3);
+  }
+
+  async getCategoryHierarchyById(id: string, userId: string): Promise<CategoryHierarchy | undefined> {
+    const [entry] = await db.select().from(categoryHierarchy)
+      .where(and(eq(categoryHierarchy.id, id), eq(categoryHierarchy.userId, userId)));
+    return entry || undefined;
+  }
+
+  async createCategoryHierarchy(entry: InsertCategoryHierarchy): Promise<CategoryHierarchy> {
+    const [created] = await db.insert(categoryHierarchy).values(entry).returning();
+    return created;
+  }
+
+  async updateCategoryHierarchy(id: string, userId: string, data: Partial<CategoryHierarchy>): Promise<CategoryHierarchy | undefined> {
+    const [updated] = await db.update(categoryHierarchy)
+      .set({ ...data, updatedAt: new Date() })
+      .where(and(eq(categoryHierarchy.id, id), eq(categoryHierarchy.userId, userId)))
+      .returning();
+    return updated || undefined;
+  }
+
+  async deleteCategoryHierarchy(id: string, userId: string): Promise<void> {
+    await db.delete(categoryHierarchy)
+      .where(and(eq(categoryHierarchy.id, id), eq(categoryHierarchy.userId, userId)));
+  }
+
   // Budgets
   async getBudgets(userId: string, month: string): Promise<Budget[]> {
     return db.select().from(budgets)
diff --git a/shared/schema.ts b/shared/schema.ts
index 4539054..8cda2c3 100644
--- a/shared/schema.ts
+++ b/shared/schema.ts
@@ -204,6 +204,23 @@ export const insertRuleSchema = createInsertSchema(rules).omit({ id: true, creat
 export type InsertRule = z.infer<typeof insertRuleSchema>;
 export type Rule = typeof rules.$inferSelect;
 
+// Category Hierarchy (N1 -> N2 -> N3)
+export const categoryHierarchy = pgTable("category_hierarchy", {
+  id: varchar("id").primaryKey().default(sql`gen_random_uuid()`),
+  userId: varchar("user_id").notNull().references(() => users.id, { onDelete: "cascade" }),
+  category1: category1Enum("category_1").notNull(),
+  category2: text("category_2").notNull(),
+  category3: text("category_3"),
+  createdAt: timestamp("created_at").notNull().defaultNow(),
+  updatedAt: timestamp("updated_at").notNull().defaultNow(),
+}, (table) => ({
+  uniqueEntry: sql`UNIQUE (user_id, category_1, category_2, category_3)`
+}));
+
+export const insertCategoryHierarchySchema = createInsertSchema(categoryHierarchy).omit({ id: true, createdAt: true, updatedAt: true });
+export type InsertCategoryHierarchy = z.infer<typeof insertCategoryHierarchySchema>;
+export type CategoryHierarchy = typeof categoryHierarchy.$inferSelect;
+
 // Transactions table (ledger canonico)
 export const transactions = pgTable("transactions", {
   id: varchar("id").primaryKey().default(sql`gen_random_uuid()`),
-- 
2.50.1 (Apple Git-155)

